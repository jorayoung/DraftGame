<!DOCTYPE html>
<html>
<head>
<link rel="icon" href="logo.png" type="image/x-icon">
<title>Драфт</title>
<style>
  body {
    margin: 0;
    padding: 0;
    min-height: 100vh;
    background: url('background.png') no-repeat center center fixed;
    background-size: cover;
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: 'Arial', sans-serif;
    color: white;
    position: relative;
  }

  body::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
     background: rgba(30, 30, 30, 0.5);
    z-index: -1;
  }

  .position-container {
    display: flex;
    flex-direction: column;
    margin: 25px 0;
    width: 90%;
    max-width: 1000px;
    background: linear-gradient(145deg, rgba(0,0,0,0.8), rgba(40,40,40,0.8));
    padding: 20px;
    border-radius: 15px;
    border: 1px solid rgba(0, 191, 255, 0.2);
    box-shadow: 0 0 15px rgba(0,0,0,0.5),
               0 0 6px rgba(0, 191, 255, 0.1) inset;
  }

  .players-row {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 25px;
    padding: 10px 0;
  }

  .player-circle {
    width: 130px;
    height: 130px;
    border-radius: 50%;
    border: 2px solid #000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    transform-style: preserve-3d;
  }

  .player-circle::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, 
      transparent, 
      rgba(255,255,255,0.1), 
      transparent);
    transform: rotate(45deg);
    transition: 0.5s;
    opacity: 0;
  }

  .player-circle:hover::before {
    opacity: 1;
    animation: playerShine 1.5s;
  }

  @keyframes playerShine {
    0% { transform: translateX(-50%) rotate(45deg); }
    100% { transform: translateX(150%) rotate(45deg); }
  }

  .player-rating {
    font-size: 58px;
    font-weight: 800;
    color: white;
    text-shadow: 2px 2px 6px rgba(0,0,0,0.8);
    position: absolute;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 2;
  }

  .player-nickname {
    font-size: 16px;
    font-weight: 500;
    color: white;
    position: absolute;
    top: 70%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
    text-align: center;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    padding: 0 5px;
    z-index: 2;
  }

  .selected {
    border-color: #00ff00;
    box-shadow: 0 0 12px #00ff00,
                0 0 20px rgba(0, 255, 0, 0.1);
    transform: scale(1.06);
  }

  .bronze { background: linear-gradient(135deg, #cd7f32 0%, #a97142 100%); }
  .silver { background: linear-gradient(135deg, #c0c0c0 0%, #909090 100%); }
  .gold { background: linear-gradient(135deg, #ffd700 0%, #daa520 100%); }
  .red {
    background: linear-gradient(135deg, #ff0000 0%, #8b0000 100%);
    box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
}

  #matchOverlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(5px);
  }

  #matchPopup {
    background: linear-gradient(145deg, #222, #1a1a1a);
    padding: 20px;
    border-radius: 15px;
    width: 95%;
    max-width: 700px;
    box-shadow: 0 0 20px rgba(0,0,0,0.6),
                0 0 8px rgba(0, 191, 255, 0.15);
    border: 1px solid rgba(0, 191, 255, 0.1);
    display: flex;
    flex-direction: column;
    max-height: 90vh;
    box-sizing: border-box;

}
  }

  .team-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0 10px;
  }

  .team-logo {
    width: 150px;
    height: 150px;
    object-fit: contain;
    filter: drop-shadow(0 0 8px rgba(0, 191, 255, 0.3));
  }

  .team-name-display {
    font-size: 16px;
    font-weight: 600;
    margin-top: 8px;
    color: #00bfff;
    text-shadow: 0 0 6px rgba(0, 191, 255, 0.3);
    white-space: nowrap;
  }

  #startButton {
    display: none;
    margin: 25px auto 0;
    padding: 14px 35px;
    font-size: 18px;
    font-weight: 600;
    background: linear-gradient(135deg, #0066cc, #00bfff);
    color: white;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 10px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  }

  #startButton::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255,255,255,0.12),
      transparent
    );
    transition: 0.5s;
  }

  #startButton:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.3);
  }

  #startButton:hover::before {
    left: 100%;
  }

  h2, h3 {
    text-align: center;
    margin: 0 0 20px;
    color: #00bfff;
    text-shadow: 0 0 10px rgba(0, 191, 255, 0.3);
    font-size: 1.4em;
  }

  .vs-container {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 15px 0;
    gap: 20px;
    flex-wrap: nowrap;
    width: 100%;
  }

  .score {
    font-size: 28px;
    font-weight: 800;
    margin: 12px 0;
    color: #fff;
    text-align: center;
    width: 100%;
    text-shadow: 0 0 10px rgba(0, 191, 255, 0.5);
  }

  .final-banner {
    background: linear-gradient(135deg, gold, #daa520);
    color: #000;
    padding: 8px 20px;
    border-radius: 6px;
    font-weight: 700;
    margin: 0 auto 15px;
    width: fit-content;
    box-shadow: 0 0 12px rgba(255,215,0,0.3);
    font-size: 14px;
  }

  .match-time {
    font-size: 16px;
    font-weight: 500;
    margin: 0 auto 10px;
    text-align: center;
    width: fit-content;
    color: #00bfff;
  }

  #eventsContainer {
    max-height: 118px;
    overflow-y: auto;
    overflow-x: hidden;
    margin: 1px 0;
    padding-right: 5px;
    width: calc(100% - 5px);
  }

  #eventsContainer::-webkit-scrollbar {
    width: 5px;
    background-color: rgba(0,0,0,0.25);
    border-radius: 2px;
  }

  #eventsContainer::-webkit-scrollbar-thumb {
    background-color: #00bfff;
    border-radius: 2px;
  }

  .goal-event {
    font-size: 13px;
    margin: 2px 0;
    padding: 4px 8px;
    border-radius: 4px;
    animation: goalFlash 0.8s;
    background: rgba(0,0,0,0.25);
    border-left: 3px solid;
    line-height: 1.2;
    min-height: 14px;
    display: flex;
    align-items: center;
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
  }

  .user-goal {
    color: #7cfc00;
    border-color: #7cfc00;
    text-shadow: 0 0 4px rgba(124,252,0,0.25);
  }

  .opponent-goal {
    color: #ff4500;
    border-color: #ff4500;
    text-shadow: 0 0 4px rgba(255,69,0,0.25);
  }

  @keyframes goalFlash {
    0% { transform: scale(1.05); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
  }

  .match-buttons-container {
    margin-top: auto;
    padding-top: 15px;
  }

  #playButton, #backToMenuButton {
    padding: 12px 28px;
    font-size: 16px;
    font-weight: 600;
    background: linear-gradient(135deg, #0066cc, #00bfff);
    color: white;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    display: block;
    margin: 8px auto;
    width: fit-content;
  }

  #playButton:hover, #backToMenuButton:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.25);
  }

  #statsOverlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.97);
    z-index: 2000;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(6px);
  }

  #statsPopup {
    background: linear-gradient(145deg, #1a1a1a, #222);
    padding: 20px;
    border-radius: 15px;
    width: 95%;
    max-width: 600px;
    box-shadow: 0 0 20px rgba(0,0,0,0.6),
                0 0 8px rgba(0, 191, 255, 0.15);
    border: 1px solid rgba(0, 191, 255, 0.1);
  }

  .stats-title {
    text-align: center;
    font-size: 20px;
    margin-bottom: 15px;
    color: #00bfff;
    text-shadow: 0 0 10px rgba(0, 191, 255, 0.3);
  }

  .stats-table {
    width: 100%;
    border-collapse: collapse;
    margin: 15px 0;
  }

  .stats-table th {
    background: linear-gradient(135deg, #0066cc, #00bfff);
    color: white;
    padding: 10px;
    font-weight: 600;
    font-size: 14px;
  }

  .stats-table td {
    padding: 8px 10px;
    background: rgba(255,255,255,0.05);
    border-bottom: 1px solid rgba(255,255,255,0.08);
    font-size: 13px;
  }

  .golden-ball {
    text-align: center;
    margin-top: 15px;
    padding: 12px;
    background: rgba(255,215,0,0.08);
    border-radius: 12px;
    border: 1px solid gold;
    box-shadow: 0 0 8px rgba(255,215,0,0.25);
  }

  .golden-ball-icon {
    font-size: 28px;
    margin-bottom: 8px;
    text-shadow: 0 0 12px gold;
  }

  #teamNameModal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 3000;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(4px);
  }

#teamNamePopup {
    background: linear-gradient(145deg, #222, #1a1a1a);
    padding: 25px; /* Увеличим padding для лучшего визуального баланса */
    border-radius: 15px;
    width: 95%;
    max-width: 450px;
    box-shadow: 0 0 20px rgba(0,0,0,0.6),
                0 0 8px rgba(0, 191, 255, 0.15);
    border: 1px solid rgba(0, 191, 255, 0.1);
    /* Добавляем flex-выравнивание */
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px; /* Расстояние между элементами */
}

#teamNameInput {
    width: 80%; /* Уменьшаем ширину поля ввода */
    padding: 12px; /* Увеличиваем padding для лучшего вида */
    font-size: 16px; /* Увеличиваем размер шрифта */
    margin: 0; /* Убираем margin */
    border-radius: 8px;
    border: 1px solid #00bfff;
    background: rgba(0,0,0,0.4);
    color: white;
    text-align: center;
    transition: all 0.3s;
}


  #teamNameInput:focus {
    outline: none;
    box-shadow: 0 0 8px rgba(0, 191, 255, 0.2);
  }

  #confirmTeamName {
    padding: 10px 25px;
    font-size: 14px;
    background: linear-gradient(135deg, #0066cc, #00bfff);
    color: white;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  }

  #confirmTeamName:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 10px rgba(0,0,0,0.25);
  }

  .game-style-buttons {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin: 20px 0;
  }

  .style-button {
    padding: 8px 16px;
    font-size: 12px;
    font-weight: 600;
    border: none;
    border-radius: 18px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    background-size: 200% auto;
  }

  .style-button.defensive {
    background: linear-gradient(135deg, #4CAF50, #2E8B57);
  }

  .style-button.balanced {
    background: linear-gradient(135deg, #2196F3, #1E90FF);
  }

  .style-button.offensive {
    background: linear-gradient(135deg, #f44336, #FF4500);
  }

  .style-button.selected {
    transform: scale(1.05);
    box-shadow: 0 0 15px rgba(255,255,255,0.3),
                0 4px 10px rgba(0,0,0,0.2);
  }

  .style-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 10px rgba(0,0,0,0.25);
  }

#transferOverlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 1500;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(5px);
}

#transferPopup {
    background: linear-gradient(145deg, #222, #1a1a1a);
    padding: 20px;
    border-radius: 15px;
    width: 95%;
    max-width: 700px;
    box-shadow: 0 0 20px rgba(0,0,0,0.6),
                0 0 8px rgba(0, 191, 255, 0.15);
    border: 1px solid rgba(0, 191, 255, 0.1);
    display: flex;
    flex-direction: column;
    align-items: center;
}

.transfer-title {
    font-size: 24px;
    margin-bottom: 20px;
    color: #00bfff;
    text-shadow: 0 0 10px rgba(0, 191, 255, 0.3);
    text-align: center;
}

.transfer-players {
    display: flex;
    justify-content: space-between;
    width: 100%;
    margin: 20px 0;
}

.transfer-player {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 45%;
}

.transfer-player-title {
    font-size: 16px;
    margin-bottom: 10px;
    color: white;
    text-align: center;
}

.transfer-buttons {
    display: flex;
    gap: 20px;
    margin-top: 20px;
}

.transfer-button {
    padding: 12px 25px;
    font-size: 16px;
    font-weight: 600;
    background: linear-gradient(135deg, #0066cc, #00bfff);
    color: white;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

.transfer-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.25);
}

.transfer-button.reject {
    background: linear-gradient(135deg, #cc3300, #ff4500);
}

.year-display {
    position: fixed;
    top: 10px;
    right: 10px;
    font-size: 14px;
    color: rgba(255, 255, 255, 0.7);
    background: rgba(0, 0, 0, 0.5);
    padding: 5px 10px;
    border-radius: 15px;
    z-index: 2000; /* Увеличьте z-index чтобы элемент был поверх всех окон */
    pointer-events: none; /* Чтобы не мешал взаимодействию с другими элементами */
}

.player-circle.bronze,
.player-circle.silver,
.player-circle.gold,
.player-circle.red {
    background-size: cover !important;
    background-repeat: no-repeat !important;
}

/* Добавляем в секцию style */
#teamSquadPanel {
    background: rgba(0, 0, 0, 0.5);
    border-radius: 10px;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid rgba(0, 191, 255, 0.2);
    max-height: 200px;
    overflow-y: auto;
}

#teamSquadPanel h3 {
    text-align: center;
    margin: 0 0 10px;
    color: #00bfff;
    font-size: 16px;
}

#teamSquadPlayers {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
}

.squad-player {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 80px;
}

.squad-player-circle {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: 1px solid #000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
}

.squad-player-rating {
    font-size: 20px;
    font-weight: 600;
    color: white;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.squad-player-nickname {
    font-size: 10px;
    font-weight: 500;
    color: white;
    text-align: center;
    margin-top: 5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    width: 100%;
}

/* Стили для цветов рейтинга (аналогичные основным игрокам) */
.squad-player-circle.bronze { background: linear-gradient(135deg, #cd7f32 0%, #a97142 100%); }
.squad-player-circle.silver { background: linear-gradient(135deg, #c0c0c0 0%, #909090 100%); }
.squad-player-circle.gold { background: linear-gradient(135deg, #ffd700 0%, #daa520 100%); }
.squad-player-circle.red { background: linear-gradient(135deg, #ff0000 0%, #8b0000 100%); }

.scorers-display {
    position: fixed;
    top: 40px; /* Располагаем под year-display */
    right: 10px;
    font-size: 12px;
    color: white;
    background: rgba(0, 0, 0, 0.7);
    padding: 8px 12px;
    border-radius: 8px;
    z-index: 2001;
    pointer-events: auto;
    max-width: 200px;
    max-height: 200px;
    overflow-y: auto;
}

.scorers-display::-webkit-scrollbar {
    width: 4px;
}

.scorers-display::-webkit-scrollbar-thumb {
    background-color: #00bfff;
    border-radius: 2px;
}

.balance-display {
    position: fixed;
    top: 8px;
    right: 100px;
    font-size: 18px;
    font-weight: bold;
    color: #7cfc00;
    text-shadow: 0 0 8px rgba(124, 252, 0, 0.5);
    background: rgba(0, 0, 0, 0.7);
    padding: 8px 15px;
    border-radius: 15px;
    z-index: 9999; /* Максимальный приоритет */
    pointer-events: none;
    transition: all 0.3s;
}

.add-player-btn {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    border: 2px dashed #00bfff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: #00bfff;
    cursor: pointer;
    transition: all 0.3s;
}

.add-player-btn:hover {
    background: rgba(0, 191, 255, 0.2);
    transform: scale(1.1);
}

#sellOverlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 2500;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(5px);
}

#sellPopup {
    background: linear-gradient(145deg, #222, #1a1a1a);
    padding: 25px;
    border-radius: 15px;
    width: 90%;
    max-width: 400px;
    text-align: center;
}

.sell-buttons {
    margin-top: 20px;
    display: flex;
    gap: 15px;
    justify-content: center;
}

.sell-button {
    padding: 10px 25px;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
}

.sell-button.confirm {
    background: linear-gradient(135deg, #4CAF50, #2E8B57);
    color: white;
}

.sell-button.cancel {
    background: linear-gradient(135deg, #f44336, #FF4500);
    color: white;
}

/* Стили для рынка */
#marketOverlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 3000;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(5px);
}

#marketPopup {
    background: linear-gradient(145deg, #222, #1a1a1a);
    padding: 20px;
    border-radius: 15px;
    width: 90%;
    max-width: 700px;
    max-height: 80vh;
    display: flex;
    flex-direction: column;
    box-shadow: 0 0 20px rgba(0,0,0,0.6);
    overflow: hidden; /* Добавлено */
}


.market-title {
    font-size: 24px;
    color: #00bfff;
    text-align: center;
    margin-bottom: 15px;
}

#marketPlayers {
    display: flex;
    flex-direction: column;
    gap: 8px;
    overflow-y: auto; /* Добавлено */
    flex: 1; /* Добавлено */
    padding-right: 8px; /* Добавлено */
    margin-bottom: 15px; /* Добавлено */
}

#marketPlayers::-webkit-scrollbar {
    width: 6px;
    background-color: rgba(0,0,0,0.3);
}

#marketPlayers::-webkit-scrollbar-thumb {
    background-color: #00bfff;
    border-radius: 3px;
}

.market-player {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    min-height: 50px;
    background: rgba(0, 191, 255, 0.05); /* Добавлено */
    border-radius: 8px; /* Добавлено */
    transition: background 0.3s; /* Добавлено */
}

.market-player:hover {
    background: rgba(0, 191, 255, 0.1); /* Обновлено */
}

.player-price {
    color: #7cfc00;
    font-weight: bold;
    margin-left: 15px;
}

#confirmPurchase {
    background: linear-gradient(135deg, #4CAF50, #2E8B57);
    margin-top: 15px;
}

.market-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    align-items: center;
    justify-content: center;
    z-index: 3100;
}

.market-popup {
    background: linear-gradient(145deg, #222, #1a1a1a);
    padding: 25px;
    border-radius: 15px;
    text-align: center;
    width: 90%;
    max-width: 400px;
}

.player-info {
    margin: 20px 0;
    font-size: 18px;
}

.market-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
}

.market-button {
    padding: 12px 25px;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
}

.market-button.confirm {
    background: linear-gradient(135deg, #4CAF50, #2E8B57);
    color: white;
}

.market-button.cancel {
    background: linear-gradient(135deg, #f44336, #FF4500);
    color: white;
}

/* Добавьте в CSS */
.add-player-btn.disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
}

/* В секции market-player стили */
.market-player .player-rating {
    position: static !important;
    font-size: 16px !important;
    transform: none !important;
    color: #00bfff;
    text-shadow: none;
    margin-left: 10px;
}

.market-player .player-nickname {
    position: static !important;
    transform: none !important;
    white-space: normal;
    font-size: 14px;
    max-width: 120px;
    text-overflow: clip;
}

#salaryOverlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 4000;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(5px);
}

#salaryPopup {
    background: linear-gradient(145deg, #222, #1a1a1a);
    padding: 25px;
    border-radius: 15px;
    text-align: center;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 0 20px rgba(0,0,0,0.6);
}

/* Добавьте в секцию style */
@keyframes balanceBlink {
    0% { color: #7cfc00; text-shadow: 0 0 8px rgba(124,252,0,0.5); }
    50% { color: #00ff00; text-shadow: 0 0 15px #00ff00; transform: scale(1.1); }
    100% { color: #7cfc00; text-shadow: 0 0 8px rgba(124,252,0,0.5); }
}

.balance-blink {
    animation: balanceBlink 0.8s ease-in-out;
}

@keyframes millionBlink {
    0% { opacity: 0; transform: translate(-50%,-50%) scale(0.5); }
    20% { opacity: 1; transform: translate(-50%,-50%) scale(1.5); }
    40% { transform: translate(-50%,-50%) scale(0.9); }
    60% { transform: translate(-50%,-50%) scale(1.2); }
    100% { opacity: 0; transform: translate(-50%,-50%) scale(1.5); }
}

#sponsorOverlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 5000;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(5px);
  }

  #sponsorPopup {
    background: linear-gradient(145deg, #1a3a1a, #2d522d);
    padding: 30px;
    border-radius: 15px;
    text-align: center;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 0 20px rgba(0,255,0,0.3);
    border: 2px solid #00ff00;
  }

  .sponsor-amount {
    font-size: 32px;
    color: #7cfc00;
    text-shadow: 0 0 15px #00ff00;
    margin: 20px 0;
    animation: amountGlow 1.5s ease-in-out infinite;
  }

  @keyframes amountGlow {
    0% { opacity: 0.8; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.05); }
    100% { opacity: 0.8; transform: scale(1); }
  }

/* Добавить в секцию стилей */
#penaltyPopup {
  animation: penaltyGlow 1.5s ease-in-out infinite;
}

@keyframes penaltyGlow {
  0% { box-shadow: 0 0 15px rgba(255,0,0,0.3); }
  50% { box-shadow: 0 0 25px rgba(255,0,0,0.5); }
  100% { box-shadow: 0 0 15px rgba(255,0,0,0.3); }
}

/* Добавим в секцию style */
#buyOverlay {
  animation: buyGlow 1.5s ease-in-out infinite;
}

@keyframes buyGlow {
  0% { box-shadow: 0 0 15px rgba(0,191,255,0.3); }
  50% { box-shadow: 0 0 25px rgba(0,191,255,0.5); }
  100% { box-shadow: 0 0 15px rgba(0,191,255,0.3); }
}

#buyPopup {
  background: linear-gradient(145deg, #1a1a2a, #2a1a2a);
  border: 2px solid #00bfff;
}

/* Стили для иконки информации */
#teamSquadPanel h3 .info-icon {
    display: inline-block;
    width: 20px;
    height: 20px;
    line-height: 20px;
    border-radius: 50%;
    background: #00bfff;
    color: white;
    text-align: center;
    cursor: pointer;
    font-style: normal;
    font-family: 'Arial', sans-serif;
    margin-left: 8px;
    transition: all 0.3s ease;
    box-shadow: 0 0 8px rgba(0, 191, 255, 0.3);
}

#teamSquadPanel h3 .info-icon:hover {
    background: #0099cc;
    transform: scale(1.1) rotate(360deg);
    box-shadow: 0 0 12px rgba(0, 191, 255, 0.5);
}

/* Стили для меню информации */
.info-menu {
    position: fixed;
    background: rgba(0, 0, 0, 0.95);
    color: white;
    padding: 12px 16px;
    border-radius: 8px;
    border: 1px solid #00bfff;
    box-shadow: 0 0 15px rgba(0, 191, 255, 0.4);
    max-width: 300px;
    display: none;
    z-index: 10000;
    font-size: 14px;
    line-height: 1.4;
    backdrop-filter: blur(3px);
    animation: menuAppear 0.3s ease-out;
}

@keyframes menuAppear {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.info-menu::after {
    content: '';
    position: absolute;
    bottom: 100%;
    left: 20px;
    border-width: 8px;
    border-style: solid;
    border-color: transparent transparent #00bfff transparent;
    filter: drop-shadow(0 -2px 2px rgba(0, 0, 0, 0.1));
}

.player-circle.sick {
    border: 3px solid #ff4444 !important;
    box-shadow: 0 0 15px rgba(255, 68, 68, 0.4);
}

.sickness-notification {
    background: rgba(255, 68, 68, 0.9);
    color: white;
    padding: 15px;
    border-radius: 10px;
    margin: 15px 0;
    text-align: center;
    animation: sickPulse 1.5s infinite;
}

@keyframes sickPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

/* Стили для окна болезни */
#sicknessPopup {
  animation: sickPulse 1.5s infinite;
}

@keyframes sickPulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.sickness-details {
  margin: 15px 0;
  color: #ffcccc;
  font-size: 14px;
}

.cup-display {
    position: fixed;
    top: 10px;
    left: 10px;
    font-size: 18px;
    color: white;
    background: rgba(0, 0, 0, 0.7);
    padding: 8px 15px;
    border-radius: 15px;
    z-index: 9999;
    border: 2px solid;
}
.cup-display[data-cup="bronze"] { border-color: #cd7f32; }
.cup-display[data-cup="silver"] { border-color: #c0c0c0; }
.cup-display[data-cup="gold"] { border-color: #ffd700; }

.game-over-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #ff4444;
    font-size: 24px;
    text-align: center;
}

.menu-button {
    position: fixed;
    top: 65px;
    left: 15px;
    padding: 12px 25px;
    font-size: 16px;
    font-weight: 600;
    background: linear-gradient(135deg, #0066cc, #00bfff);
    color: white;
    text-decoration: none;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    z-index: 10000;
    display: flex;
    align-items: center;
    gap: 8px;
}

.menu-button::before {
    content: "←";
    font-size: 20px;
}

.menu-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.25);
    background: linear-gradient(135deg, #0052a3, #0099cc);
}

.menu-button:active {
    transform: translateY(1px);
}

@keyframes cupPrizeBlink {
    0% { opacity: 0; transform: translate(-50%,-50%) scale(0.5); }
    20% { opacity: 1; transform: translate(-50%,-50%) scale(1.5); }
    40% { transform: translate(-50%,-50%) scale(0.9); }
    60% { transform: translate(-50%,-50%) scale(1.2); }
    100% { opacity: 0; transform: translate(-50%,-50%) scale(1.5); }
}

.cup-prize-animation {
    display: block;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%,-50%);
    z-index: 10000;
    pointer-events: none;
    font-size: 40px;
    font-weight: bold;
    animation: cupPrizeBlink 1.5s ease-out;
    text-shadow: 0 0 20px rgba(255,255,255,0.5);
}

.cup-prize-animation.bronze { color: #cd7f32; }
.cup-prize-animation.silver { color: #c0c0c0; }
.cup-prize-animation.gold { color: #ffd700; }

#teamsOverlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 3500;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(5px);
}

#teamsPopup {
    background: linear-gradient(145deg, #222, #1a1a1a);
    padding: 20px;
    border-radius: 15px;
    width: 90%;
    max-width: 700px;
    max-height: 80vh;
    display: flex;
    flex-direction: column;
    box-shadow: 0 0 20px rgba(0,0,0,0.6);
}

.team-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    overflow-y: auto;
    flex: 1;
    padding-right: 8px;
    margin-bottom: 15px;
}

.team-item {
    display: flex;
    align-items: center;
    padding: 12px;
    background: rgba(0, 191, 255, 0.05);
    border-radius: 8px;
    transition: background 0.3s;
}

.team-item:hover {
    background: rgba(0, 191, 255, 0.1);
}

.team-rank {
    width: 40px;
    text-align: center;
    font-weight: bold;
    color: #00bfff;
}

.team-logo-small {
    width: 40px;
    height: 40px;
    margin: 0 15px;
    object-fit: contain;
}

.team-name {
    flex-grow: 1;
    font-size: 14px;
}

.challenges-container {
  display: flex;
  flex-direction: column;
  gap: 15px;
  margin: 20px 0;
}

.challenge-item {
  background: rgba(0, 191, 255, 0.1);
  padding: 15px;
  border-radius: 10px;
  border: 1px solid #00bfff;
  cursor: pointer;
  transition: all 0.3s;
}

.challenge-item:hover {
  background: rgba(0, 191, 255, 0.2);
  transform: translateY(-2px);
}

.challenge-header {
  font-size: 18px;
  color: #00bfff;
  margin-bottom: 10px;
}

.challenge-details {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  font-size: 14px;
}

.challenge-cup {
  display: inline-block;
  padding: 3px 8px;
  border-radius: 5px;
  font-weight: bold;
}

.cup-bronze { background: #cd7f32; }
.cup-silver { background: #c0c0c0; }
.cup-gold { background: #daa520; }
</style>
</head>
<body>
<a href="https://jorayoung.github.io/DraftMenu/" class="menu-button">В меню</a>
<audio id="tapSound" src="tap.mp3"></audio>
<h2>Выберите состав команды</h2>

<div class="position-container" id="gk-container">
  <h3>Вратарь (GK)</h3>
  <div class="players-row"></div>
</div>

<div class="position-container" id="cdm-container">
  <h3>Опорный полузащитник (DM)</h3>
  <div class="players-row"></div>
</div>

<div class="position-container" id="st-container">
  <h3>Нападающий (ST)</h3>
  <div class="players-row"></div>
</div>

<div class="position-container" id="cf-container">
  <h3>Нападающий (ST)</h3>
  <div class="players-row"></div>
</div>

<button id="startButton" onclick="showTeamNameModal()">Начать турнир</button>

<!-- Модальное окно для ввода названия команды -->
<div id="teamNameModal">
  <div id="teamNamePopup">
    <h3>Введите название вашей команды</h3>
    <input type="text" id="teamNameInput" placeholder="Название команды" maxlength="20">
    <button id="confirmTeamName" onclick="confirmTeamName()">Подтвердить</button>
  </div>
</div>

<div id="balanceDisplay" class="balance-display">Баланс: 25 000 000 ₽</div>

<div id="matchOverlay">
  <div id="matchPopup">
   <div class="year-display" id="yearDisplay">Сезон 1</div>
   <div id="topScorersDisplay" class="scorers-display"></div>
    <div id="teamSquadPanel">
  <h3>Состав команды<span class="info-icon">i</span></h3>
  <div id="teamSquadPlayers"></div>
  <div id="infoMenu" class="info-menu">
    Чтобы продать или купить игрока, нажмите на игрока в вашем составе.
  </div>
</div>
    <div id="roundTitle"></div>
    <div class="game-style-buttons">
      <button class="style-button defensive" onclick="setGameStyle('defensive')">Оборонительный</button>
      <button class="style-button balanced selected" onclick="setGameStyle('balanced')">Баланс</button>
      <button class="style-button offensive" onclick="setGameStyle('offensive')">Атакующий</button>
    </div>
    <div class="vs-container">
      <div style="display: flex; flex-direction: column; align-items: center;">
        <div class="player-circle" style="margin-bottom: 25px;" id="teamRatingCircle">
          <div class="player-rating" id="userRatingDisplay"></div>
          <div class="player-nickname">Ваша команда</div>
        </div>
        <div class="team-name-display" id="userTeamName"></div>
      </div>
      <span style="margin: 0 25px; font-size: 28px;">VS</span>
      <div style="display: flex; flex-direction: column; align-items: center;">
        <img id="opponentLogo" alt="Opponent" class="team-logo">
        <div class="team-name-display" id="opponentName"></div>
      </div>
    </div>
    <div id="matchTime" class="match-time">0:00</div>
    <div id="scoreDisplay" class="score">0 : 0</div>
    <div id="eventsContainer" style="min-height: 60px;"></div>
    <p id="matchResult" style="margin: 25px 0; font-size: 20px;"></p>
    <button id="playButton" onclick="playMatch()" style="padding: 12px 25px; font-size: 18px; background-color: #2196F3; color: white; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s;">Играть матч</button>
    <button id="backToMenuButton" onclick="backToMenu()">Вернуться в меню</button>
  </div>
</div>

<div id="statsOverlay">
  <div id="statsPopup">
    <div class="stats-title">Статистика турнира</div>
    <table class="stats-table" id="statsTable">
      <thead>
        <tr>
          <th>Игрок</th>
          <th>Голы</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="goldenBallContainer"></div>
    <button id="closeStatsButton" onclick="closeStats()" style="padding: 12px 25px; font-size: 18px; background-color: #2196F3; color: white; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s; margin-top: 20px; display: block; margin-left: auto; margin-right: auto;">Выйти в меню</button>
    <button id="newSeasonButton" onclick="startNewSeason()" style="padding: 12px 25px; font-size: 18px; background: linear-gradient(135deg, #4CAF50, #2E8B57); color: white; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s; margin-top: 20px; display: none; margin-left: auto; margin-right: auto;">Следующий сезон</button>
  </div>
</div>

<div id="transferOverlay">
    <div id="transferPopup">
        <div class="transfer-title">Предложение на трансфер</div>
        <div class="transfer-players">
            <div class="transfer-player">
                <div class="transfer-player-title">Ваш текущий игрок</div>
                <div id="currentPlayer" class="player-circle gold">
                    <div class="player-rating">75</div>
                    <div class="player-nickname">Игрок</div>
                </div>
            </div>
            <div class="transfer-player">
                <div class="transfer-player-title">Предлагаемый игрок</div>
                <div id="offeredPlayer" class="player-circle gold">
                    <div class="player-rating">80</div>
                    <div class="player-nickname">Игрок</div>
                </div>
            </div>
        </div>
        <div class="transfer-buttons">
            <button class="transfer-button" onclick="acceptTransfer()">Обменять</button>
            <button class="transfer-button reject" onclick="rejectTransfer()">Отказать</button>
        </div>
    </div>
</div>

<!-- Модальное окно тренировки игрока -->
<div id="trainingOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); z-index: 2500; align-items: center; justify-content: center; backdrop-filter: blur(5px);">
  <div id="trainingPopup" style="background: linear-gradient(145deg, #222, #1a1a1a); padding: 30px; border-radius: 15px; width: 95%; max-width: 500px; box-shadow: 0 0 20px rgba(0,0,0,0.6), 0 0 8px rgba(0, 191, 255, 0.15); border: 1px solid rgba(0, 191, 255, 0.1);">
    <h3 style="text-align: center; margin-bottom: 20px; color: #00bfff;">Кого отправить тренироваться? (+5 Рейтинг)</h3>
    <div id="trainingPlayers" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin: 20px 0;"></div>
    <button id="confirmTraining" onclick="confirmTraining()" style="padding: 12px 25px; font-size: 16px; font-weight: 600; background: linear-gradient(135deg, #0066cc, #00bfff); color: white; border: none; border-radius: 25px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: block; margin: 0 auto;">Подтвердить</button>
  </div>
</div>

<div id="newSeasonOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); z-index: 3500; align-items: center; justify-content: center; backdrop-filter: blur(5px);">
  <div style="background: linear-gradient(145deg, #222, #1a1a1a); padding: 30px; border-radius: 15px; width: 95%; max-width: 500px; box-shadow: 0 0 20px rgba(0,0,0,0.6), 0 0 8px rgba(0, 191, 255, 0.15); border: 1px solid rgba(0, 191, 255, 0.1);">
    <h3 style="text-align: center; margin-bottom: 20px; color: #00bfff;">Ваши игроки улучшились (+2 Рейтинг каждому)</h3>
    <div id="improvedPlayers" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin: 20px 0;"></div>
    <button onclick="continueAfterSeason()" style="padding: 12px 25px; font-size: 16px; font-weight: 600; background: linear-gradient(135deg, #0066cc, #00bfff); color: white; border: none; border-radius: 25px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: block; margin: 0 auto;">Продолжить</button>
  </div>
</div>

<div id="sellOverlay">
    <div id="sellPopup">
        <h3 id="sellTitle"></h3>
        <div class="sell-buttons">
            <button class="sell-button confirm" onclick="confirmSell()">Продать</button>
            <button class="sell-button cancel" onclick="cancelSell()">Отмена</button>
        </div>
    </div>
</div>

<!-- Модальное окно рынка -->
<div id="marketOverlay">
    <div id="marketPopup">
        <div class="market-title" id="marketTitle">Рынок игроков</div>
        <div id="marketPlayers"></div>
        <button class="transfer-button" onclick="closeMarket()">Назад</button>
    </div>
</div>

<!-- Модальное окно подтверждения покупки -->
<div id="purchaseOverlay" class="market-overlay">
    <div id="purchasePopup" class="market-popup">
        <h3 id="purchaseTitle"></h3>
        <div class="player-info">
            <span id="playerPrice"></span>
        </div>
        <div class="market-buttons">
            <button class="market-button confirm" onclick="confirmPurchase()">Купить</button>
            <button class="market-button cancel" onclick="closePurchase()">Назад</button>
        </div>
    </div>
</div>

<!-- Модальное окно требования зарплаты -->
<div id="salaryOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); z-index: 4000; align-items: center; justify-content: center; backdrop-filter: blur(5px);">
    <div id="salaryPopup" style="background: linear-gradient(145deg, #222, #1a1a1a); padding: 30px; border-radius: 15px; text-align: center; width: 90%; max-width: 400px;">
        <h3 id="salaryTitle"></h3>
        <div id="salaryAmount" style="font-size: 24px; margin: 20px 0; color: #ff4444;"></div>
        <div class="market-buttons">
            <button class="market-button confirm" onclick="paySalary()">Оплатить</button>
        </div>
    </div>
</div>
<div id="millionAnimation" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%); z-index: 10000; pointer-events: none; font-size: 40px; color: gold; text-shadow: 0 0 20px yellow; animation: millionBlink 1.5s ease-out;">
    +500 000 ₽
</div>


<div id="sponsorOverlay">
  <div id="sponsorPopup">
    <h3>Ваш спонсор выделил бюджет команде!</h3>
    <div class="sponsor-amount" id="sponsorAmount"></div>
    <button class="market-button confirm" onclick="closeSponsorMenu()">Продолжить</button>
  </div>
</div>

<!-- Добавить в тело HTML после других оверлеев -->
<div id="penaltyOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); z-index: 6000; align-items: center; justify-content: center; backdrop-filter: blur(5px);">
  <div id="penaltyPopup" style="background: linear-gradient(145deg, #2a1a1a, #3a1a1a); padding: 30px; border-radius: 15px; text-align: center; width: 90%; max-width: 400px; box-shadow: 0 0 20px rgba(255,0,0,0.3); border: 2px solid #ff4444;">
    <h2 style="color: #ff4444; margin-bottom: 15px;">Штраф</h2>
    <h3 id="penaltyReason" style="margin-bottom: 20px;"></h3>
    <div style="font-size: 24px; margin-bottom: 25px;">1 000 000 ₽</div>
    <button onclick="handlePenaltyPayment()" style="padding: 12px 25px; font-size: 16px; background: linear-gradient(135deg, #cc0000, #ff4444); color: white; border: none; border-radius: 25px; cursor: pointer; transition: all 0.3s;">Оплатить</button>
  </div>
</div>

<!-- Модальное окно предложения покупки -->
<div id="buyOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); z-index: 7000; align-items: center; justify-content: center; backdrop-filter: blur(5px);">
  <div id="buyPopup" style="background: linear-gradient(145deg, #222, #1a1a1a); padding: 30px; border-radius: 15px; text-align: center; width: 90%; max-width: 400px; box-shadow: 0 0 20px rgba(0,0,0,0.6); border: 2px solid #00bfff;">
    <h3 id="buyTitle"></h3>
    <div id="buyPlayerInfo" style="margin: 20px 0;"></div>
    <div class="market-buttons">
      <button class="market-button confirm" onclick="acceptBuyOffer()">Согласиться</button>
      <button class="market-button cancel" onclick="rejectBuyOffer()">Отказать</button>
    </div>
  </div>
</div>

<div id="teamsOverlay">
    <div id="teamsPopup">
        <div class="market-title">Список всех команд</div>
        <div class="team-list" id="teamList"></div>
        <button class="transfer-button" onclick="closeTeamsList()">Назад</button>
    </div>
</div>

<!-- Окно болезни игрока -->
<div id="sicknessOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); z-index: 8000; align-items: center; justify-content: center; backdrop-filter: blur(5px);">
  <div id="sicknessPopup" style="background: linear-gradient(145deg, #2a1a1a, #3a1a1a); padding: 30px; border-radius: 15px; text-align: center; width: 90%; max-width: 400px; box-shadow: 0 0 20px rgba(255,68,68,0.3); border: 2px solid #ff4444;">
    <h2 style="color: #ff4444; margin-bottom: 15px;">⚠️ Игрок заболел!</h2>
    <div id="sicknessMessage" style="margin-bottom: 25px; font-size: 18px;"></div>
    <button onclick="closeSicknessMenu()" style="padding: 12px 25px; font-size: 16px; background: linear-gradient(135deg, #cc0000, #ff4444); color: white; border: none; border-radius: 25px; cursor: pointer; transition: all 0.3s;">Продолжить</button>
  </div>
</div>

<div id="cupDisplay" class="cup-display">Серебряный Кубок</div>

<div id="cupPrizeAnimation" class="cup-prize-animation" style="display: none;"></div>

<button class="menu-button" id="challengesButton" onclick="showChallengesMenu()" style="top: 125px;">Челленджи</button>

<!-- Модальное окно челленджей -->
<div id="challengesOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; align-items: center; justify-content: center;">
  <div id="challengesPopup" style="background: linear-gradient(145deg, #222, #1a1a1a); padding: 25px; border-radius: 15px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;">
    <h2 style="color: #00bfff; text-align: center;">Выберите челлендж</h2>
    <div id="challengesList" class="challenges-container"></div>
<button onclick="closeChallengesMenu()" 
        style="display: block;
               margin: 20px auto 0;
               padding: 12px 25px;
               font-size: 16px;
               font-weight: 600;
               background: linear-gradient(135deg, #0066cc, #00bfff);
               color: white;
               border: none;
               border-radius: 25px;
               cursor: pointer;
               transition: all 0.3s;
               position: relative;
               overflow: hidden;
               box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
    Назад
</button>
  </div>
</div>
<script>
  // Защита от открытия консоли
  document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
  });
  
  document.addEventListener('keydown', function(e) {
    // Блокировка F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+Shift+C, Ctrl+U
    if (e.key === 'F12' || 
        (e.ctrlKey && e.shiftKey && e.key === 'I') || 
        (e.ctrlKey && e.shiftKey && e.key === 'J') ||
        (e.ctrlKey && e.shiftKey && e.key === 'C') ||
        (e.ctrlKey && e.key === 'U')) {
      e.preventDefault();
    }
  });
  


  const positions = {
    GK: { 
        container: document.getElementById('gk-container').querySelector('.players-row'), 
        selected: null, 
        players: [
            { rating: 95, nickname: "Nsk" },
            { rating: 91, nickname: "-nK" },
            { rating: 88, nickname: "Савитар" },
            { rating: 83, nickname: "ya tyanochka" },
            { rating: 84, nickname: "Fade Away" },
            { rating: 76, nickname: "diseased" },
            { rating: 82, nickname: "drak" },
            { rating: 65, nickname: "Nick" },
            { rating: 59, nickname: "natsukasiy" },
            { rating: 75, nickname: "Björn" },
            { rating: 59, nickname: "pluto" },
            { rating: 46, nickname: "Nagiev" },
            { rating: 53, nickname: "oskasya" },
            { rating: 55, nickname: "Sunex" },
            { rating: 60, nickname: "lis" },
            { rating: 88, nickname: "рагуль" },
            { rating: 64, nickname: "LS" },
            { rating: 65, nickname: "пиушка" },
            { rating: 41, nickname: "NO_ON" },
            { rating: 43, nickname: "Sky tempi" },
            { rating: 54, nickname: "Мама Вонти" },
            { rating: 56, nickname: "UCHIHAS" },
            { rating: 42, nickname: "denji-" },
            { rating: 54, nickname: "yowai" },
            { rating: 76, nickname: "Yoze" },
            { rating: 56, nickname: "servi" },
            { rating: 54, nickname: "Василий_Шатуновский." },
            { rating: 64, nickname: "Yedlin" },
            { rating: 89, nickname: "Madcon" },
            { rating: 82, nickname: "cotty" },
            { rating: 75, nickname: "Marco Reus" },
            { rating: 59, nickname: "zxz" },
            { rating: 45, nickname: "Трип" },
            { rating: 91, nickname: "Maddude" },
            { rating: 41, nickname: "Shaky" },
            { rating: 50, nickname: "Клаудиньо" },
            { rating: 48, nickname: "Yorho" },
            { rating: 50, nickname: "Avis" },
            { rating: 41, nickname: "Zметана" },
            { rating: 49, nickname: "aster" },
            { rating: 52, nickname: "Аустролопитек" },
            { rating: 44, nickname: "marcelo." },
            { rating: 49, nickname: "Neonit" },
            { rating: 44, nickname: "дыня" },
            { rating: 75, nickname: "Фругер" },
            { rating: 55, nickname: "Kifla" },
            { rating: 48, nickname: "b⁸" },
            { rating: 50, nickname: "bonusbuychik" },
            { rating: 68, nickname: "Фругер" },
            { rating: 48, nickname: "pro0ch" },
            { rating: 49, nickname: "корж" },
            { rating: 50, nickname: "feli4ka" },
            { rating: 80, nickname: "akashi" },
            { rating: 57, nickname: "A-line" },
            { rating: 50, nickname: "Puerto" },
            { rating: 69, nickname: "pyrokinesis" },
            { rating: 88, nickname: "skit" },
            { rating: 70, nickname: "Elv1sSs" },
        ]
    },
    CDM: { 
        container: document.getElementById('cdm-container').querySelector('.players-row'), 
        selected: null, 
        players: [
            { rating: 93, nickname: "Wenamka" },
            { rating: 95, nickname: "Twistik" },
            { rating: 91, nickname: "Murphy" },
            { rating: 85, nickname: "koopinoff" },
            { rating: 89, nickname: "yokk" },
            { rating: 80, nickname: "шиммер" },
            { rating: 76, nickname: "zark-" },
            { rating: 65, nickname: "ottop" },
            { rating: 70, nickname: "wool" },
            { rating: 64, nickname: "Big boo" },
            { rating: 53, nickname: "friend shiro" },
            { rating: 52, nickname: "yeapez" },
            { rating: 57, nickname: "DENRELAS" },
            { rating: 55, nickname: "zxc" },
            { rating: 57, nickname: "13setz" },
            { rating: 90, nickname: "aero" },
            { rating: 80, nickname: "IIIHA" },
            { rating: 79, nickname: "boda" },
            { rating: 61, nickname: "pure" },  
            { rating: 54, nickname: "Scqxd" },
            { rating: 85, nickname: "adriano" }, 
            { rating: 90, nickname: "Solence" }, 
            { rating: 72, nickname: "Impo" }, 
            { rating: 52, nickname: "Jakov" }, 
            { rating: 63, nickname: "MaSsik" }, 
            { rating: 51, nickname: "чпек" }, 
            { rating: 57, nickname: "Candy" }, 
            { rating: 79, nickname: "Emkay" }, 
            { rating: 78, nickname: "Noshka" },
            { rating: 68, nickname: "jesslach" },
            { rating: 50, nickname: "fiograf " },
            { rating: 88, nickname: "Bachira" },
            { rating: 90, nickname: "modric8" },
            { rating: 94, nickname: "Anddy" },
            { rating: 89, nickname: "ıIıIİıİIımusic" },
            { rating: 85, nickname: "soul" },
            { rating: 52, nickname: "Shtrembl" },
            { rating: 45, nickname: "ʀʜᴇɪɴᴍᴇᴛᴀʟ" },
            { rating: 56, nickname: "alyosha" },
            { rating: 57, nickname: "alery" },
            { rating: 49, nickname: "PPL217" },
            { rating: 40, nickname: "FoLneZ" },
            { rating: 83, nickname: "laamb" },
            { rating: 50, nickname: "exportdefault" },
            { rating: 52, nickname: "Abramov" },
            { rating: 61, nickname: "бульбаш" },
            { rating: 56, nickname: "kc" },
            { rating: 53, nickname: "𝖪𝗈𝗌𝗈𝖻𝖾𝗋" },
            { rating: 69, nickname: "UHvBnDestroyed" },
            { rating: 51, nickname: "choppa-in-pants" },
            { rating: 45, nickname: "kistyyx" },
            { rating: 54, nickname: "whiwens" },
            { rating: 53, nickname: "kuchoo" },
            { rating: 61, nickname: "woqh" },
            { rating: 50, nickname: "F1nN3r" },
            { rating: 51, nickname: "Infinite" },
            { rating: 56, nickname: "Modrić" },
            { rating: 78, nickname: "quinteros" },
      ]
    },
    ST: { 
        container: document.getElementById('st-container').querySelector('.players-row'), 
        selected: null, 
        players: [
            { rating: 95, nickname: "Kor" },
            { rating: 91, nickname: "Filp" },
            { rating: 89, nickname: "lopo" },
            { rating: 81, nickname: "Tokito" },
            { rating: 87, nickname: "златан" },
            { rating: 77, nickname: "SUS" },
            { rating: 79, nickname: "Kiw" },
            { rating: 79, nickname: "Cyanide" },
            { rating: 74, nickname: "Разберусь" },
            { rating: 74, nickname: "Lean" },
            { rating: 58, nickname: "Jora young" },
            { rating: 53, nickname: "godmoves" },
            { rating: 49, nickname: "Verty" },
            { rating: 50, nickname: "fart" },
            { rating: 53, nickname: "тихий парень" },
            { rating: 89, nickname: "elox." },
            { rating: 69, nickname: "Жмых" },
            { rating: 63, nickname: "zvezzda" },
            { rating: 58, nickname: "dark_pr1nce" },
            { rating: 49, nickname: "rydii" },
            { rating: 69, nickname: "Timoxa196" },
            { rating: 81, nickname: "leT1m" },
            { rating: 60, nickname: "deko" },
            { rating: 49, nickname: "Nagi" },
            { rating: 67, nickname: "Волька" },
            { rating: 59, nickname: "буся" },
            { rating: 66, nickname: "iRaJ-" },
            { rating: 90, nickname: "Oven" },
            { rating: 84, nickname: "gunyasha" },
            { rating: 43, nickname: "гамик" },
            { rating: 77, nickname: "R3venGe-" },
            { rating: 46, nickname: "BeNzEmA" },
            { rating: 95, nickname: "KING" },
            { rating: 40, nickname: "Sivohin" },
            { rating: 40, nickname: "MR. LUKA" },
            { rating: 40, nickname: "plxdy" },
            { rating: 42, nickname: "yupix" },
            { rating: 44, nickname: "dance tiger" },
            { rating: 58, nickname: "niko" },
            { rating: 46, nickname: "BONYA" },
            { rating: 51, nickname: "Falluntg" },
            { rating: 55, nickname: "tr1gand" },
            { rating: 56, nickname: "Metro Boomin" },
            { rating: 66, nickname: "kidaiblock" },
            { rating: 63, nickname: "велосипедистка ленка" },
            { rating: 58, nickname: "лизон СОСИсон" },
            { rating: 61, nickname: "Def" },
            { rating: 87, nickname: "Kawhi Leonard" },
            { rating: 68, nickname: "Skezzqa" },
            { rating: 64, nickname: "Tossico" },
            { rating: 53, nickname: "ifq" },
            { rating: 67, nickname: "Mokujin" },
            { rating: 45, nickname: "Trevors" },
            { rating: 47, nickname: "Owenau" },
            { rating: 50, nickname: "_u1trex_" },
            { rating: 57, nickname: "Isagi" },
            { rating: 58, nickname: "emnay" },

        ]
    },
    CF: { 
        container: document.getElementById('cf-container').querySelector('.players-row'), 
        selected: null, 
        players: [
            { rating: 92, nickname: "ninowka" },
            { rating: 90, nickname: "step-" },
            { rating: 95, nickname: "Pyro" },
            { rating: 88, nickname: "iks" },
            { rating: 83, nickname: "parma2013" },
            { rating: 80, nickname: "Philip Brooks" },
            { rating: 78, nickname: "sproty" },
            { rating: 73, nickname: "berserk" },
            { rating: 73, nickname: "iwd" },
            { rating: 67, nickname: "Wilian31" },
            { rating: 53, nickname: "Malasi" },
            { rating: 54, nickname: "chesdes" },
            { rating: 40, nickname: "ЯРЫЙ" },
            { rating: 50, nickname: "Илуа" },
            { rating: 40, nickname: "PenguinN10" },
            { rating: 85, nickname: "Shepard" },
            { rating: 60, nickname: "Guus" },
            { rating: 60, nickname: "drakula" },
            { rating: 54, nickname: "zaraki" },
            { rating: 47, nickname: "holodok" },
            { rating: 52, nickname: "Chex" },
            { rating: 60, nickname: "butterfly" },
            { rating: 76, nickname: "Eazw" },
            { rating: 50, nickname: "flourgame" },
            { rating: 67, nickname: "Yapo" },
            { rating: 49, nickname: "Данис" },
            { rating: 95, nickname: "aMp" },
            { rating: 90, nickname: "Avr" },
            { rating: 91, nickname: "Х@тико" },
            { rating: 77, nickname: "Rasputin" },
            { rating: 45, nickname: "nevzyy" },
            { rating: 45, nickname: "convulsive_seizures" },
            { rating: 95, nickname: "Kl" },
            { rating: 65, nickname: "mY_ruleZ" },
            { rating: 92, nickname: "Levaldo" },
            { rating: 50, nickname: "GRENKA" },
            { rating: 44, nickname: "Faya (ы)" },
            { rating: 51, nickname: "Hex" },
            { rating: 43, nickname: "S1lan4ik" },
            { rating: 50, nickname: "korv1" },
            { rating: 80, nickname: "Yamakasi" },
            { rating: 55, nickname: "карпен" },
            { rating: 59, nickname: "krizzen" },
            { rating: 62, nickname: "jz" },
            { rating: 63, nickname: "cdG" },
            { rating: 60, nickname: "Glöw" },
            { rating: 59, nickname: "dj sex" },
            { rating: 75, nickname: "rj" },
            { rating: 81, nickname: "sido" },
            { rating: 55, nickname: "Durex" },
            { rating: 67, nickname: "Supersonic" },
            { rating: 53, nickname: "WolfySX" },
            { rating: 48, nickname: "снфр" },
            { rating: 47, nickname: "Versus" },
            { rating: 49, nickname: "nyam." },
            { rating: 51, nickname: "UaZziK" },
            { rating: 58, nickname: "neymarjr" },
        ]
    }
};

  const numPlayersToShow = 5;
  const startButton = document.getElementById('startButton');

  const opponentTeams = [
    { name: "GreenLand", logo: "logo_GreenLand.png", rating: 72 },
    { name: "KUMYS POWER", logo: "logo_KUMYS POWER.png", rating: 69 },
    { name: "One more pass", logo: "logo_One more pass.png", rating: 69 },
    { name: "IDM", logo: "logo_IDM.png", rating: 60 },
    { name: "SHULC RS", logo: "logo_SHULC RS.png", rating: 55 },
    { name: "FC United", logo: "logo_FC United.png", rating: 68 },
    { name: "Karasuno", logo: "logo_Karasuno.png", rating: 58 },
    { name: "The Last Dance", logo: "logo_The Last Dance.png", rating: 47 },
    { name: "ХК Чертаново 2012", logo: "logo_ХК Чертаново 2012.png", rating: 50 },
    { name: "Anubis", logo: "logo_Anubis.png", rating: 45 },
    { name: "Bloodstream", logo: "logo_Bloodstream.png", rating: 57 },
    { name: "Anji", logo: "logo_Anji.png", rating: 55 },
    { name: "Оксидиум", logo: "logo_Оксидиум.png", rating: 50 },
    { name: "Дети Солнца", logo: "logo_Дети Солнца.png", rating: 47 },
    { name: "Хомяки", logo: "logo_Хомяки.png", rating: 45 },
    { name: "Bolich", logo: "logo_Bolich.png", rating: 43 },
    { name: "NoStuff", logo: "logo_NoStuff.png", rating: 44 },
    { name: "Monkey Business", logo: "logo_Monkey Business.png", rating: 51 },
    { name: "Everton", logo: "logo_Everton.png", rating: 40 },
    { name: "Злые бобры", logo: "logo_Злые бобры.png", rating: 38 },
    { name: "Water Heroes", logo: "logo_Water Heroes.png", rating: 40 },
    { name: "Печенеги", logo: "logo_Печенеги.png", rating: 41 },
    { name: "Братеки", logo: "logo_Братеки.png", rating: 34 },
    { name: "HC Platina", logo: "logo_HC Platina.png", rating: 33 },
    { name: "смеШАРики", logo: "logo_смеШАРики.png", rating: 31 },
    { name: "FC Miami Mamoball", logo: "logo_FC Miami Mamoball.png", rating: 25 },
    { name: "TikTok House", logo: "logo_TikTok House.png", rating: 22 },
    { name: "Moon Lovers", logo: "logo_Moon Lovers.png", rating: 27 },
    { name: "Поколение Чудес", logo: "logo_Поколение Чудес.png", rating: 20 },
    { name: "edelweiss", logo: "logo_edelweiss.png", rating: 20 },
    { name: "AS Tatarstan", logo: "logo_AS Tatarstan.png", rating: 70 },
    { name: "Medvjedi", logo: "logo_Medvjedi.png", rating: 64 },
    { name: "SkyRed", logo: "logo_SkyRed.png", rating: 33 },
    { name: "Вечерние звезды", logo: "logo_Вечерние звезды.png", rating: 50 },
    { name: "Bounty", logo: "logo_Bounty.png", rating: 40 },
    { name: "The Beatles", logo: "logo_The Beatles.png", rating: 38 },
    { name: "FC6", logo: "logo_FC6.png", rating: 18 },
    { name: "Томь", logo: "logo_Томь.png", rating: 19 },
    { name: "Yokohama City", logo: "logo_Yokohama City.png", rating: 40 },
    { name: "Metallurg", logo: "logo_Metallurg.png", rating: 44 },
    { name: "Smurfiki", logo: "logo_Smurfiki.png", rating: 64 },
    { name: "Grusteam", logo: "logo_Grusteam.png", rating: 63 },
    { name: "So EZ", logo: "logo_So EZ.png", rating: 52 },
    { name: "The Evil Agents", logo: "logo_The Evil Agents.png", rating: 50 },
    { name: "Freak Circus", logo: "logo_Freak Circus.png", rating: 50 },
    { name: "Manchester United", logo: "logo_Manchester United.png", rating: 40 },
    { name: "Wings Bird", logo: "logo_Wings Bird.png", rating: 40 },
    { name: "Interment", logo: "logo_Interment.png", rating: 20 },
    { name: "Internet Heroes", logo: "logo_Internet Heroes.png", rating: 30 },
    { name: "TMNT", logo: "logo_TMNT.png", rating: 40 },
    { name: "FEAR", logo: "logo_FEAR.png", rating: 65 },
    { name: "Flyin' Škrtels", logo: "logo_Fly.png", rating: 65 },
    { name: "Ghouls", logo: "logo_Ghouls.png", rating: 45 },
    { name: "Legendary Stars", logo: "logo_Legendary Stars.png", rating: 50 },
    { name: "Pornhub", logo: "logo_Pornhub.png", rating: 50 },
    { name: "HaxMill City", logo: "logo_HaxMill City.png", rating: 20 },
    { name: "Need Music", logo: "logo_Need Music.png", rating: 20 },
    { name: "HC Glass", logo: "logo_HC Glass.png", rating: 40 },
    { name: "Karabah", logo: "logo_Karabah.png", rating: 20 },
    { name: "Шайка-04", logo: "logo_Шайка-04.png", rating: 37 },
    { name: "HC Pussy Squad", logo: "logo_HC Pussy Squad.png", rating: 58 },
    { name: "Joga Bonito", logo: "logo_Joga Bonito.png", rating: 60 },
    { name: "Bastard München", logo: "logo_Bastard Munchen.png", rating: 60 },
    { name: "qwerty", logo: "logo_qwerty.png", rating: 61 },
    { name: "Excalibur", logo: "logo_Excalibur.png", rating: 58 },
    { name: "Warriors", logo: "logo_Warriors.png", rating: 59 },
    { name: "Бей-Беги", logo: "logo_Бей-Беги.png", rating: 55 },
    { name: "HC Florida", logo: "logo_HC Florida.png", rating: 57 },
    { name: "Orgasm Nostradamus", logo: "logo_Orgasm Nostradamus.png", rating: 60 },
    { name: "AKATSUKI.DFA.UA", logo: "logo_AKATSUKIDFAUA.png", rating: 60 },
    { name: "Spitfire Team", logo: "logo_Spitfire Team.png", rating: 65 },
    { name: "Гомофобы", logo: "logo_Гомофобы.png", rating: 43 },
    { name: "Black Leopards", logo: "logo_Black Leopards.png", rating: 40 },
    { name: "квадрат", logo: "logo_квадрат.png", rating: 46 },
    { name: "Team Clasha", logo: "logo_Team Clasha.png", rating: 45 },
    { name: "Team Slaves", logo: "logo_Team Slaves.png", rating: 38 },
    { name: "FLHAX.FUN -hat", logo: "logo_FLHAXFUN -hat.png", rating: 40 },
    { name: "Battletoads", logo: "logo_Battletoads.png", rating: 45 },
    { name: "EXE", logo: "logo_EXE.png", rating: 40 },
    { name: "FC United-2", logo: "logo_FC United-2.png", rating: 40 },
    { name: "Тончайшие Механизмы", logo: "logo_Тончайшие Механизмы.png", rating: 40 },
    { name: "Сборная Двача", logo: "logo_Сборная Двача.png", rating: 38 },
    { name: "malinaboys", logo: "logo_malinaboys.png", rating: 48 },
    { name: "Rebel Boxes", logo: "logo_Rebel Boxes.png", rating: 46 },
    { name: "Seattle", logo: "logo_Seattle.png", rating: 45 },
    { name: "HC Orlando Pirates", logo: "logo_HC Orlando Pirates.png", rating: 39 },
    { name: "Team Stefan", logo: "logo_Team Stefan.png", rating: 30 },
    { name: "FC Living Stars", logo: "logo_FC Living Stars.png", rating: 27 },
    { name: "ХК Чертаново 2013", logo: "logo_ХК Чертаново 2013.png", rating: 22 },
    { name: "Vision Sun", logo: "logo_Vision Sun.png", rating: 23 },
    { name: "POLET", logo: "logo_POLET.png", rating: 20 },
    { name: "Turbo Dribblers", logo: "logo_Turbo Dribblers.png", rating: 20 },
    { name: "Vegestore", logo: "logo_Vegestore.png", rating: 20 },
    { name: "PAOK", logo: "logo_PAOK.png", rating: 22 },
    { name: "WOF UNITED", logo: "logo_WOF UNITED.png", rating: 25 },
    { name: "FC United Academy", logo: "logo_FC United Academy.png", rating: 38 },
    { name: "HaxMill City-2", logo: "logo_HaxMill City-2.png", rating: 20 },
    { name: "Persik Squad", logo: "logo_Persik Squad.png", rating: 8 },
    { name: "GoodCape", logo: "logo_GoodCape.png", rating: 12 },
    { name: "Bayer 04 Haxball", logo: "logo_Bayer 04 Haxball.png", rating: 10 },
    { name: "EXTRAPOLATION 140", logo: "logo_EXTRAPOLATION 140.png", rating: 55 },
    { name: "WE PLAY AFTER SCHOOL", logo: "logo_WE PLAY AFTER SCHOOL.png", rating: 55 },
    { name: "КБ", logo: "logo_КБ.png", rating: 40 },
    { name: "FLASP YOUNGSTERS", logo: "logo_FLASP YOUNGSTERS.png", rating: 40 },
    { name: "HC Sleepy Souls", logo: "logo_HC Sleepy Souls.png", rating: 25 },

];

let currentRound = 32;
let currentYear = 1;
let userTeamRating = 0;
let currentOpponent = null;
let matchInterval = null;
let currentTime = 0;
let userGoals = 0;
let opponentGoals = 0;
let goalEvents = [];
let isMatchActive = false; // Добавьте в начало раздела с переменными
let isOvertime = false;
let balance = Math.floor(Math.random() * (27500000 - 1000000 + 1)) + 1000000;
let currentSellingPlayer = null;
let userTeamName = "Ваша команда";
let usedOpponents = [];
let scorers = {}; // Object to track player goals
let allTimeScorers = {}; // Для хранения всей статистики
let seasonScorers = {};  // Для хранения статистики текущего сезона
let tournamentWon = false;
let gameStyle = 'balanced'; // По умолчанию баланс
let sickPlayers = []; // Массив для хранения больных игроков
let sicknessActive = false; // Флаг активности болезни
let isInLowerBracket = false; // Находится ли игрок в нижней сетке
let lowerBracketRound = 0; // Текущий раунд в нижней сетке
let isGameOver = false;
let isChallengeMode = false;
let currentChallenge = null;
let goldCups = 0;
let silverCups = 0;
let bronzeCups = 0;
let currentCup = 'silver'; // Начальный кубок
const CUP_RANGES = {
    bronze: { min: 0, max: 26 },
    silver: { min: 27, max: 57 },
    gold: { min: 58, max: 100 }
};

// Функция для установки стиля игры
function setGameStyle(style) {
    gameStyle = style;
    // Обновляем визуальное выделение кнопок
    document.querySelectorAll('.style-button').forEach(btn => {
        btn.classList.remove('selected');
    });
    document.querySelector(`.style-button.${style}`).classList.add('selected');
}

// Функция для показа модального окна с вводом названия команды
function showTeamNameModal() {
    if (!checkAllSelected()) {
        alert("Пожалуйста, выберите игроков на всех позициях!");
        return;
    }
    document.getElementById('teamNameModal').style.display = 'flex';
}

// Функция для подтверждения названия команды
function confirmTeamName() {
    // Если активирован режим челленджа
    if (isChallengeMode) {
        // Устанавливаем название команды из выбранного челленджа
        userTeamName = currentChallenge ? 
            Object.keys(challenges).find(key => challenges[key] === currentChallenge) : 
            "Челлендж";
        
        // Скрываем модальное окно ввода названия
        document.getElementById('teamNameModal').style.display = 'none';
        
        // Запускаем турнир с предустановленными параметрами
        startTournament();
        return;
    }

    // Стандартная обработка для обычного режима
    const nameInput = document.getElementById('teamNameInput');
    const teamName = nameInput.value.trim();

    // Проверка на пустое название
    if (teamName === '') {
        alert("Пожалуйста, введите название команды!");
        return;
    }

    // Проверка на минимальную длину названия
    if (teamName.length < 3) {
        alert("Название команды должно содержать минимум 3 символа!");
        return;
    }

    // Проверка на максимальную длину
    if (teamName.length > 20) {
        alert("Название команды не должно превышать 20 символов!");
        return;
    }

    // Установка названия команды
    userTeamName = teamName;

    // Скрытие модального окна
    document.getElementById('teamNameModal').style.display = 'none';

    // Запуск турнира
    startTournament();
    
    // Скрытие кнопки челленджей после подтверждения
    document.getElementById('challengesButton').style.display = 'none';
}

function backToMenu() {
  if (isChallengeMode) {
    window.location.reload(); // Полная перезагрузка для сброса челленджа
  } else {
    window.location.href = "https://jorayoung.github.io/DraftMenu/";
  }
}

function getRandomScorer(position) {
    if (position === "GK") {
        // Шанс 1%, что вратарь забьет гол
        if (Math.random() < 0.01) {
            return positions[position].selected.nickname;
        }
        return null;
    }
    
    const players = positions[position].players;
    const activePlayers = players.filter(p => positions[position].selected && 
        positions[position].selected.nickname === p.nickname);
    
    if (activePlayers.length > 0) {
        return activePlayers[0].nickname;
    }
    
    const availablePlayers = positions[position].players;
    if (availablePlayers.length > 0) {
        return availablePlayers[Math.floor(Math.random() * availablePlayers.length)].nickname;
    }
    return "Игрок";
}

function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

function getNextOpponent() {
    const { min, max } = CUP_RANGES[currentCup];
    const availableTeams = opponentTeams.filter(team => 
        team.rating >= min && 
        team.rating <= max && 
        !usedOpponents.includes(team.name)
    );

    if (availableTeams.length === 0) {
        usedOpponents = [];
        return opponentTeams[Math.floor(Math.random() * opponentTeams.length)];
    }

    // Сортируем по рейтингу и добавляем весовые коэффициенты
    availableTeams.sort((a, b) => b.rating - a.rating);
    const weights = availableTeams.map((_, index) => 
        (availableTeams.length - index) + Math.random() * 3
    );

    const sumWeights = weights.reduce((a, b) => a + b, 0);
    let random = Math.random() * sumWeights;
    
    for (let i = 0; i < availableTeams.length; i++) {
        if (random < weights[i]) return availableTeams[i];
        random -= weights[i];
    }
    
    return availableTeams[0];
}

function showPlayers(position) {
  shuffleArray(positions[position].players);
  positions[position].container.innerHTML = '';



    for (let i = 0; i < numPlayersToShow; i++) {
        if (!positions[position].players[i]) continue;
        const playerData = positions[position].players[i];
        


        const playerWrapper = document.createElement('div');
        playerWrapper.className = 'player-wrapper';
        
        const playerCircle = document.createElement('div');
        playerCircle.className = 'player-circle';
        playerCircle.dataset.rating = playerData.rating;
        playerCircle.dataset.nickname = playerData.nickname;
        
        if (playerData.rating >= 40 && playerData.rating <= 60) {
            playerCircle.classList.add('bronze');
        } else if (playerData.rating >= 61 && playerData.rating <= 80) {
            playerCircle.classList.add('silver');
        } else if (playerData.rating >= 81 && playerData.rating <= 99) {
            playerCircle.classList.add('gold');
        } else if (playerData.rating >= 100 && playerData.rating <= 110) {
            playerCircle.classList.add('red');
        }
        
        const ratingDiv = document.createElement('div');
        ratingDiv.className = 'player-rating';
        ratingDiv.textContent = playerData.rating;
        
        const nicknameDiv = document.createElement('div');
        nicknameDiv.className = 'player-nickname';
        nicknameDiv.textContent = playerData.nickname;
        

positions[position].players.forEach(playerData => {
        playerCircle.appendChild(ratingDiv);
        playerCircle.appendChild(nicknameDiv);
        playerWrapper.appendChild(playerCircle);
  });        


        playerCircle.addEventListener('click', () => {
            const allPlayers = positions[position].container.querySelectorAll('.player-circle');
            allPlayers.forEach(p => p.classList.remove('selected'));
            
            playerCircle.classList.add('selected');
            positions[position].selected = playerData;
            
            if (checkAllSelected()) {
                startButton.style.display = 'block';
            } else {
                startButton.style.display = 'none';
            }
        if (isChallengeMode) {
    document.getElementById('challengesButton').style.display = 'none';
  }
});
        
        positions[position].container.appendChild(playerWrapper);
    }
}

function checkAllSelected() {
    let allSelected = true;
    for (const position in positions) {
        if (!positions[position].selected) {
            allSelected = false;
            break;
        }
    }
    
    // Блокировать кнопку старта матча
    const startBtn = document.getElementById('playButton');
    if (startBtn) {
        startBtn.disabled = !allSelected;
        startBtn.style.opacity = allSelected ? 1 : 0.5;
        startBtn.style.cursor = allSelected ? 'pointer' : 'not-allowed';
    }
    
    return allSelected;
}

function calculateUserTeamRating() {
    let totalRating = 0;
    let count = 0;
    for (const position in positions) {
        if (positions[position].selected) {
            totalRating += positions[position].selected.rating;
            count++;
        }
    }
    return Math.round(totalRating / count);
}

function generateGoalEvents(userRating, opponentRating) {
    const events = [];
    const matchDuration = 16;
    const ratingDifference = userRating - opponentRating;
    
    // Модификаторы в зависимости от стиля игры
    let userGoalModifier = 1;
    let opponentGoalModifier = 1;
    
    if (gameStyle === 'defensive') {
        userGoalModifier = 0.5;
        opponentGoalModifier = 0.5;
    } else if (gameStyle === 'offensive') {
        userGoalModifier = 2;
        opponentGoalModifier = 2;
    }
    
    const userGoalProbability = (0.4 + (0.5 * ratingDifference / 100) + (Math.random() * 0.17 - 0.085)) * userGoalModifier;
    const opponentGoalProbability = (0.4 - (0.3 * ratingDifference / 100) + (Math.random() * 0.17 - 0.085)) * opponentGoalModifier;
    
    const totalGoals = Math.max(1, Math.min(10, Math.round((3 + (userRating + opponentRating)/40 + (Math.random() * 3.4 - 1.7)) * (gameStyle === 'defensive' ? 0.5 : gameStyle === 'offensive' ? 2 : 1))));
    
    const goalTimes = [];
    for (let i = 0; i < totalGoals; i++) {
        goalTimes.push(Math.floor(Math.random() * matchDuration));
    }
    goalTimes.sort((a, b) => a - b);
    
    for (const time of goalTimes) {
        const isUserGoal = Math.random() < userGoalProbability / (userGoalProbability + opponentGoalProbability);
        let scorer = "";
        
        if (isUserGoal) {
            // Шанс 1%, что гол забьет вратарь
            if (Math.random() < 0.01 && positions.GK.selected) {
                scorer = positions.GK.selected.nickname;
            } else {
                const scoringPositions = ["CDM", "ST", "CF"];
                const randomPosition = scoringPositions[Math.floor(Math.random() * scoringPositions.length)];
                scorer = getRandomScorer(randomPosition);
            }
        } else {
            scorer = "Игрок";
        }
        
        events.push({
            time: time,
            isUserGoal: isUserGoal,
            scorer: scorer
        });
    }
    
    return events;
}
function showTournamentStats() {
    const statsTable = document.querySelector('#statsTable tbody');
    statsTable.innerHTML = '';
    
    const scorersArray = Object.keys(seasonScorers).map(name => ({
        name: name,
        goals: seasonScorers[name]
    })).sort((a, b) => b.goals - a.goals);
    
    scorersArray.forEach((scorer, index) => {
        const row = document.createElement('tr');
        const nameCell = document.createElement('td');
        nameCell.textContent = scorer.name;
        row.appendChild(nameCell);
        
        const goalsCell = document.createElement('td');
        goalsCell.textContent = scorer.goals;
        row.appendChild(goalsCell);
        
        statsTable.appendChild(row);
    });
    
    const goldenBallContainer = document.getElementById('goldenBallContainer');
    goldenBallContainer.innerHTML = '';
    
    if (tournamentWon && scorersArray.length > 0) {
        const topScorer = scorersArray[0];
        const goldenBallDiv = document.createElement('div');
        goldenBallDiv.className = 'golden-ball';
        goldenBallDiv.innerHTML = `
            <div class="golden-ball-icon">🏆</div>
            <div>Золотой мяч турнира вручается ${topScorer.name} (${topScorer.goals} голов)</div>
        `;
        goldenBallContainer.appendChild(goldenBallDiv);
    }

    // Добавленная логика для кнопки
const newSeasonButton = document.getElementById('newSeasonButton');
    
    // Обновленное условие: скрывать кнопку только при вылете из бронзового кубка
    if (currentCup === 'bronze' && !tournamentWon && isGameOver) {
        newSeasonButton.style.display = 'none';
    } else {
        newSeasonButton.style.display = 'block';
    }
    
    document.getElementById('statsOverlay').style.display = 'flex';
}

function closeStats() {
    if(isGameOver) {
        window.location.href = "https://jorayoung.github.io/DraftMenu/"; // Перенаправляем в главное меню
    } else {
        document.getElementById('statsOverlay').style.display = 'none';
    }
}

function simulateMatch() {
    isMatchActive = true; // Добавьте эту строку
    // Скрываем кнопки при старте матча
    document.getElementById('playButton').style.display = 'none';
    document.getElementById('backToMenuButton').style.display = 'none';
    
    clearInterval(matchInterval);
    document.getElementById('playButton').style.display = 'none';
    document.getElementById('scoreDisplay').textContent = '0 : 0';
    document.getElementById('eventsContainer').innerHTML = '';
    
    currentTime = 0;
    userGoals = 0;
    opponentGoals = 0;
    goalEvents = generateGoalEvents(userTeamRating, currentOpponent.rating);
    
    matchInterval = setInterval(() => {
        currentTime += 0.5;
        const minutes = Math.floor(currentTime);
        const seconds = currentTime % 1 === 0 ? '00' : '30';
        
        document.getElementById('matchTime').textContent = `${minutes}:${seconds}`;
        
        const currentEvents = goalEvents.filter(e => Math.floor(e.time) === minutes);
        for (const event of currentEvents) {
            if (event.isUserGoal) {
                userGoals++;
                const tapSound = document.getElementById('tapSound');
                tapSound.currentTime = 0;
                tapSound.play();
                const goalEvent = document.createElement('div');
                goalEvent.className = 'goal-event user-goal';
                goalEvent.textContent = `${minutes}:${seconds} ⚽ ГОЛ! ${event.scorer} забивает за вашу команду!`;
                document.getElementById('eventsContainer').prepend(goalEvent);
                
                // Update scorers statistics only when goal is actually scored
                if (event.scorer) {
    // Обновляем статистику сезона
    if (!seasonScorers[event.scorer]) {
        seasonScorers[event.scorer] = 0;
    }
    seasonScorers[event.scorer]++;
    
    // Обновляем общую статистику
    if (!allTimeScorers[event.scorer]) {
        allTimeScorers[event.scorer] = 0;
    }
    allTimeScorers[event.scorer]++;
    
    updateTopScorersDisplay();
}
            } else {
                opponentGoals++;
                const tapSound = document.getElementById('tapSound');
                tapSound.currentTime = 0;
                tapSound.play();
                const goalEvent = document.createElement('div');
                goalEvent.className = 'goal-event opponent-goal';
                goalEvent.textContent = `${minutes}:${seconds} ⚽ ГОЛ! ${event.scorer} забивает за ${currentOpponent.name}!`;
                document.getElementById('eventsContainer').prepend(goalEvent);
            }
            document.getElementById('scoreDisplay').textContent = `${userGoals} : ${opponentGoals}`;
        }
        
        if (currentTime >= 16) {
            clearInterval(matchInterval);
            finishMatch();
        }
    }, 531.25);
}

function finishMatch() {
    isMatchActive = false;
    isOvertime = false; // Добавить сброс флага
    // Скрываем кнопки перед дополнительным временем
    document.getElementById('playButton').style.display = 'none';
    document.getElementById('backToMenuButton').style.display = 'none';

    // Проверяем, закончился ли матч вничью
    if (userGoals === opponentGoals) {
        // Добавляем сообщение о дополнительном времени
        const extraTimeMsg = document.createElement('div');
        extraTimeMsg.className = 'goal-event';
        extraTimeMsg.textContent = `Матч закончился вничью! Добавляется 8 минут дополнительного времени...`;
        document.getElementById('eventsContainer').prepend(extraTimeMsg);
        
        // Запускаем дополнительное время через 2 секунды
        setTimeout(() => {
            playExtraTime(8); // 8 минут дополнительного времени
        }, 2000);
        return;
    }
    
    // Если не ничья, продолжаем обычную логику
    determineMatchOutcome();
}

function playExtraTime(duration) {
    isOvertime = true; // Устанавливаем флаг овертайма
    // Скрываем кнопки в начале дополнительного времени
    document.getElementById('playButton').style.display = 'none';
    document.getElementById('backToMenuButton').style.display = 'none';

    // Генерируем события для дополнительного времени
    const extraTimeEvents = generateExtraTimeEvents(userTeamRating, currentOpponent.rating, duration);
    let extraTimeGoals = 0;
    
    // Добавляем сообщение о начале дополнительного времени
    const startMsg = document.createElement('div');
    startMsg.className = 'goal-event';
    startMsg.textContent = `Началось дополнительное время (${duration} минут)`;
    document.getElementById('eventsContainer').prepend(startMsg);
    
    // Симулируем дополнительное время
    let extraTimePassed = 0;
    const extraTimeInterval = setInterval(() => {
        extraTimePassed += 0.5;
        const minutes = Math.floor(extraTimePassed);
        const seconds = extraTimePassed % 1 === 0 ? '00' : '30';
        
        // Проверяем события в текущую минуту
        const currentEvents = extraTimeEvents.filter(e => Math.floor(e.time) === minutes);
        for (const event of currentEvents) {
            if (event.isUserGoal) {
                userGoals++;
                extraTimeGoals++;
                const goalEvent = document.createElement('div');
                goalEvent.className = 'goal-event user-goal';
                goalEvent.textContent = `${event.time}' ⚽ ГОЛ! ${event.scorer} забивает за вашу команду в дополнительное время!`;
                document.getElementById('eventsContainer').prepend(goalEvent);
                
                if (event.scorer) {
                    if (!scorers[event.scorer]) {
                        scorers[event.scorer] = 0;
                    }
                    scorers[event.scorer]++;
                    updateTopScorersDisplay();
                }
            } else {
                opponentGoals++;
                extraTimeGoals++;
                const goalEvent = document.createElement('div');
                goalEvent.className = 'goal-event opponent-goal';
                goalEvent.textContent = `${event.time}' ⚽ ГОЛ! ${event.scorer} забивает за ${currentOpponent.name} в дополнительное время!`;
                document.getElementById('eventsContainer').prepend(goalEvent);
            }
            document.getElementById('scoreDisplay').textContent = `${userGoals} : ${opponentGoals}`;
        }
        
        // Обновляем таймер
        document.getElementById('matchTime').textContent = `16+${minutes}:${seconds}`;
        
        // Проверяем окончание дополнительного времени
        if (extraTimePassed >= duration) {
        clearInterval(extraTimeInterval);
        isOvertime = false; // Сбрасываем флаг
            
            // Добавляем сообщение о завершении дополнительного времени
            const endMsg = document.createElement('div');
            endMsg.className = 'goal-event';
            endMsg.textContent = `Дополнительное время завершено. Забито голов: ${extraTimeGoals}`;
            document.getElementById('eventsContainer').prepend(endMsg);
            
            // Проверяем, осталась ли ничья
            if (userGoals === opponentGoals) {
                // Если ничья, добавляем еще 8 минут
                setTimeout(() => {
                    const extraMsg = document.createElement('div');
                    extraMsg.className = 'goal-event';
                    extraMsg.textContent = `Матч все еще вничью! Добавляется еще 8 минут дополнительного времени...`;
                    document.getElementById('eventsContainer').prepend(extraMsg);
                    
                    setTimeout(() => {
                        playExtraTime(8); // Еще 8 минут
                    }, 2000);
                }, 2000);
            } else {
                // Если есть победитель, определяем исход
                setTimeout(determineMatchOutcome, 2000);
            }
        }
    }, 1000); // Увеличиваем интервал для лучшей видимости
}

function determineMatchOutcome() {
    if(userGoals > opponentGoals) {
        if(currentRound === 1) {
            // Начисление призовых за кубок
            let prizeAmount = 0;
            switch(currentCup) {
                case 'bronze': 
                    prizeAmount = 1000000;
                    bronzeCups++; 
                    break;
                case 'silver': 
                    prizeAmount = 3000000;
                    silverCups++; 
                    break;
                case 'gold': 
                    prizeAmount = 10000000;
                    goldCups++; 
                    break;
            }
            
            balance += prizeAmount;
            showCupPrizeAnimation(prizeAmount, currentCup);
            updateBalanceDisplay();
            
            promoteCup();
            tournamentWon = true;
        }
    } else {
        if(currentRound === 1) {
        }
    }
    // Восстановление здоровья перед новым матчем
    handleSickness();
    isOvertime = false; // Сбросить флаг при любом исходе
    updateMarketPlayersRatings();
    // Показываем кнопки после завершения матча
    document.getElementById('playButton').style.display = 'block';
    document.getElementById('backToMenuButton').style.display = 'block';

    if (userGoals > opponentGoals) {
        // Начисляем 600 000 за победу
balance += 500000;
const animElement = document.getElementById('millionAnimation');
animElement.style.display = 'block';
setTimeout(() => animElement.style.display = 'none', 1500);

const balanceElement = document.getElementById('balanceDisplay');
balanceElement.textContent = `Баланс: ${balance.toLocaleString()} ₽`;
balanceElement.classList.add('balance-blink');
        setTimeout(() => balanceElement.classList.remove('balance-blink'), 800);
        // Логика победы
        document.getElementById('matchResult').textContent = "Вы победили!";
        
        if (isInLowerBracket) {
            // Победа в нижней сетке
            lowerBracketRound /= 2;
            
            if (lowerBracketRound === 1) {
                // Финал нижней сетки - переход в основной финал
                isInLowerBracket = false;
                currentRound = 1;
                document.getElementById('matchResult').textContent = "Вы победили в нижней сетке и вышли в финал!";
                setTimeout(nextMatch, 2000);
            } else if (lowerBracketRound >= 1) {
                // Обычный раунд нижней сетки
                if (lowerBracketRound === 32) {
                    showTransferOffer();
                } else if (lowerBracketRound === 128 || lowerBracketRound === 8 || lowerBracketRound === 2) {
                    setTimeout(showTrainingMenu, 1);
                } else {
                    setTimeout(nextMatch, 2000);
                }
                return;
            }
        } else {
            // Победа в основной сетке
            currentRound /= 2;
        }
        
        // Общая логика после победы
        if (currentRound >= 1) {
            if (currentRound === 32 && !isInLowerBracket) {
                showTransferOffer();
            } else if (currentRound === 128 || currentRound === 8 || currentRound === 2) {
                setTimeout(showTrainingMenu, 1);
            } else {
                setTimeout(nextMatch, 2000);
            }
        } else {
            tournamentWon = true;
            document.getElementById('matchResult').textContent = "🏆 Поздравляем! Вы выиграли турнир! 🏆";
            document.getElementById("playButton").style.display = "none";
            document.getElementById("newSeasonButton").style.display = "block";
            setTimeout(showTournamentStats, 1000);
        }
    } else {
        // Логика поражения
        if (currentRound === 1 || (isInLowerBracket && lowerBracketRound === 1)) {
            relegateCup();
            document.getElementById('matchResult').textContent = "Вы проиграли! Турнир окончен.";
            document.getElementById("playButton").style.display = "none";
            setTimeout(showTournamentStats, 1000);
        } else if (!isInLowerBracket) {
            isInLowerBracket = true;
            lowerBracketRound = currentRound * 2;
            document.getElementById('matchResult').textContent = "Вы проиграли и переходите в нижнюю сетку!";
            
            if (lowerBracketRound === 32) {
                showTransferOffer();
            } else {
                setTimeout(nextMatch, 2000);
            }
        } else {
            document.getElementById('matchResult').textContent = "Вы проиграли в нижней сетке! Турнир окончен.";
            relegateCup();
            document.getElementById("playButton").style.display = "none";
            setTimeout(showTournamentStats, 1000);
        }
    }
setTimeout(() => {
  checkSponsorBonus();
  triggerSalaryRequest();
  checkForPenalty();
  checkForBuyOffer(); // Добавляем эту строку
}, 1000);
}

function checkForBuyOffer() {
  if (Math.random() < 0.04) { // 4% шанс
    showBuyOffer();
  }
}

function showBuyOffer() {
  // Получаем случайную команду
  const randomTeam = opponentTeams[Math.floor(Math.random() * opponentTeams.length)];
  
  // Получаем случайного игрока из состава
  const positionsWithPlayers = Object.keys(positions).filter(pos => positions[pos].selected);
  if (positionsWithPlayers.length === 0) return;
  
  const randomPosition = positionsWithPlayers[Math.floor(Math.random() * positionsWithPlayers.length)];
  const player = positions[randomPosition].selected;
  
  // Рассчитываем стоимость
  const basePrice = Math.pow(player.rating, 4);
  const offerPrice = Math.round(basePrice * 1.35);
  
  // Сохраняем данные предложения
  window.currentBuyOffer = {
    team: randomTeam.name,
    position: randomPosition,
    player: player,
    price: offerPrice
  };
  
  // Обновляем UI
  document.getElementById('buyTitle').textContent = 
    `${randomTeam.name} хочет купить вашего игрока!`;
  
  const playerInfo = document.getElementById('buyPlayerInfo');
  playerInfo.innerHTML = `
    <div class="player-circle ${getRatingClass(player.rating)}" 
         style="margin: 0 auto; width: 100px; height: 100px;">
      <div class="player-rating">${player.rating}</div>
      <div class="player-nickname">${player.nickname}</div>
    </div>
    <div style="margin-top: 15px; font-size: 18px;">
      Сумма: ${offerPrice.toLocaleString()} ₽
    </div>
  `;
  
  document.getElementById('buyOverlay').style.display = 'flex';
}

function getRatingClass(rating) {
  if (rating >= 40 && rating <= 60) return 'bronze';
  if (rating >= 61 && rating <= 80) return 'silver';
  if (rating >= 81 && rating <= 99) return 'gold';
  return 'red';
}

function acceptBuyOffer() {
  const offer = window.currentBuyOffer;
  if (!offer) return;
  
  // Удаляем игрока из состава
  positions[offer.position].selected = null;
  
  // Полностью удаляем игрока из базы данных
  const positionIndex = positions[offer.position].players.findIndex(
    p => p.nickname === offer.player.nickname
  );
  if (positionIndex !== -1) {
    positions[offer.position].players.splice(positionIndex, 1);
  }
  
  // Добавляем деньги
  balance += offer.price;
  updateBalanceDisplay();
  
  // Обновляем интерфейс
  updateTeamSquadDisplay();
  checkAllSelected();
  userTeamRating = calculateUserTeamRating();
  document.getElementById('userRatingDisplay').textContent = userTeamRating;
  updateTeamRatingCircle();
  
  closeBuyOffer();
}

function rejectBuyOffer() {
  closeBuyOffer();
}

function closeBuyOffer() {
  document.getElementById('buyOverlay').style.display = 'none';
  window.currentBuyOffer = null;
}


// Новая функция для генерации событий в дополнительное время
function generateExtraTimeEvents(userRating, opponentRating, duration) {
    const events = [];
    const ratingDifference = userRating - opponentRating;
    
    // Модификаторы в зависимости от стиля игры
    let userGoalModifier = 1;
    let opponentGoalModifier = 1;
    
    if (gameStyle === 'defensive') {
        userGoalModifier = 0.5;
        opponentGoalModifier = 0.5;
    } else if (gameStyle === 'offensive') {
        userGoalModifier = 2;
        opponentGoalModifier = 2;
    }
    
    const userGoalProbability = (0.4 + (0.5 * ratingDifference / 100) + (Math.random() * 0.17 - 0.085)) * userGoalModifier;
    const opponentGoalProbability = (0.4 - (0.3 * ratingDifference / 100) + (Math.random() * 0.17 - 0.085)) * opponentGoalModifier;
    
    // В дополнительное время обычно забивают меньше голов
    const totalGoals = Math.max(0, Math.min(3, Math.round((1 + (userRating + opponentRating)/80 + (Math.random() * 1.7 - 0.85)) * (gameStyle === 'defensive' ? 0.5 : gameStyle === 'offensive' ? 2 : 1))));
    
    const goalTimes = [];
    for (let i = 0; i < totalGoals; i++) {
        goalTimes.push(Math.floor(Math.random() * duration));
    }
    goalTimes.sort((a, b) => a - b);
    
    for (const time of goalTimes) {
        const isUserGoal = Math.random() < userGoalProbability / (userGoalProbability + opponentGoalProbability);
        let scorer = "";
        
        if (isUserGoal) {
            // Шанс 1%, что гол забьет вратарь
            if (Math.random() < 0.01 && positions.GK.selected) {
                scorer = positions.GK.selected.nickname;
            } else {
                const scoringPositions = ["CDM", "ST", "CF"];
                const randomPosition = scoringPositions[Math.floor(Math.random() * scoringPositions.length)];
                scorer = getRandomScorer(randomPosition);
            }
        } else {
            scorer = "Игрок";
        }
        
        events.push({
            time: time,
            isUserGoal: isUserGoal,
            scorer: scorer
        });
    }
    
    return events;
}

function playMatch() {
    if(isGameOver) return;
    document.getElementById('backToMenuButton').style.display = 'none';
    simulateMatch();
}

function nextMatch() {
    if(isGameOver) return;
    currentOpponent = getNextOpponent();
    usedOpponents.push(currentOpponent.name);
    
    document.getElementById('opponentLogo').src = currentOpponent.logo;
    document.getElementById('opponentName').textContent = currentOpponent.name;
    
    const roundTitle = document.getElementById('roundTitle');
    if (isInLowerBracket) {
        if (lowerBracketRound === 1) {
            roundTitle.innerHTML = '<div class="final-banner">ФИНАЛ НИЖНЕЙ СЕТКИ</div>';
        } else {
            roundTitle.innerHTML = `<h3>1/${lowerBracketRound} финала (нижняя сетка)</h3>`;
        }
    } else {
        if (currentRound === 1) {
            roundTitle.innerHTML = '<div class="final-banner">ФИНАЛ</div>';
        } else {
            roundTitle.innerHTML = `<h3>1/${currentRound} финала</h3>`;
        }
    }
    
    document.getElementById('scoreDisplay').textContent = '0 : 0';
    document.getElementById('matchResult').textContent = '';
    document.getElementById('matchTime').textContent = '0:00';
    document.getElementById('eventsContainer').innerHTML = '';
    document.getElementById('backToMenuButton').style.display = 'none';
}

function startTournament() {
    // Reset statistics for new tournament
    seasonScorers = {}; // Сбрасываем только статистику сезона
    tournamentWon = false;
    isInLowerBracket = false;
    lowerBracketRound = 0;
    
    userTeamRating = calculateUserTeamRating();
    document.getElementById('userRatingDisplay').textContent = userTeamRating;
    updateTeamSquadDisplay();
    updateTeamRatingCircle();
    currentRound = 256;
    usedOpponents = [];
    document.getElementById("newSeasonButton").style.display = "none";
    document.getElementById('matchOverlay').style.display = 'flex';
    document.getElementById('matchResult').textContent = '';
    document.getElementById('playButton').style.display = 'block';
    document.getElementById('userRatingDisplay').textContent = userTeamRating;
    document.getElementById('userTeamName').textContent = userTeamName;
    document.getElementById('backToMenuButton').style.display = 'none';
    document.getElementById('yearDisplay').textContent = `Сезон ${currentYear}`;
    nextMatch();
}

window.onload = function() {
    updateCupDisplay();
    for (const position in positions) {
        showPlayers(position);
    }
    document.getElementById('opponentLogo').addEventListener('click', showTeamsList);
    document.getElementById('balanceDisplay').textContent = 
        `Баланс: ${balance.toLocaleString()} ₽`;
};

// Transfer Offer Functions
function showTransferOffer() {
    // Find the weakest player in the team
    let weakestPlayer = null;
    let weakestRating = 100;
    let weakestPosition = null;
    
    for (const position in positions) {
        if (positions[position].selected && positions[position].selected.rating < weakestRating) {
            weakestRating = positions[position].selected.rating;
            weakestPlayer = positions[position].selected;
            weakestPosition = position;
        }
    }
    
    if (!weakestPlayer || !weakestPosition) {
        nextMatch(); // Если не нашли слабого игрока, сразу продолжаем турнир
        return;
    }
    
    // Find a random player from the same position with higher rating
    const availablePlayers = positions[weakestPosition].players.filter(
        p => p.rating > weakestRating && p.nickname !== weakestPlayer.nickname
    );
    
    if (availablePlayers.length === 0) {
        nextMatch(); // Если нет подходящих игроков, сразу продолжаем турнир
        return;
    }
    
    const offeredPlayer = availablePlayers[Math.floor(Math.random() * availablePlayers.length)];
    
    // Update transfer modal UI
    const currentPlayerCircle = document.getElementById('currentPlayer');
    currentPlayerCircle.querySelector('.player-rating').textContent = weakestPlayer.rating;
    currentPlayerCircle.querySelector('.player-nickname').textContent = weakestPlayer.nickname;
    
    const offeredPlayerCircle = document.getElementById('offeredPlayer');
    offeredPlayerCircle.querySelector('.player-rating').textContent = offeredPlayer.rating;
    offeredPlayerCircle.querySelector('.player-nickname').textContent = offeredPlayer.nickname;
    
    // Set rating class
    [currentPlayerCircle, offeredPlayerCircle].forEach(circle => {
    circle.className = 'player-circle';
    const rating = parseInt(circle.querySelector('.player-rating').textContent);
    if (rating >= 40 && rating <= 60) {
        circle.classList.add('bronze');
    } else if (rating >= 61 && rating <= 80) {
        circle.classList.add('silver');
    } else if (rating >= 81 && rating <= 99) {
        circle.classList.add('gold');
    } else if (rating >= 100) { // Добавляем условие для красного класса
        circle.classList.add('red');
    }
});
    
    // Store transfer data
    currentPlayerCircle.dataset.position = weakestPosition;
    currentPlayerCircle.dataset.nickname = weakestPlayer.nickname;
    offeredPlayerCircle.dataset.position = weakestPosition;
    offeredPlayerCircle.dataset.nickname = offeredPlayer.nickname;
    offeredPlayerCircle.dataset.rating = offeredPlayer.rating;
    
    // Устанавливаем заголовок для обычного трансфера
    document.querySelector('.transfer-title').textContent = 'Предложение на трансфер';
    
    // Show transfer modal immediately
    document.getElementById('transferOverlay').style.display = 'flex';
}

function acceptTransfer() {
    const currentPlayerCircle = document.getElementById('currentPlayer');
    const offeredPlayerCircle = document.getElementById('offeredPlayer');
    
    const position = currentPlayerCircle.dataset.position;
    const oldNickname = currentPlayerCircle.dataset.nickname;
    const newNickname = offeredPlayerCircle.dataset.nickname;
    const newRating = parseInt(offeredPlayerCircle.dataset.rating);
    
    // Находим предлагаемого игрока
    const offeredPlayer = positions[position].players.find(p => p.nickname === newNickname);
    
    if (offeredPlayer) {
        // Удаляем статистику старого игрока
        // Переносим статистику при трансфере
if (allTimeScorers[oldNickname]) {
    allTimeScorers[newNickname] = (allTimeScorers[newNickname] || 0) + allTimeScorers[oldNickname];
    delete allTimeScorers[oldNickname];
}

if (seasonScorers[oldNickname]) {
    seasonScorers[newNickname] = (seasonScorers[newNickname] || 0) + seasonScorers[oldNickname];
    delete seasonScorers[oldNickname];
}
        
        // Начинаем статистику нового игрока с нуля
        scorers[newNickname] = 0;
        
        // Обновляем выбранного игрока
        positions[position].selected = offeredPlayer;
        
        // Обновляем рейтинг команды
        userTeamRating = calculateUserTeamRating();
        updateTeamSquadDisplay(); // Добавляем эту строку
        updateTopScorersDisplay();
        document.getElementById('userRatingDisplay').textContent = userTeamRating;
    }
    
    // Закрываем окно трансфера
    document.getElementById('transferOverlay').style.display = 'none';
    
    // Показываем следующее трансферное предложение или начинаем сезон
    if (showOffseasonTransfer.transferCount < 2) {
        showOffseasonTransfer();
    }
}

function rejectTransfer() {
    // Закрываем окно трансфера
    document.getElementById('transferOverlay').style.display = 'none';
    
    // Показываем следующее трансферное предложение или начинаем сезон
    if (showOffseasonTransfer.transferCount < 2) {
        showOffseasonTransfer();
    }
}

// Функция для показа меню тренировки
function showTrainingMenu() {
    const trainingPlayersContainer = document.getElementById('trainingPlayers');
    trainingPlayersContainer.innerHTML = '';
    
    // Создаем круги для каждого выбранного игрока
    for (const position in positions) {
        if (positions[position].selected) {
            const player = positions[position].selected;
            
            const playerCircle = document.createElement('div');
            playerCircle.className = 'player-circle';
            playerCircle.style.cursor = 'pointer';
            playerCircle.style.margin = '0';
            playerCircle.dataset.position = position;
            playerCircle.dataset.nickname = player.nickname;
            playerCircle.dataset.rating = player.rating;
            
            if (player.rating >= 40 && player.rating <= 60) {
                playerCircle.classList.add('bronze');
            } else if (player.rating >= 61 && player.rating <= 80) {
                playerCircle.classList.add('silver');
            } else if (player.rating >= 81 && player.rating <= 99) {
                playerCircle.classList.add('gold');
            } else if (player.rating >= 100 && player.rating <= 110) {
                playerCircle.classList.add('red');
            }
            
            const ratingDiv = document.createElement('div');
            ratingDiv.className = 'player-rating';
            ratingDiv.textContent = player.rating;
            
            const nicknameDiv = document.createElement('div');
            nicknameDiv.className = 'player-nickname';
            nicknameDiv.textContent = player.nickname;
            
            playerCircle.appendChild(ratingDiv);
            playerCircle.appendChild(nicknameDiv);
            
            playerCircle.addEventListener('click', function() {
                // Убираем выделение у всех игроков
                document.querySelectorAll('#trainingPlayers .player-circle').forEach(circle => {
                    circle.classList.remove('selected');
                });
                
                // Выделяем выбранного игрока
                this.classList.add('selected');
            });
            
            trainingPlayersContainer.appendChild(playerCircle);
        }
    }
    
    document.getElementById('trainingOverlay').style.display = 'flex';
}
// Функция для подтверждения тренировки
function confirmTraining() {
    const selectedPlayerCircle = document.querySelector('#trainingPlayers .player-circle.selected');
    
    if (!selectedPlayerCircle) {
        alert('Пожалуйста, выберите игрока для тренировки!');
        return;
    }
    
    const position = selectedPlayerCircle.dataset.position;
    const nickname = selectedPlayerCircle.dataset.nickname;
    const currentRating = parseInt(selectedPlayerCircle.dataset.rating);
    
    // Находим игрока в массиве и обновляем его рейтинг
    const playerIndex = positions[position].players.findIndex(p => p.nickname === nickname);
    if (playerIndex !== -1) {
        // Увеличиваем рейтинг, но не более 110
        const newRating = Math.min(currentRating + 5, 110);
        positions[position].players[playerIndex].rating = newRating;
        
        // Если это выбранный игрок, обновляем и его рейтинг
        if (positions[position].selected && positions[position].selected.nickname === nickname) {
            positions[position].selected.rating = newRating;
            userTeamRating = calculateUserTeamRating();
document.getElementById('userRatingDisplay').textContent = userTeamRating;
    updateTeamSquadDisplay(); // Добавляем эту строку
updateTeamRatingCircle(); // Добавить эту строку
        }
    }
    
    // Закрываем меню тренировки
    document.getElementById('trainingOverlay').style.display = 'none';
    
    // Продолжаем турнир
    nextMatch();
}

function startNewSeason() {
    isGameOver = false;
    currentYear++;
    document.getElementById('yearDisplay').textContent = `Сезон ${currentYear}`;

    // Сохраняем общую статистику и сбрасываем сезонную
    seasonScorers = {};
    // Сбросить турнирные данные
    currentRound = 256;
    usedOpponents = [];
    tournamentWon = false;
    isInLowerBracket = false;
    lowerBracketRound = 0;
    
    
    // Закрыть статистику
    document.getElementById('statsOverlay').style.display = 'none';
    
    // Обновить рейтинг команды
    userTeamRating = calculateUserTeamRating();
    document.getElementById('userRatingDisplay').textContent = userTeamRating;
    updateTeamRatingCircle(); // Добавить этот вызов
    
    // Сбросить состояние матча
    document.getElementById('matchOverlay').style.display = 'flex';
    document.getElementById('matchResult').textContent = '';
    document.getElementById('playButton').style.display = 'block';
    document.getElementById('backToMenuButton').style.display = 'none';
    document.getElementById('newSeasonButton').style.display = 'none';
    document.getElementById('scoreDisplay').textContent = '0 : 0';
    document.getElementById('eventsContainer').innerHTML = '';
    
    // Установить правильный раунд в интерфейсе
    const roundTitle = document.getElementById('roundTitle');
    roundTitle.innerHTML = `<h3>1/${currentRound} финала</h3>`;
    
    // Получить нового соперника
    currentOpponent = getNextOpponent();
    usedOpponents.push(currentOpponent.name);
    
    // Обновить интерфейс соперника
    document.getElementById('opponentLogo').src = currentOpponent.logo;
    document.getElementById('opponentName').textContent = currentOpponent.name;
    showPlayersImprovement();
}

function showPlayersImprovement() {
    const improvedPlayersContainer = document.getElementById('improvedPlayers');
    improvedPlayersContainer.innerHTML = '';
    
    // Улучшить всех выбранных игроков и обновить их рейтинг
    for (const position in positions) {
        if (positions[position].selected) {
            const player = positions[position].selected;
            
            // Найти игрока в массиве и обновить его рейтинг
            const playerIndex = positions[position].players.findIndex(p => p.nickname === player.nickname);
            if (playerIndex !== -1) {
                // Увеличиваем рейтинг, но не более 110
                const newRating = Math.min(player.rating + 2, 110);
                positions[position].players[playerIndex].rating = newRating;
                positions[position].selected.rating = newRating;
                
                // Создать элемент для отображения улучшенного игрока
                const playerCircle = document.createElement('div');
                playerCircle.className = 'player-circle';
                playerCircle.style.margin = '0';
                
                if (newRating >= 40 && newRating <= 60) {
                    playerCircle.classList.add('bronze');
                } else if (newRating >= 61 && newRating <= 80) {
                    playerCircle.classList.add('silver');
                } else if (newRating >= 81 && newRating <= 99) {
                    playerCircle.classList.add('gold');
                } else if (newRating >= 100 && newRating <= 110) {
                    playerCircle.classList.add('red');
                }
                
                const ratingDiv = document.createElement('div');
                ratingDiv.className = 'player-rating';
                ratingDiv.textContent = newRating;
                
                const nicknameDiv = document.createElement('div');
                nicknameDiv.className = 'player-nickname';
                nicknameDiv.textContent = player.nickname;
                
                playerCircle.appendChild(ratingDiv);
                playerCircle.appendChild(nicknameDiv);
                improvedPlayersContainer.appendChild(playerCircle);
            }
        }
    }
    
    // Показать оверлей
    document.getElementById('newSeasonOverlay').style.display = 'flex';
    document.getElementById('statsOverlay').style.display = 'none';
}

// Новая функция для продолжения после улучшения
function continueAfterSeason() {
    // Скрываем окно улучшения игроков
    document.getElementById('newSeasonOverlay').style.display = 'none';
    
    // Обновляем рейтинг команды после улучшений
    userTeamRating = calculateUserTeamRating();
document.getElementById('userRatingDisplay').textContent = userTeamRating;
    updateTeamSquadDisplay(); // Добавляем эту строку
updateTeamRatingCircle();
    
    // Сбрасываем турнирные данные для нового сезона
    currentRound = 256;
    usedOpponents = [];
    tournamentWon = false;
    
    // Сбрасываем состояние матча
    document.getElementById('matchOverlay').style.display = 'flex';
    document.getElementById('matchResult').textContent = '';
    document.getElementById('playButton').style.display = 'block';
    document.getElementById('backToMenuButton').style.display = 'none';
    document.getElementById('newSeasonButton').style.display = 'none';
    document.getElementById('scoreDisplay').textContent = '0 : 0';
    document.getElementById('eventsContainer').innerHTML = '';
    
    // Устанавливаем правильный раунд в интерфейсе
    const roundTitle = document.getElementById('roundTitle');
    roundTitle.innerHTML = `<h3>1/${currentRound} финала</h3>`;
    
    // Получаем нового соперника
    currentOpponent = getNextOpponent();
    usedOpponents.push(currentOpponent.name);
    
    // Обновляем интерфейс соперника
    document.getElementById('opponentLogo').src = currentOpponent.logo;
    document.getElementById('opponentName').textContent = currentOpponent.name;
    
    // Показываем четыре трансферных предложения
    showOffseasonTransfer.transferCount = 0; // Сбрасываем счетчик
    showOffseasonTransfer(); // Показываем первый трансфер
}

function showOffseasonTransfer() {
    // Инициализируем счетчик трансферов, если он еще не существует
    if (typeof showOffseasonTransfer.transferCount === 'undefined') {
        showOffseasonTransfer.transferCount = 0;
    }
    
    // Увеличиваем счетчик
    showOffseasonTransfer.transferCount++;
    
    // Если уже показали 4 трансфера, сбрасываем счетчик и начинаем новый сезон
    if (showOffseasonTransfer.transferCount > 4) {
        showOffseasonTransfer.transferCount = 0;
        nextMatch(); // Начинаем новый сезон
        return;
    }
    
    // Получаем случайную позицию из доступных
    const positionsList = Object.keys(positions);
    const randomPosition = positionsList[Math.floor(Math.random() * positionsList.length)];
    
    // Получаем текущего игрока на этой позиции
    const currentPlayer = positions[randomPosition].selected;
    
    if (!currentPlayer) {
        // Если почему-то нет игрока на этой позиции, пробуем снова
        setTimeout(showOffseasonTransfer, 0);
        return;
    }
    
    // Получаем случайного игрока на той же позиции (может быть любого рейтинга)
    const availablePlayers = positions[randomPosition].players.filter(
        p => p.nickname !== currentPlayer.nickname
    );
    
    if (availablePlayers.length === 0) {
        // Если нет других игроков на этой позиции, пробуем снова
        setTimeout(showOffseasonTransfer, 0);
        return;
    }
    
    const offeredPlayer = availablePlayers[Math.floor(Math.random() * availablePlayers.length)];
    
    // Обновляем интерфейс трансфера
    updateTransferUI(currentPlayer, offeredPlayer, randomPosition);
    
    // Меняем текст заголовка для межсезонья
    document.querySelector('.transfer-title').textContent = `Межсезонный трансфер (${showOffseasonTransfer.transferCount}/4)`;
    
    // Показываем модальное окно трансфера
    document.getElementById('transferOverlay').style.display = 'flex';
}


// Вынесем обновление UI в отдельную функцию
function updateTransferUI(currentPlayer, offeredPlayer, position) {
    const currentPlayerCircle = document.getElementById('currentPlayer');
    currentPlayerCircle.querySelector('.player-rating').textContent = currentPlayer.rating;
    currentPlayerCircle.querySelector('.player-nickname').textContent = currentPlayer.nickname;
    
    const offeredPlayerCircle = document.getElementById('offeredPlayer');
    offeredPlayerCircle.querySelector('.player-rating').textContent = offeredPlayer.rating;
    offeredPlayerCircle.querySelector('.player-nickname').textContent = offeredPlayer.nickname;
    
    // Устанавливаем классы рейтинга
    [currentPlayerCircle, offeredPlayerCircle].forEach(circle => {
        circle.className = 'player-circle';
        const rating = parseInt(circle.querySelector('.player-rating').textContent);
        if (rating >= 40 && rating <= 60) {
            circle.classList.add('bronze');
        } else if (rating >= 61 && rating <= 80) {
            circle.classList.add('silver');
        } else if (rating >= 81 && rating <= 99) {
            circle.classList.add('gold');
        } else if (rating >= 100 && rating <= 110) {
            circle.classList.add('red');
        }
    });
    
    // Сохраняем данные трансфера
    currentPlayerCircle.dataset.position = position;
    currentPlayerCircle.dataset.nickname = currentPlayer.nickname;
    offeredPlayerCircle.dataset.position = position;
    offeredPlayerCircle.dataset.nickname = offeredPlayer.nickname;
    offeredPlayerCircle.dataset.rating = offeredPlayer.rating;
}

function acceptTransfer() {
    const currentPlayerCircle = document.getElementById('currentPlayer');
    const offeredPlayerCircle = document.getElementById('offeredPlayer');
    
    const position = currentPlayerCircle.dataset.position;
    const oldNickname = currentPlayerCircle.dataset.nickname;
    const newNickname = offeredPlayerCircle.dataset.nickname;
    const newRating = parseInt(offeredPlayerCircle.dataset.rating);
    
    const offeredPlayer = positions[position].players.find(p => p.nickname === newNickname);
    
    if (offeredPlayer) {
        // Переносим часть статистики от старого игрока к новому (например, 50%)
        if (scorers[oldNickname]) {
            const oldGoals = scorers[oldNickname];
            scorers[newNickname] = Math.floor(oldGoals * 0.5); // Новый игрок получает 50% голов старого
            scorers[oldNickname] = Math.ceil(oldGoals * 0.5); // Старый игрок сохраняет 50%
        } else {
            scorers[newNickname] = 0;
        }
        
        positions[position].selected = offeredPlayer;
        userTeamRating = calculateUserTeamRating();
        document.getElementById('userRatingDisplay').textContent = userTeamRating;
        updateTeamSquadDisplay();
        updateTeamRatingCircle();
        updateTopScorersDisplay();
    }
    
    document.getElementById('transferOverlay').style.display = 'none';
    
    const isOffseasonTransfer = document.querySelector('.transfer-title').textContent.includes('Межсезонный');
    
    if (isOffseasonTransfer) {
        if (showOffseasonTransfer.transferCount < 4) {
            setTimeout(showOffseasonTransfer, 0);
        } else {
            nextMatch();
        }
    } else {
        setTimeout(nextMatch, 0);
    }
}

function rejectTransfer() {
    // Закрываем окно трансфера
    document.getElementById('transferOverlay').style.display = 'none';
    
    // Определяем, это обычный трансфер или межсезонный
    const isOffseasonTransfer = document.querySelector('.transfer-title').textContent.includes('Межсезонный');
    
    if (isOffseasonTransfer) {
        // Для межсезонных трансферов
        if (showOffseasonTransfer.transferCount < 4) {  // Изменили с 2 на 4
            setTimeout(showOffseasonTransfer, 0);
        } else {
            // После четырех межсезонных трансферов начинаем новый сезон
            nextMatch();
        }
    } else {
        // Для обычных трансферов просто продолжаем турнир
        setTimeout(nextMatch, 0);
    }
}

function updateTeamRatingCircle() {
    const teamCircle = document.getElementById('teamRatingCircle');
    if (!teamCircle) return;
    
    // Удаляем все классы цветов
    teamCircle.classList.remove('bronze', 'silver', 'gold', 'red');
    
    // Добавляем соответствующий класс в зависимости от рейтинга
    if (userTeamRating >= 40 && userTeamRating <= 60) {
        teamCircle.classList.add('bronze');
    } else if (userTeamRating >= 61 && userTeamRating <= 80) {
        teamCircle.classList.add('silver');
    } else if (userTeamRating >= 81 && userTeamRating <= 99) {
        teamCircle.classList.add('gold');
    } else if (userTeamRating >= 100 && userTeamRating <= 110) {
        teamCircle.classList.add('red');
    }
}

function updateTeamSquadDisplay() {
    const squadContainer = document.getElementById('teamSquadPlayers');
    squadContainer.innerHTML = '';
    
    for (const position in positions) {
        const playerWrapper = document.createElement('div');
        playerWrapper.className = 'squad-player';
        
        if (positions[position].selected) {
            const player = positions[position].selected;
            
            const playerCircle = document.createElement('div');
            playerCircle.className = 'squad-player-circle';
            playerCircle.style.cursor = 'pointer';

// Добавляем класс для больных игроков
        if (sickPlayers.some(p => p.nickname === player.nickname)) {
            playerCircle.classList.add('sick');
        }
    
            
            // Добавляем класс цвета в зависимости от рейтинга
            if (player.rating >= 40 && player.rating <= 60) {
                playerCircle.classList.add('bronze');
            } else if (player.rating >= 61 && player.rating <= 80) {
                playerCircle.classList.add('silver');
            } else if (player.rating >= 81 && player.rating <= 99) {
                playerCircle.classList.add('gold');
            } else if (player.rating >= 100 && player.rating <= 110) {
                playerCircle.classList.add('red');
            }
            
            const ratingDiv = document.createElement('div');
            ratingDiv.className = 'squad-player-rating';
            ratingDiv.textContent = player.rating;
            
            const nicknameDiv = document.createElement('div');
            nicknameDiv.className = 'squad-player-nickname';
            nicknameDiv.textContent = player.nickname;
            
            playerCircle.appendChild(ratingDiv);
            playerWrapper.appendChild(playerCircle);
            playerWrapper.appendChild(nicknameDiv);
            
            squadContainer.appendChild(playerWrapper);
       
// Добавьте обработчик клика
            playerCircle.addEventListener('click', () => showSellMenu(position, player));
        } else {
            const addButton = document.createElement('div');
            addButton.className = 'add-player-btn';
            addButton.innerHTML = '+';
            addButton.onclick = () => openMarket(position);
            addButton.className = 'add-player-btn' + (isMatchActive ? ' disabled' : '');
    if (!isMatchActive) {
        addButton.onclick = () => openMarket(position);
    }
            playerWrapper.appendChild(addButton);
        }
        
        squadContainer.appendChild(playerWrapper);
    }
}

function updateTopScorersDisplay() {
    const scorersDisplay = document.getElementById('topScorersDisplay');
    const sortedScorers = Object.entries(allTimeScorers)
        .map(([name, goals]) => ({ name, goals }))
        .sort((a, b) => b.goals - a.goals);
    
    let html = '<div style="text-align: center; margin-bottom: 5px; color: #00bfff;">Бомбардиры (всё время)</div>';
    
    if (sortedScorers.length === 0) {
        html += '<div style="font-style: italic;">Голы еще не забиты</div>';
    } else {
        sortedScorers.forEach((scorer, index) => {
            const isCurrentPlayer = Object.values(positions).some(
                pos => pos.selected && pos.selected.nickname === scorer.name
            );
            const playerClass = isCurrentPlayer ? 'style="color: #7cfc00;"' : '';
            html += `<div ${playerClass}>${scorer.name}: ${scorer.goals}</div>`;
        });
    }
    
    // Добавляем секцию с трофеями
    html += `
        <div style="text-align: center; margin-top: 15px; color: #00bfff;">Трофеи:</div>
        <div style="display: flex; justify-content: center; gap: 15px; margin-top: 5px;">
            <div>Золотой Кубок: ${goldCups}</div>
            <div>Серебряный Кубок: ${silverCups}</div>
            <div>Бронзовый Кубок: ${bronzeCups}</div>
        </div>
    `;
    
    scorersDisplay.innerHTML = html;
    scorersDisplay.scrollTop = scorersDisplay.scrollHeight;
}

document.addEventListener('mousedown', function(event) {
            if (event.button === 0) { // Проверка левой кнопки
                const sound = document.getElementById('tapSound');
                sound.currentTime = 0; // Перемотка на начало
                sound.play(); // Воспроизведение
            }
        });
function showSellMenu(position, player) {
    if (isMatchActive || isOvertime) { // Добавить проверку на овертайм
        alert("Нельзя продавать игроков во время матча!");
        return;
    }
    currentSellingPlayer = { position, player };
    const sellPrice = Math.pow(player.rating, 4);
    document.getElementById('sellTitle').textContent = 
        `Продать ${player.nickname} (${player.rating}) за ${sellPrice.toLocaleString()} ₽?`;
    document.getElementById('sellOverlay').style.display = 'flex';
}

function confirmSell() {
    if (!currentSellingPlayer) return;
    
    // Удаляем из списка больных
    sickPlayers = sickPlayers.filter(p => 
        p.nickname !== currentSellingPlayer.player.nickname
    );
    
    const { position, player } = currentSellingPlayer;
    const sellPrice = Math.pow(player.rating, 4);
    
    balance += sellPrice;
    document.getElementById('balanceDisplay').textContent = 
        `Баланс: ${balance.toLocaleString()} ₽`;
    
    // Удалить игрока
    positions[position].selected = null;
    updateTeamSquadDisplay();
    checkAllSelected();
    
    // Обновить рейтинг команды
    userTeamRating = calculateUserTeamRating();
    document.getElementById('userRatingDisplay').textContent = userTeamRating;
    updateTeamRatingCircle();
    
    cancelSell();
}

function cancelSell() {
    currentSellingPlayer = null;
    document.getElementById('sellOverlay').style.display = 'none';
}

let currentMarketPosition = null;
let selectedMarketPlayer = null;

function openMarket(position) {
    if (isMatchActive) {
        alert("Нельзя покупать игроков во время матча!");
        return;
    }
    currentMarketPosition = position;
    document.getElementById('marketTitle').textContent = `Рынок ${position}`;
    loadMarketPlayers(position);
    document.getElementById('marketOverlay').style.display = 'flex';
}

function loadMarketPlayers(position) {
    const container = document.getElementById('marketPlayers');
    container.innerHTML = '';
    
    // Обновляем классы игроков согласно новому рейтингу
    positions[position].players.forEach(player => {
        if (player.rating >= 40 && player.rating <= 60) {
            player.class = 'bronze';
        } else if (player.rating >= 61 && player.rating <= 80) {
            player.class = 'silver';
        } else if (player.rating >= 81) {
            player.class = 'gold';
        }
    });
    
    // Фильтруем игроков по позиции и сортируем по рейтингу
    const players = positions[position].players
        .filter(p => !isPlayerInTeam(p.nickname))
        .sort((a, b) => b.rating - a.rating);
    
    players.forEach(player => {
        const playerDiv = document.createElement('div');
        playerDiv.className = 'market-player';
        playerDiv.innerHTML = `
        <div style="display: flex; align-items: center; gap: 8px;">
            <div style="display: flex; flex-direction: column;">
                <span class="player-nickname">${player.nickname}</span>
                <span class="player-rating" style="font-size: 12px;">Рейтинг: ${player.rating}</span>
            </div>
        </div>
        <div class="player-price">${Math.pow(player.rating, 4).toLocaleString()} ₽</div>
    `;
        
        playerDiv.addEventListener('click', () => showPurchaseDialog(player));
        container.appendChild(playerDiv);
    });
}

function isPlayerInTeam(nickname) {
    return Object.values(positions).some(pos => 
        pos.selected && pos.selected.nickname === nickname
    );
}

function showPurchaseDialog(player) {
    selectedMarketPlayer = player;
    const price = Math.pow(player.rating, 4);
    
    document.getElementById('purchaseTitle').textContent = 
        `Купить ${player.nickname} (${player.rating})?`;
    document.getElementById('playerPrice').textContent = 
        `Цена: ${price.toLocaleString()} ₽`;
    
    document.getElementById('marketOverlay').style.display = 'none';
    document.getElementById('purchaseOverlay').style.display = 'flex';
}

function confirmPurchase() {
    const price = Math.pow(selectedMarketPlayer.rating, 4);
    
    if (balance >= price) {
        balance -= price;
        positions[currentMarketPosition].selected = selectedMarketPlayer;
        
        // Обновляем рейтинг команды
        userTeamRating = calculateUserTeamRating();
        document.getElementById('userRatingDisplay').textContent = userTeamRating;
        updateTeamRatingCircle();
        
        updateTeamSquadDisplay();
        checkAllSelected();
        
        document.getElementById('balanceDisplay').textContent = 
            `Баланс: ${balance.toLocaleString()} ₽`;
        
        closePurchase();
        closeMarket();
    } else {
        alert('Недостаточно средств!');
    }
}

function closePurchase() {
    document.getElementById('purchaseOverlay').style.display = 'none';
    document.getElementById('marketOverlay').style.display = 'flex';
}

function closeMarket() {
    document.getElementById('marketOverlay').style.display = 'none';
    selectedMarketPlayer = null;
    currentMarketPosition = null;
}

function triggerSalaryRequest() {
    // Получаем всех выбранных игроков
    const teamPlayers = [];
    for (const position in positions) {
        if (positions[position].selected) {
            teamPlayers.push({
                position: position,
                player: positions[position].selected
            });
        }
    }
    
    if (teamPlayers.length === 0) return;
    
    // Выбираем случайного игрока
    const randomPlayer = teamPlayers[Math.floor(Math.random() * teamPlayers.length)];
    const salary = Math.pow(randomPlayer.player.rating, 3);
    
    // Сохраняем данные для обработки
    window.currentSalaryRequest = {
        position: randomPlayer.position,
        player: randomPlayer.player,
        salary: salary
    };
    
    // Показываем модальное окно
    document.getElementById('salaryTitle').textContent = 
        `${randomPlayer.player.nickname} требует зарплату!`;
    document.getElementById('salaryAmount').textContent = 
        `${salary.toLocaleString()} ₽`;
    document.getElementById('salaryOverlay').style.display = 'flex';
}

function paySalary() {
    const request = window.currentSalaryRequest;
    if (!request) return;
    
    if (balance >= request.salary) {
        // Оплачиваем зарплату
        balance -= request.salary;
        document.getElementById('balanceDisplay').textContent = 
            `Баланс: ${balance.toLocaleString()} ₽`;
    } else {
        // Игрок уходит
        positions[request.position].selected = null;
        updateTeamSquadDisplay();
        checkAllSelected();
        userTeamRating = calculateUserTeamRating();
        document.getElementById('userRatingDisplay').textContent = userTeamRating;
        alert(`${request.player.nickname} ушел из команды из-за неуплаты!`);
    }
    
    // Закрываем окно и продолжаем игру
    document.getElementById('salaryOverlay').style.display = 'none';
    window.currentSalaryRequest = null;
    

}

function showOverlay(overlayId) {
    document.getElementById(overlayId).style.zIndex = 9000; // Меньше чем у анимации
    document.getElementById(overlayId).style.display = 'flex';
}

function checkSponsorBonus() {
  if (Math.random() < 0.05) { // 5% шанс
    const amount = Math.floor(Math.random() * (30000000 - 1000000 + 1) + 1000000);
    showSponsorMenu(amount);
  }
}

function showSponsorMenu(amount) {
  balance += amount;
  document.getElementById('sponsorAmount').textContent = 
    `${amount.toLocaleString()} ₽`;
  document.getElementById('sponsorOverlay').style.display = 'flex';
  
  // Анимация баланса
  const balanceElement = document.getElementById('balanceDisplay');
  balanceElement.textContent = `Баланс: ${balance.toLocaleString()} ₽`;
  balanceElement.classList.add('balance-blink');
  setTimeout(() => balanceElement.classList.remove('balance-blink'), 800);
}

function closeSponsorMenu() {
  document.getElementById('sponsorOverlay').style.display = 'none';
}

function checkForPenalty() {
  if (Math.random() < 0.06) { // 6% шанс
    showPenalty();
  }
}

function showPenalty() {
  const reasons = [
    "За неспортивное поведение вашего игрока!",
    "Ваши болельщики навели беспредел!",
    "За оскорбительное высказывание в интервью!"
  ];
  
  document.getElementById('penaltyReason').textContent = reasons[Math.floor(Math.random() * reasons.length)];
  document.getElementById('penaltyOverlay').style.display = 'flex';
}

function handlePenaltyPayment() {
  const penaltyAmount = 1000000;
  
  if (balance >= penaltyAmount) {
    balance -= penaltyAmount;
    updateBalanceDisplay();
    document.getElementById('penaltyOverlay').style.display = 'none';
  } else {
    if (!sellPlayerToCoverPenalty(penaltyAmount)) {
      alert("Невозможно оплатить штраф! Продажа игроков не помогла.");
    }
    document.getElementById('penaltyOverlay').style.display = 'none';
  }
}

function sellPlayerToCoverPenalty(amountNeeded) {
  let totalSold = 0;
  const positionsOrder = ['CF', 'ST', 'CDM', 'GK']; // Приоритет продажи
  
  for (const position of positionsOrder) {
    if (positions[position].selected) {
      const player = positions[position].selected;
      const sellValue = Math.pow(player.rating, 4);
      
      // Продаем игрока
      balance += sellValue;
      totalSold += sellValue;
      positions[position].selected = null;
      
      // Обновляем интерфейс
      updateTeamSquadDisplay();
      checkAllSelected();
      userTeamRating = calculateUserTeamRating();
      updateTeamRatingCircle();
      updateBalanceDisplay();
      
      // Проверяем достаточно ли средств
      if (totalSold >= amountNeeded) {
        balance -= amountNeeded; // Вычитаем штраф
        updateBalanceDisplay();
        return true;
      }
    }
  }
  return false;
}

function updateBalanceDisplay() {
  const balanceElement = document.getElementById('balanceDisplay');
  balanceElement.textContent = `Баланс: ${balance.toLocaleString()} ₽`;
  balanceElement.classList.add('balance-blink');
  setTimeout(() => balanceElement.classList.remove('balance-blink'), 800);
}

function updateMarketPlayersRatings() {
    for (const position in positions) {
        const selectedPlayer = positions[position].selected;
        positions[position].players.forEach(player => {
            // Изменяем рейтинг только для игроков не в составе команды
            if (!selectedPlayer || player.nickname !== selectedPlayer.nickname) {
                const randomChange = Math.random();
                if (randomChange < 0.3) {          // 30%: +1 к рейтингу
                    player.rating = Math.min(110, player.rating + 1);
                } else if (randomChange < 0.6) {   // 30%: -1 к рейтингу
                    player.rating = Math.max(40, player.rating - 1);
                }
                // Если randomChange >= 0.60 (40%) - рейтинг не меняется
            }
        });
    }
}

        // Флаг для разрешения выхода без подтверждения
        let allowUnload = false;

        // Обработчик события beforeunload
        window.addEventListener('beforeunload', (e) => {
            if (!allowUnload) {
                e.preventDefault();
                e.returnValue = ''; // Для старых браузеров
            }
        });

        // Пример: Разрешить выход после отправки формы
        document.querySelector('form')?.addEventListener('submit', () => {
            allowUnload = true;
        });

document.addEventListener('DOMContentLoaded', function() {
    const infoIcon = document.querySelector('#teamSquadPanel .info-icon');
    const infoMenu = document.getElementById('infoMenu');
    let menuTimeout;

    // Обработчик клика по иконке
    infoIcon.addEventListener('click', function(e) {
        e.stopPropagation();
        clearTimeout(menuTimeout);
        
        // Позиционирование меню
        const iconRect = infoIcon.getBoundingClientRect();
        infoMenu.style.left = `${iconRect.left}px`;
        infoMenu.style.top = `${iconRect.top - infoMenu.offsetHeight - 10}px`;
        
        infoMenu.style.display = 'block';
        
        // Автоматическое скрытие через 3 секунды
        menuTimeout = setTimeout(() => {
            infoMenu.style.display = 'none';
        }, 4000);
    });

    // Закрытие меню при клике вне его
    document.addEventListener('click', function(e) {
        if (!infoMenu.contains(e.target) && e.target !== infoIcon) {
            infoMenu.style.display = 'none';
            clearTimeout(menuTimeout);
        }
    });

    // Закрытие меню при наведении мыши (опционально)
    infoMenu.addEventListener('mouseenter', function() {
        clearTimeout(menuTimeout);
    });
    
    infoMenu.addEventListener('mouseleave', function() {
        menuTimeout = setTimeout(() => {
            infoMenu.style.display = 'none';
        }, 5000);
    });
});

function handleSickness() {
    // Восстановление здоровья после матча
    if (sicknessActive) {
        sickPlayers.forEach(player => {
            const position = Object.keys(positions).find(pos => 
                positions[pos].selected?.nickname === player.nickname
            );
            if (position) {
                positions[position].selected.rating = player.originalRating;
            }
        });
        sickPlayers = [];
        sicknessActive = false;
    }

    // Проверка на новую болезнь (6% шанс)
    if (Math.random() < 0.06) {
        const activePlayers = Object.values(positions)
            .filter(pos => pos.selected)
            .map(pos => pos.selected);

        if (activePlayers.length > 0) {
            const victim = activePlayers[Math.floor(Math.random() * activePlayers.length)];
            const sicknessData = {
                nickname: victim.nickname,
                originalRating: victim.rating,
                position: Object.keys(positions).find(pos => 
                    positions[pos].selected?.nickname === victim.nickname
                )
            };

            // Уменьшаем рейтинг (минимум 40)
            victim.rating = Math.max(40, sicknessData.originalRating - 10);
            sickPlayers.push(sicknessData);
            sicknessActive = true;

            // Показываем модальное окно
            showSicknessMenu(sicknessData);
            updateTeamSquadDisplay();
            userTeamRating = calculateUserTeamRating();
            document.getElementById('userRatingDisplay').textContent = userTeamRating;
        }
    }
}

function showSicknessNotification(data) {
    const notification = document.createElement('div');
    notification.className = 'sickness-notification';
    notification.innerHTML = `
        ⚕️ ${data.nickname} заболел!<br>
        Рейтинг временно снижен до ${data.originalRating - 10}
    `;
    
    const eventsContainer = document.getElementById('eventsContainer');
    eventsContainer.insertBefore(notification, eventsContainer.firstChild);
    
    // Автоматическое скрытие через 5 секунд
    setTimeout(() => {
        notification.remove();
    }, 7000);
}

function showSicknessMenu(data) {
    const message = document.getElementById('sicknessMessage');
    message.innerHTML = `
        <div>${data.nickname} заболел!</div>
        <div class="sickness-details">
            Рейтинг временно снижен:<br>
            ${data.originalRating} → ${data.originalRating - 10}
        </div>
    `;
    document.getElementById('sicknessOverlay').style.display = 'flex';
}

function closeSicknessMenu() {
    document.getElementById('sicknessOverlay').style.display = 'none';
}

function updateCupDisplay() {
    const cupNames = {
        bronze: 'Бронзовый Кубок',
        silver: 'Серебряный Кубок', 
        gold: 'Золотой Кубок'
    };
    
    const cupColors = {
        bronze: '#cd7f32',
        silver: '#c0c0c0',
        gold: '#ffd700'
    };

    const cupDisplay = document.getElementById('cupDisplay');
    cupDisplay.textContent = cupNames[currentCup];
    cupDisplay.style.borderColor = cupColors[currentCup];
    cupDisplay.setAttribute('data-cup', currentCup);
}

function promoteCup() {
    switch(currentCup) {
        case 'bronze': 
            currentCup = 'silver';
            break;
        case 'silver': 
            currentCup = 'gold';
            break;
        case 'gold': 
            // Остаемся в золотом кубке
            break;
    }
    updateCupDisplay();
}

function relegateCup() {
    switch(currentCup) {
        case 'gold': 
            currentCup = 'silver';
            break;
        case 'silver': 
            currentCup = 'bronze';
            break;
        case 'bronze': 
            gameOver();
            return; // Прерываем выполнение
    }
    updateCupDisplay();
    
    
    // Обновляем отображение статистики
    updateTopScorersDisplay();
}

function gameOver() {
    isGameOver = true;
    
    // Останавливаем все интервалы
    clearInterval(matchInterval);
    
    // Скрываем все игровые окна

    document.getElementById('transferOverlay').style.display = 'none';
    document.getElementById('statsOverlay').style.display = 'flex'; // Показываем статистику
    
    // Обновляем кнопки в окне статистики
    document.getElementById('newSeasonButton').style.display = 'none';
    document.getElementById('closeStatsButton').style.display = 'block';
    document.getElementById('closeStatsButton').textContent = 'В главное меню';
    
    // Блокируем игровые взаимодействия
    document.querySelectorAll('.player-circle').forEach(circle => {
        circle.style.pointerEvents = 'none';
    });
    
    // Показываем финальное сообщение
    const statsTable = document.querySelector('#statsTable tbody');
    statsTable.innerHTML = `<tr><td colspan="2" style="color: #ff4444; text-align: center;">Игра окончена! Ваша команда вылетела из всех дивизионов</td></tr>`;
}

function showCupPrizeAnimation(amount, cupType) {
    const animElement = document.getElementById('cupPrizeAnimation');
    animElement.textContent = `+${amount.toLocaleString()} ₽`;
    animElement.className = `cup-prize-animation ${cupType}`;
    animElement.style.display = 'block';
    
    setTimeout(() => {
        animElement.style.display = 'none';
    }, 1500);
}

function showTeamsList() {
    const sortedTeams = [...opponentTeams].sort((a, b) => b.rating - a.rating);
    const teamList = document.getElementById('teamList');
    teamList.innerHTML = '';

    sortedTeams.forEach((team, index) => {
        const teamItem = document.createElement('div');
        teamItem.className = 'team-item';
        teamItem.innerHTML = `
            <div class="team-rank">${index + 1}</div>
            <img src="${team.logo}" class="team-logo-small" alt="${team.name}">
            <div class="team-name">${team.name}</div>
        `;
        teamList.appendChild(teamItem);
    });

    document.getElementById('teamsOverlay').style.display = 'flex';
}

function closeTeamsList() {
    document.getElementById('teamsOverlay').style.display = 'none';
}

const challenges = {
  "NoStuff [E-HAX2]": {
    positions: {
      GK: ["Jora young (56)", "diseased (70)"],
      CDM: ["adriano (83)", "ninowka (91)", "overdosed (55)"],
      ST: ["Malasi (55)", "Kor (92)", "тихий парень (49)"],
      CF: ["dark_pr1nce (63)", "iwersy (61)"]
    },
    budget: 20000000,
    cup: "silver"
  },
  "Томь [ЧР8]": {
    positions: {
      GK: ["Guus (46)", "rodrygo (46)"],
      CDM: ["F1nN3r (49)", "wizout (50)"],
      ST: ["Jora young (47)", "Falluntg (46)"],
      CF: ["Malasi (46)", "Rasputin (67)"]
    },
    budget: 2500000,
    cup: "bronze"
  },
  "NoStuff [ЛЧ4]": {
    positions: {
      GK: ["oskasya (51)", "-nK (90)"],
      CDM: ["Murphy (91)", "berserk (69)"],
      ST: ["Kor (95)", "friend shiro (50)"],
      CF: ["Jora young (62)", "pluto (67)"]
    },
    budget: 70000000,
    cup: "gold"
  },
  "ФК Ростов [25/26]": {
    positions: {
      GK: ["Р. Ятимов (70)", "Д. Одоевский (66)"],
      CDM: ["А. Лангович (69)", "А. Сутормин (71)", "В. Мелёхин (69)", "И. Вахания (71)"],
      ST: ["Х. Байрамян (71)", "М. Мохеби (72)", "К. Щетинин (72)"],
      CF: ["С. Роналдо (73)", "Н. Комличенко (73)"]
    },
    budget: 30000000,
    cup: "silver"
  },
  "Medvjedi [ЧР5]": {
    positions: {
      GK: ["ıIıIİıİIımusic (95)", "Nujabes (85)"],
      CDM: ["Ice Bear (87)", "waff (89)", "wool (73)"],
      ST: ["Wenamka (99)", "Stiks (84)"],
      CF: ["Pyro (90)", "IIIHA (85)"]
    },
    budget: 60000000,
    cup: "gold"
  },
  "NoStuff [ЧР14]": {
    positions: {
      GK: ["lis (60)", "Nagiев (46)"],
      CDM: ["шиммер (81)", "berserk (72)"],
      ST: ["pluto (59)", "Jora young (55)"],
      CF: ["Björn (80)", "Malasi (51)", "Alonso (53)"]
    },
    budget: 65000000,
    cup: "silver"
  },
  "NoStuff [ЧР13]": {
    positions: {
      GK: ["oskasya (50)", "wool (70)", "really (50)"],
      CDM: ["zxc (53)", "13setz (55)", "PPL217 (50)"],
      ST: ["pluto (57)", "Jora young (54)", "convulsive_seizures (51)", "honey (61)", "drakula (60)"],
      CF: ["ottop (71)", "Malasi (53)", "chesdes (53)", "friend shiro (50)", "berserk (72)"]
    },
    budget: 50000000,
    cup: "bronze"
  }
};

// Добавьте функции для работы с челленджами
function showChallengesMenu() {
  const container = document.getElementById('challengesList');
  container.innerHTML = '';
  
  // Преобразуем объект в массив и перемешиваем
  const challengesArray = Object.entries(challenges);
  const shuffledChallenges = shuffleArray(challengesArray);
  
  // Создаем элементы в перемешанном порядке
  for (const [name, data] of shuffledChallenges) {
    const challengeEl = document.createElement('div');
    challengeEl.className = 'challenge-item';
    challengeEl.innerHTML = `
      <div class="challenge-header">${name}</div>
      <div class="challenge-details">
        <div>Бюджет: ${data.budget.toLocaleString()} ₽</div>
        <div>Кубок: 
          <span class="challenge-cup cup-${data.cup}">
            ${data.cup === 'bronze' ? 'Бронзовый' : 
             data.cup === 'silver' ? 'Серебряный' : 'Золотой'}
          </span>
        </div>
      </div>
    `;
    
    challengeEl.addEventListener('click', () => startChallenge(name));
    container.appendChild(challengeEl);
  }
  
  document.getElementById('challengesOverlay').style.display = 'flex';
}

function closeChallengesMenu() {
  document.getElementById('challengesOverlay').style.display = 'none';
}

function startChallenge(name) {
  isChallengeMode = true;
  currentChallenge = challenges[name];
  
  // Установка параметров челленджа
  balance = currentChallenge.budget;
  currentCup = currentChallenge.cup;
  userTeamName = name;
  
  // Очистка текущего состава
  for (const position in positions) {
    positions[position].selected = null;
    positions[position].players = [];
  }

  // Заполнение игроков для челленджа
  for (const [pos, players] of Object.entries(currentChallenge.positions)) {
    positions[pos].players = players.map(p => {
      const [nickname, rating] = p.split(' (');
      return {
        nickname: nickname.trim(),
        rating: parseInt(rating),
        isChallenge: true
      };
    });
  }

  // Обновление интерфейса
  updateCupDisplay();
  document.getElementById('balanceDisplay').textContent = `Баланс: ${balance.toLocaleString()} ₽`;
  for (const position in positions) showPlayers(position);
  
  closeChallengesMenu();
  document.getElementById('challengesButton').style.display = 'none';
}
</script>

</body>
</html>
