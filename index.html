<!DOCTYPE html>
<html>
<head>
<link rel="icon" href="logo.png" type="image/x-icon">
<title>–î—Ä–∞—Ñ—Ç</title>
<style>
  body {
    margin: 0;
    padding: 0;
    min-height: 100vh;
    background: url('background.png') no-repeat center center fixed;
    background-size: cover;
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: 'Arial', sans-serif;
    color: white;
    position: relative;
  }

  body::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
     background: rgba(30, 30, 30, 0.5);
    z-index: -1;
  }

  .position-container {
    display: flex;
    flex-direction: column;
    margin: 25px 0;
    width: 90%;
    max-width: 1000px;
    background: linear-gradient(145deg, rgba(0,0,0,0.8), rgba(40,40,40,0.8));
    padding: 20px;
    border-radius: 15px;
    border: 1px solid rgba(0, 191, 255, 0.2);
    box-shadow: 0 0 15px rgba(0,0,0,0.5),
               0 0 6px rgba(0, 191, 255, 0.1) inset;
  }

  .players-row {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 25px;
    padding: 10px 0;
  }

  .player-circle {
    width: 130px;
    height: 130px;
    border-radius: 50%;
    border: 2px solid #000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    transform-style: preserve-3d;
  }

  .player-circle::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, 
      transparent, 
      rgba(255,255,255,0.1), 
      transparent);
    transform: rotate(45deg);
    transition: 0.5s;
    opacity: 0;
  }

  .player-circle:hover::before {
    opacity: 1;
    animation: playerShine 1.5s;
  }

  @keyframes playerShine {
    0% { transform: translateX(-50%) rotate(45deg); }
    100% { transform: translateX(150%) rotate(45deg); }
  }

  .player-rating {
    font-size: 58px;
    font-weight: 800;
    color: white;
    text-shadow: 2px 2px 6px rgba(0,0,0,0.8);
    position: absolute;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 2;
  }

  .player-nickname {
    font-size: 16px;
    font-weight: 500;
    color: white;
    position: absolute;
    top: 70%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
    text-align: center;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    padding: 0 5px;
    z-index: 2;
  }

  .selected {
    border-color: #00ff00;
    box-shadow: 0 0 12px #00ff00,
                0 0 20px rgba(0, 255, 0, 0.1);
    transform: scale(1.06);
  }

  .bronze { background: linear-gradient(135deg, #cd7f32 0%, #a97142 100%); }
  .silver { background: linear-gradient(135deg, #c0c0c0 0%, #909090 100%); }
  .gold { background: linear-gradient(135deg, #ffd700 0%, #daa520 100%); }
  .red {
    background: linear-gradient(135deg, #ff0000 0%, #8b0000 100%);
    box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
}

  #matchOverlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(5px);
  }

  #matchPopup {
    background: linear-gradient(145deg, #222, #1a1a1a);
    padding: 20px;
    border-radius: 15px;
    width: 95%;
    max-width: 700px;
    box-shadow: 0 0 20px rgba(0,0,0,0.6),
                0 0 8px rgba(0, 191, 255, 0.15);
    border: 1px solid rgba(0, 191, 255, 0.1);
    display: flex;
    flex-direction: column;
    max-height: 90vh;
    box-sizing: border-box;

}
  }

  .team-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0 10px;
  }

  .team-logo {
    width: 150px;
    height: 150px;
    object-fit: contain;
    filter: drop-shadow(0 0 8px rgba(0, 191, 255, 0.3));
  }

  .team-name-display {
    font-size: 16px;
    font-weight: 600;
    margin-top: 8px;
    color: #00bfff;
    text-shadow: 0 0 6px rgba(0, 191, 255, 0.3);
    white-space: nowrap;
  }

  #startButton {
    display: none;
    margin: 25px auto 0;
    padding: 14px 35px;
    font-size: 18px;
    font-weight: 600;
    background: linear-gradient(135deg, #0066cc, #00bfff);
    color: white;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 10px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  }

  #startButton::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255,255,255,0.12),
      transparent
    );
    transition: 0.5s;
  }

  #startButton:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.3);
  }

  #startButton:hover::before {
    left: 100%;
  }

  h2, h3 {
    text-align: center;
    margin: 0 0 20px;
    color: #00bfff;
    text-shadow: 0 0 10px rgba(0, 191, 255, 0.3);
    font-size: 1.4em;
  }

  .vs-container {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 15px 0;
    gap: 20px;
    flex-wrap: nowrap;
    width: 100%;
  }

  .score {
    font-size: 28px;
    font-weight: 800;
    margin: 12px 0;
    color: #fff;
    text-align: center;
    width: 100%;
    text-shadow: 0 0 10px rgba(0, 191, 255, 0.5);
  }

  .final-banner {
    background: linear-gradient(135deg, gold, #daa520);
    color: #000;
    padding: 8px 20px;
    border-radius: 6px;
    font-weight: 700;
    margin: 0 auto 15px;
    width: fit-content;
    box-shadow: 0 0 12px rgba(255,215,0,0.3);
    font-size: 14px;
  }

  .match-time {
    font-size: 16px;
    font-weight: 500;
    margin: 0 auto 10px;
    text-align: center;
    width: fit-content;
    color: #00bfff;
  }

  #eventsContainer {
    max-height: 118px;
    overflow-y: auto;
    overflow-x: hidden;
    margin: 1px 0;
    padding-right: 5px;
    width: calc(100% - 5px);
  }

  #eventsContainer::-webkit-scrollbar {
    width: 5px;
    background-color: rgba(0,0,0,0.25);
    border-radius: 2px;
  }

  #eventsContainer::-webkit-scrollbar-thumb {
    background-color: #00bfff;
    border-radius: 2px;
  }

  .goal-event {
    font-size: 13px;
    margin: 2px 0;
    padding: 4px 8px;
    border-radius: 4px;
    animation: goalFlash 0.8s;
    background: rgba(0,0,0,0.25);
    border-left: 3px solid;
    line-height: 1.2;
    min-height: 14px;
    display: flex;
    align-items: center;
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
  }

  .user-goal {
    color: #7cfc00;
    border-color: #7cfc00;
    text-shadow: 0 0 4px rgba(124,252,0,0.25);
  }

  .opponent-goal {
    color: #ff4500;
    border-color: #ff4500;
    text-shadow: 0 0 4px rgba(255,69,0,0.25);
  }

  @keyframes goalFlash {
    0% { transform: scale(1.05); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
  }

  .match-buttons-container {
    margin-top: auto;
    padding-top: 15px;
  }

  #playButton, #backToMenuButton {
    padding: 12px 28px;
    font-size: 16px;
    font-weight: 600;
    background: linear-gradient(135deg, #0066cc, #00bfff);
    color: white;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    display: block;
    margin: 8px auto;
    width: fit-content;
  }

  #playButton:hover, #backToMenuButton:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.25);
  }

  #statsOverlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.97);
    z-index: 2000;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(6px);
  }

  #statsPopup {
    background: linear-gradient(145deg, #1a1a1a, #222);
    padding: 20px;
    border-radius: 15px;
    width: 95%;
    max-width: 600px;
    box-shadow: 0 0 20px rgba(0,0,0,0.6),
                0 0 8px rgba(0, 191, 255, 0.15);
    border: 1px solid rgba(0, 191, 255, 0.1);
  }

  .stats-title {
    text-align: center;
    font-size: 20px;
    margin-bottom: 15px;
    color: #00bfff;
    text-shadow: 0 0 10px rgba(0, 191, 255, 0.3);
  }

  .stats-table {
    width: 100%;
    border-collapse: collapse;
    margin: 15px 0;
  }

  .stats-table th {
    background: linear-gradient(135deg, #0066cc, #00bfff);
    color: white;
    padding: 10px;
    font-weight: 600;
    font-size: 14px;
  }

  .stats-table td {
    padding: 8px 10px;
    background: rgba(255,255,255,0.05);
    border-bottom: 1px solid rgba(255,255,255,0.08);
    font-size: 13px;
  }

  .golden-ball {
    text-align: center;
    margin-top: 15px;
    padding: 12px;
    background: rgba(255,215,0,0.08);
    border-radius: 12px;
    border: 1px solid gold;
    box-shadow: 0 0 8px rgba(255,215,0,0.25);
  }

  .golden-ball-icon {
    font-size: 28px;
    margin-bottom: 8px;
    text-shadow: 0 0 12px gold;
  }

  #teamNameModal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 3000;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(4px);
  }

  #teamNamePopup {
    background: linear-gradient(145deg, #222, #1a1a1a);
    padding: 20px;
    border-radius: 15px;
    width: 95%;
    max-width: 450px;
    box-shadow: 0 0 20px rgba(0,0,0,0.6),
                0 0 8px rgba(0, 191, 255, 0.15);
    border: 1px solid rgba(0, 191, 255, 0.1);
  }

  #teamNameInput {
    width: 100%;
    padding: 10px;
    font-size: 14px;
    margin: 12px 0;
    border-radius: 6px;
    border: 1px solid #00bfff;
    background: rgba(0,0,0,0.4);
    color: white;
    text-align: center;
    transition: all 0.3s;
  }

  #teamNameInput:focus {
    outline: none;
    box-shadow: 0 0 8px rgba(0, 191, 255, 0.2);
  }

  #confirmTeamName {
    padding: 10px 25px;
    font-size: 14px;
    background: linear-gradient(135deg, #0066cc, #00bfff);
    color: white;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  }

  #confirmTeamName:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 10px rgba(0,0,0,0.25);
  }

  .game-style-buttons {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin: 20px 0;
  }

  .style-button {
    padding: 8px 16px;
    font-size: 12px;
    font-weight: 600;
    border: none;
    border-radius: 18px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    background-size: 200% auto;
  }

  .style-button.defensive {
    background: linear-gradient(135deg, #4CAF50, #2E8B57);
  }

  .style-button.balanced {
    background: linear-gradient(135deg, #2196F3, #1E90FF);
  }

  .style-button.offensive {
    background: linear-gradient(135deg, #f44336, #FF4500);
  }

  .style-button.selected {
    transform: scale(1.05);
    box-shadow: 0 0 15px rgba(255,255,255,0.3),
                0 4px 10px rgba(0,0,0,0.2);
  }

  .style-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 10px rgba(0,0,0,0.25);
  }

#transferOverlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 1500;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(5px);
}

#transferPopup {
    background: linear-gradient(145deg, #222, #1a1a1a);
    padding: 20px;
    border-radius: 15px;
    width: 95%;
    max-width: 700px;
    box-shadow: 0 0 20px rgba(0,0,0,0.6),
                0 0 8px rgba(0, 191, 255, 0.15);
    border: 1px solid rgba(0, 191, 255, 0.1);
    display: flex;
    flex-direction: column;
    align-items: center;
}

.transfer-title {
    font-size: 24px;
    margin-bottom: 20px;
    color: #00bfff;
    text-shadow: 0 0 10px rgba(0, 191, 255, 0.3);
    text-align: center;
}

.transfer-players {
    display: flex;
    justify-content: space-between;
    width: 100%;
    margin: 20px 0;
}

.transfer-player {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 45%;
}

.transfer-player-title {
    font-size: 16px;
    margin-bottom: 10px;
    color: white;
    text-align: center;
}

.transfer-buttons {
    display: flex;
    gap: 20px;
    margin-top: 20px;
}

.transfer-button {
    padding: 12px 25px;
    font-size: 16px;
    font-weight: 600;
    background: linear-gradient(135deg, #0066cc, #00bfff);
    color: white;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

.transfer-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.25);
}

.transfer-button.reject {
    background: linear-gradient(135deg, #cc3300, #ff4500);
}

.year-display {
    position: fixed;
    top: 10px;
    right: 10px;
    font-size: 14px;
    color: rgba(255, 255, 255, 0.7);
    background: rgba(0, 0, 0, 0.5);
    padding: 5px 10px;
    border-radius: 15px;
    z-index: 2000; /* –£–≤–µ–ª–∏—á—å—Ç–µ z-index —á—Ç–æ–±—ã —ç–ª–µ–º–µ–Ω—Ç –±—ã–ª –ø–æ–≤–µ—Ä—Ö –≤—Å–µ—Ö –æ–∫–æ–Ω */
    pointer-events: none; /* –ß—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—é —Å –¥—Ä—É–≥–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ */
}

.player-circle.bronze,
.player-circle.silver,
.player-circle.gold,
.player-circle.red {
    background-size: cover !important;
    background-repeat: no-repeat !important;
}

/* –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–µ–∫—Ü–∏—é style */
#teamSquadPanel {
    background: rgba(0, 0, 0, 0.5);
    border-radius: 10px;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid rgba(0, 191, 255, 0.2);
    max-height: 200px;
    overflow-y: auto;
}

#teamSquadPanel h3 {
    text-align: center;
    margin: 0 0 10px;
    color: #00bfff;
    font-size: 16px;
}

#teamSquadPlayers {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
}

.squad-player {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 80px;
}

.squad-player-circle {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: 1px solid #000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
}

.squad-player-rating {
    font-size: 20px;
    font-weight: 600;
    color: white;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.squad-player-nickname {
    font-size: 10px;
    font-weight: 500;
    color: white;
    text-align: center;
    margin-top: 5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    width: 100%;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Ü–≤–µ—Ç–æ–≤ —Ä–µ–π—Ç–∏–Ω–≥–∞ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –æ—Å–Ω–æ–≤–Ω—ã–º –∏–≥—Ä–æ–∫–∞–º) */
.squad-player-circle.bronze { background: linear-gradient(135deg, #cd7f32 0%, #a97142 100%); }
.squad-player-circle.silver { background: linear-gradient(135deg, #c0c0c0 0%, #909090 100%); }
.squad-player-circle.gold { background: linear-gradient(135deg, #ffd700 0%, #daa520 100%); }
.squad-player-circle.red { background: linear-gradient(135deg, #ff0000 0%, #8b0000 100%); }

.scorers-display {
    position: fixed;
    top: 40px; /* –†–∞—Å–ø–æ–ª–∞–≥–∞–µ–º –ø–æ–¥ year-display */
    right: 10px;
    font-size: 12px;
    color: white;
    background: rgba(0, 0, 0, 0.7);
    padding: 8px 12px;
    border-radius: 8px;
    z-index: 2001;
    pointer-events: none;
    max-width: 200px;
    max-height: 200px;
    overflow-y: auto;
}

.scorers-display::-webkit-scrollbar {
    width: 4px;
}

.scorers-display::-webkit-scrollbar-thumb {
    background-color: #00bfff;
    border-radius: 2px;
}
</style>
</head>
<body>
<h2>–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Å—Ç–∞–≤ –∫–æ–º–∞–Ω–¥—ã</h2>

<div class="position-container" id="gk-container">
  <h3>–í—Ä–∞—Ç–∞—Ä—å (GK)</h3>
  <div class="players-row"></div>
</div>

<div class="position-container" id="cdm-container">
  <h3>–û–ø–æ—Ä–Ω—ã–π –ø–æ–ª—É–∑–∞—â–∏—Ç–Ω–∏–∫ (DM)</h3>
  <div class="players-row"></div>
</div>

<div class="position-container" id="st-container">
  <h3>–ù–∞–ø–∞–¥–∞—é—â–∏–π (ST)</h3>
  <div class="players-row"></div>
</div>

<div class="position-container" id="cf-container">
  <h3>–ù–∞–ø–∞–¥–∞—é—â–∏–π (ST)</h3>
  <div class="players-row"></div>
</div>

<button id="startButton" onclick="showTeamNameModal()">–ù–∞—á–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä</button>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤–≤–æ–¥–∞ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã -->
<div id="teamNameModal">
  <div id="teamNamePopup">
    <h3>–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–π –∫–æ–º–∞–Ω–¥—ã</h3>
    <input type="text" id="teamNameInput" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã" maxlength="20">
    <button id="confirmTeamName" onclick="confirmTeamName()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
  </div>
</div>

<div id="matchOverlay">
  <div id="matchPopup">
   <div class="year-display" id="yearDisplay">–°–µ–∑–æ–Ω 1</div>
   <div id="topScorersDisplay" class="scorers-display"></div>
    <div id="teamSquadPanel">
      <h3>–°–æ—Å—Ç–∞–≤ –∫–æ–º–∞–Ω–¥—ã</h3>
      <div id="teamSquadPlayers"></div>
    </div>
    <div id="roundTitle"></div>
    <div class="game-style-buttons">
      <button class="style-button defensive" onclick="setGameStyle('defensive')">–û–±–æ—Ä–æ–Ω–∏—Ç–µ–ª—å–Ω—ã–π</button>
      <button class="style-button balanced selected" onclick="setGameStyle('balanced')">–ë–∞–ª–∞–Ω—Å</button>
      <button class="style-button offensive" onclick="setGameStyle('offensive')">–ê—Ç–∞–∫—É—é—â–∏–π</button>
    </div>
    <div class="vs-container">
      <div style="display: flex; flex-direction: column; align-items: center;">
        <div class="player-circle" style="margin-bottom: 25px;" id="teamRatingCircle">
          <div class="player-rating" id="userRatingDisplay"></div>
          <div class="player-nickname">–í–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞</div>
        </div>
        <div class="team-name-display" id="userTeamName"></div>
      </div>
      <span style="margin: 0 25px; font-size: 28px;">VS</span>
      <div style="display: flex; flex-direction: column; align-items: center;">
        <img id="opponentLogo" alt="Opponent" class="team-logo">
        <div class="team-name-display" id="opponentName"></div>
      </div>
    </div>
    <div id="matchTime" class="match-time">0:00</div>
    <div id="scoreDisplay" class="score">0 : 0</div>
    <div id="eventsContainer" style="min-height: 60px;"></div>
    <p id="matchResult" style="margin: 25px 0; font-size: 20px;"></p>
    <button id="playButton" onclick="playMatch()" style="padding: 12px 25px; font-size: 18px; background-color: #2196F3; color: white; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s;">–ò–≥—Ä–∞—Ç—å –º–∞—Ç—á</button>
    <button id="backToMenuButton" onclick="backToMenu()">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é</button>
  </div>
</div>

<div id="statsOverlay">
  <div id="statsPopup">
    <div class="stats-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç—É—Ä–Ω–∏—Ä–∞</div>
    <table class="stats-table" id="statsTable">
      <thead>
        <tr>
          <th>–ò–≥—Ä–æ–∫</th>
          <th>–ì–æ–ª—ã</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="goldenBallContainer"></div>
    <button id="closeStatsButton" onclick="closeStats()" style="padding: 12px 25px; font-size: 18px; background-color: #2196F3; color: white; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s; margin-top: 20px; display: block; margin-left: auto; margin-right: auto;">–ó–∞–∫—Ä—ã—Ç—å</button>
    <button id="newSeasonButton" onclick="startNewSeason()" style="padding: 12px 25px; font-size: 18px; background: linear-gradient(135deg, #4CAF50, #2E8B57); color: white; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s; margin-top: 20px; display: none; margin-left: auto; margin-right: auto;">–°–ª–µ–¥—É—é—â–∏–π —Å–µ–∑–æ–Ω</button>
  </div>
</div>

<div id="transferOverlay">
    <div id="transferPopup">
        <div class="transfer-title">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä</div>
        <div class="transfer-players">
            <div class="transfer-player">
                <div class="transfer-player-title">–í–∞—à —Ç–µ–∫—É—â–∏–π –∏–≥—Ä–æ–∫</div>
                <div id="currentPlayer" class="player-circle gold">
                    <div class="player-rating">75</div>
                    <div class="player-nickname">–ò–≥—Ä–æ–∫</div>
                </div>
            </div>
            <div class="transfer-player">
                <div class="transfer-player-title">–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–π –∏–≥—Ä–æ–∫</div>
                <div id="offeredPlayer" class="player-circle gold">
                    <div class="player-rating">80</div>
                    <div class="player-nickname">–ò–≥—Ä–æ–∫</div>
                </div>
            </div>
        </div>
        <div class="transfer-buttons">
            <button class="transfer-button" onclick="acceptTransfer()">–û–±–º–µ–Ω—è—Ç—å</button>
            <button class="transfer-button reject" onclick="rejectTransfer()">–û—Ç–∫–∞–∑–∞—Ç—å</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∏–≥—Ä–æ–∫–∞ -->
<div id="trainingOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); z-index: 2500; align-items: center; justify-content: center; backdrop-filter: blur(5px);">
  <div id="trainingPopup" style="background: linear-gradient(145deg, #222, #1a1a1a); padding: 30px; border-radius: 15px; width: 95%; max-width: 500px; box-shadow: 0 0 20px rgba(0,0,0,0.6), 0 0 8px rgba(0, 191, 255, 0.15); border: 1px solid rgba(0, 191, 255, 0.1);">
    <h3 style="text-align: center; margin-bottom: 20px; color: #00bfff;">–ö–æ–≥–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è? (+5 –†–µ–π—Ç–∏–Ω–≥)</h3>
    <div id="trainingPlayers" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin: 20px 0;"></div>
    <button id="confirmTraining" onclick="confirmTraining()" style="padding: 12px 25px; font-size: 16px; font-weight: 600; background: linear-gradient(135deg, #0066cc, #00bfff); color: white; border: none; border-radius: 25px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: block; margin: 0 auto;">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
  </div>
</div>

<div id="newSeasonOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); z-index: 3500; align-items: center; justify-content: center; backdrop-filter: blur(5px);">
  <div style="background: linear-gradient(145deg, #222, #1a1a1a); padding: 30px; border-radius: 15px; width: 95%; max-width: 500px; box-shadow: 0 0 20px rgba(0,0,0,0.6), 0 0 8px rgba(0, 191, 255, 0.15); border: 1px solid rgba(0, 191, 255, 0.1);">
    <h3 style="text-align: center; margin-bottom: 20px; color: #00bfff;">–í–∞—à–∏ –∏–≥—Ä–æ–∫–∏ —É–ª—É—á—à–∏–ª–∏—Å—å (+2 –†–µ–π—Ç–∏–Ω–≥ –∫–∞–∂–¥–æ–º—É)</h3>
    <div id="improvedPlayers" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin: 20px 0;"></div>
    <button onclick="continueAfterSeason()" style="padding: 12px 25px; font-size: 16px; font-weight: 600; background: linear-gradient(135deg, #0066cc, #00bfff); color: white; border: none; border-radius: 25px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: block; margin: 0 auto;">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
  </div>
</div>

<script>
  // –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–æ–Ω—Å–æ–ª–∏
  document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
  });
  
  document.addEventListener('keydown', function(e) {
    // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+Shift+C, Ctrl+U
    if (e.key === 'F12' || 
        (e.ctrlKey && e.shiftKey && e.key === 'I') || 
        (e.ctrlKey && e.shiftKey && e.key === 'J') ||
        (e.ctrlKey && e.shiftKey && e.key === 'C') ||
        (e.ctrlKey && e.key === 'U')) {
      e.preventDefault();
    }
  });
  


  const positions = {
    GK: { 
        container: document.getElementById('gk-container').querySelector('.players-row'), 
        selected: null, 
        players: [
            { rating: 95, nickname: "Nsk" },
            { rating: 91, nickname: "-nK" },
            { rating: 88, nickname: "–°–∞–≤–∏—Ç–∞—Ä" },
            { rating: 83, nickname: "ya tyanochka" },
            { rating: 84, nickname: "Fade Away" },
            { rating: 76, nickname: "diseased" },
            { rating: 82, nickname: "drak" },
            { rating: 65, nickname: "Nick" },
            { rating: 59, nickname: "natsukasiy" },
            { rating: 75, nickname: "Bj√∂rn" },
            { rating: 59, nickname: "pluto" },
            { rating: 46, nickname: "Nagiev" },
            { rating: 53, nickname: "oskasya" },
            { rating: 55, nickname: "Sunex" },
            { rating: 60, nickname: "lis" },
            { rating: 88, nickname: "—Ä–∞–≥—É–ª—å" },
            { rating: 64, nickname: "LS" },
            { rating: 65, nickname: "–ø–∏—É—à–∫–∞" },
            { rating: 41, nickname: "NO_ON" },
            { rating: 43, nickname: "Sky tempi" },
            { rating: 54, nickname: "–ú–∞–º–∞ –í–æ–Ω—Ç–∏" },
            { rating: 56, nickname: "UCHIHAS" },
            { rating: 42, nickname: "denji-" },
            { rating: 54, nickname: "yowai" },
            { rating: 76, nickname: "Yoze" },
            { rating: 56, nickname: "servi" },
            { rating: 54, nickname: "–í–∞—Å–∏–ª–∏–π_–®–∞—Ç—É–Ω–æ–≤—Å–∫–∏–π." },
            { rating: 64, nickname: "Yedlin" },
            { rating: 89, nickname: "Madcon" },
            { rating: 82, nickname: "cotty" },
            { rating: 75, nickname: "Marco Reus" },
            { rating: 59, nickname: "zxz" },
            { rating: 45, nickname: "–¢—Ä–∏–ø" },
            { rating: 91, nickname: "Maddude" },
            { rating: 41, nickname: "Shaky" },
            { rating: 50, nickname: "–ö–ª–∞—É–¥–∏–Ω—å–æ" },
            { rating: 48, nickname: "Yorho" },
            { rating: 50, nickname: "Avis" },
        ]
    },
    CDM: { 
        container: document.getElementById('cdm-container').querySelector('.players-row'), 
        selected: null, 
        players: [
            { rating: 93, nickname: "Wenamka" },
            { rating: 95, nickname: "Twistik" },
            { rating: 91, nickname: "Murphy" },
            { rating: 85, nickname: "koopinoff" },
            { rating: 89, nickname: "yokk" },
            { rating: 80, nickname: "—à–∏–º–º–µ—Ä" },
            { rating: 76, nickname: "zark-" },
            { rating: 65, nickname: "ottop" },
            { rating: 70, nickname: "wool" },
            { rating: 64, nickname: "Big boo" },
            { rating: 53, nickname: "friend shiro" },
            { rating: 52, nickname: "yeapez" },
            { rating: 57, nickname: "DENRELAS" },
            { rating: 55, nickname: "zxc" },
            { rating: 57, nickname: "13setz" },
            { rating: 90, nickname: "aero" },
            { rating: 80, nickname: "IIIHA" },
            { rating: 79, nickname: "boda" },
            { rating: 61, nickname: "pure" },  
            { rating: 54, nickname: "Scqxd" },
            { rating: 85, nickname: "adriano" }, 
            { rating: 90, nickname: "Solence" }, 
            { rating: 72, nickname: "Impo" }, 
            { rating: 52, nickname: "Jakov" }, 
            { rating: 63, nickname: "MaSsik" }, 
            { rating: 51, nickname: "—á–ø–µ–∫" }, 
            { rating: 57, nickname: "Candy" }, 
            { rating: 79, nickname: "Emkay" }, 
            { rating: 78, nickname: "Noshka" },
            { rating: 68, nickname: "jesslach" },
            { rating: 50, nickname: "fiograf " },
            { rating: 88, nickname: "Bachira" },
            { rating: 90, nickname: "modric8" },
            { rating: 94, nickname: "Anddy" },
            { rating: 89, nickname: "ƒ±Iƒ±Iƒ∞ƒ±ƒ∞Iƒ±music" },
            { rating: 85, nickname: "soul" },
            { rating: 52, nickname: "Shtrembl" },
            { rating: 45, nickname: " Ä ú·¥á…™…¥·¥ç·¥á·¥õ·¥Ä ü" },
      ]
    },
    ST: { 
        container: document.getElementById('st-container').querySelector('.players-row'), 
        selected: null, 
        players: [
            { rating: 95, nickname: "Kor" },
            { rating: 91, nickname: "Filp" },
            { rating: 89, nickname: "lopo" },
            { rating: 81, nickname: "Tokito" },
            { rating: 87, nickname: "–∑–ª–∞—Ç–∞–Ω" },
            { rating: 77, nickname: "SUS" },
            { rating: 79, nickname: "Kiw" },
            { rating: 79, nickname: "Cyanide" },
            { rating: 74, nickname: "–†–∞–∑–±–µ—Ä—É—Å—å" },
            { rating: 74, nickname: "Lean" },
            { rating: 58, nickname: "Jora young" },
            { rating: 53, nickname: "godmoves" },
            { rating: 49, nickname: "Verty" },
            { rating: 50, nickname: "fart" },
            { rating: 53, nickname: "—Ç–∏—Ö–∏–π –ø–∞—Ä–µ–Ω—å" },
            { rating: 89, nickname: "elox." },
            { rating: 69, nickname: "–ñ–º—ã—Ö" },
            { rating: 63, nickname: "zvezzda" },
            { rating: 58, nickname: "dark_pr1nce" },
            { rating: 49, nickname: "rydii" },
            { rating: 69, nickname: "Timoxa196" },
            { rating: 81, nickname: "leT1m" },
            { rating: 60, nickname: "deko" },
            { rating: 49, nickname: "Nagi" },
            { rating: 67, nickname: "–í–æ–ª—å–∫–∞" },
            { rating: 59, nickname: "–±—É—Å—è" },
            { rating: 66, nickname: "iRaJ-" },
            { rating: 90, nickname: "Oven" },
            { rating: 84, nickname: "gunyasha" },
            { rating: 43, nickname: "–≥–∞–º–∏–∫" },
            { rating: 77, nickname: "R3venGe-" },
            { rating: 46, nickname: "BeNzEmA" },
            { rating: 95, nickname: "KING" },
            { rating: 40, nickname: "Sivohin" },
            { rating: 40, nickname: "MR. LUKA" },
            { rating: 40, nickname: "plxdy" },
            { rating: 42, nickname: "yupix" },

        ]
    },
    CF: { 
        container: document.getElementById('cf-container').querySelector('.players-row'), 
        selected: null, 
        players: [
            { rating: 92, nickname: "ninowka" },
            { rating: 90, nickname: "step-" },
            { rating: 95, nickname: "Pyro" },
            { rating: 88, nickname: "iks" },
            { rating: 83, nickname: "parma2013" },
            { rating: 80, nickname: "Philip Brooks" },
            { rating: 78, nickname: "sproty" },
            { rating: 73, nickname: "berserk" },
            { rating: 73, nickname: "iwd" },
            { rating: 67, nickname: "Wilian31" },
            { rating: 53, nickname: "Malasi" },
            { rating: 54, nickname: "chesdes" },
            { rating: 40, nickname: "–Ø–†–´–ô" },
            { rating: 50, nickname: "–ò–ª—É–∞" },
            { rating: 40, nickname: "PenguinN10" },
            { rating: 85, nickname: "Shepard" },
            { rating: 60, nickname: "Guus" },
            { rating: 60, nickname: "drakula" },
            { rating: 54, nickname: "zaraki" },
            { rating: 47, nickname: "holodok" },
            { rating: 52, nickname: "Chex" },
            { rating: 60, nickname: "butterfly" },
            { rating: 76, nickname: "Eazw" },
            { rating: 50, nickname: "flourgame" },
            { rating: 67, nickname: "Yapo" },
            { rating: 49, nickname: "–î–∞–Ω–∏—Å" },
            { rating: 95, nickname: "aMp" },
            { rating: 90, nickname: "Avr" },
            { rating: 91, nickname: "–•@—Ç–∏–∫–æ" },
            { rating: 77, nickname: "Rasputin" },
            { rating: 45, nickname: "nevzyy" },
            { rating: 45, nickname: "convulsive_seizures" },
            { rating: 95, nickname: "Kl" },
            { rating: 65, nickname: "mY_ruleZ" },
            { rating: 92, nickname: "Levaldo" },
            { rating: 50, nickname: "GRENKA" },
            { rating: 44, nickname: "Faya (—ã)" },
        ]
    }
};

  const numPlayersToShow = 5;
  const startButton = document.getElementById('startButton');

  const opponentTeams = [
    { name: "GreenLand", logo: "logo_GreenLand.png", rating: 67 },
    { name: "KUMYS POWER", logo: "logo_KUMYS POWER.png", rating: 64 },
    { name: "One more pass", logo: "logo_One more pass.png", rating: 64 },
    { name: "IDM", logo: "logo_IDM.png", rating: 60 },
    { name: "SHULC RS", logo: "logo_SHULC RS.png", rating: 55 },
    { name: "FC United", logo: "logo_FC United.png", rating: 63 },
    { name: "Karasuno", logo: "logo_Karasuno.png", rating: 58 },
    { name: "The Last Dance", logo: "logo_The Last Dance.png", rating: 47 },
    { name: "–•–ö –ß–µ—Ä—Ç–∞–Ω–æ–≤–æ 2012", logo: "logo_–•–ö –ß–µ—Ä—Ç–∞–Ω–æ–≤–æ 2012.png", rating: 50 },
    { name: "Anubis", logo: "logo_Anubis.png", rating: 45 },
    { name: "Bloodstream", logo: "logo_Bloodstream.png", rating: 57 },
    { name: "Anji", logo: "logo_Anji.png", rating: 55 },
    { name: "–û–∫—Å–∏–¥–∏—É–º", logo: "logo_–û–∫—Å–∏–¥–∏—É–º.png", rating: 50 },
    { name: "–î–µ—Ç–∏ –°–æ–ª–Ω—Ü–∞", logo: "logo_–î–µ—Ç–∏ –°–æ–ª–Ω—Ü–∞.png", rating: 47 },
    { name: "–•–æ–º—è–∫–∏", logo: "logo_–•–æ–º—è–∫–∏.png", rating: 45 },
    { name: "Bolich", logo: "logo_Bolich.png", rating: 43 },
    { name: "NoStuff", logo: "logo_NoStuff.png", rating: 44 },
    { name: "Monkey Business", logo: "logo_Monkey Business.png", rating: 51 },
    { name: "Everton", logo: "logo_Everton.png", rating: 40 },
    { name: "–ó–ª—ã–µ –±–æ–±—Ä—ã", logo: "logo_–ó–ª—ã–µ –±–æ–±—Ä—ã.png", rating: 38 },
    { name: "Water Heroes", logo: "logo_Water Heroes.png", rating: 40 },
    { name: "–ü–µ—á–µ–Ω–µ–≥–∏", logo: "logo_–ü–µ—á–µ–Ω–µ–≥–∏.png", rating: 41 },
    { name: "–ë—Ä–∞—Ç–µ–∫–∏", logo: "logo_–ë—Ä–∞—Ç–µ–∫–∏.png", rating: 34 },
    { name: "HC Platina", logo: "logo_HC Platina.png", rating: 33 },
    { name: "—Å–º–µ–®–ê–†–∏–∫–∏", logo: "logo_—Å–º–µ–®–ê–†–∏–∫–∏.png", rating: 31 },
    { name: "FC Miami Mamoball", logo: "logo_FC Miami Mamoball.png", rating: 25 },
    { name: "TikTok House", logo: "logo_TikTok House.png", rating: 22 },
    { name: "Moon Lovers", logo: "logo_Moon Lovers.png", rating: 27 },
    { name: "–ü–æ–∫–æ–ª–µ–Ω–∏–µ –ß—É–¥–µ—Å", logo: "logo_–ü–æ–∫–æ–ª–µ–Ω–∏–µ –ß—É–¥–µ—Å.png", rating: 20 },
    { name: "edelweiss", logo: "logo_edelweiss.png", rating: 20 },
    { name: "AS Tatarstan", logo: "logo_AS Tatarstan.png", rating: 65 },
    { name: "Medvjedi", logo: "logo_Medvjedi.png", rating: 64 },
    { name: "SkyRed", logo: "logo_SkyRed.png", rating: 33 },
    { name: "–í–µ—á–µ—Ä–Ω–∏–µ –∑–≤–µ–∑–¥—ã", logo: "logo_–í–µ—á–µ—Ä–Ω–∏–µ –∑–≤–µ–∑–¥—ã.png", rating: 50 },
    { name: "Bounty", logo: "logo_Bounty.png", rating: 40 },
    { name: "The Beatles", logo: "logo_The Beatles.png", rating: 38 },
    { name: "FC6", logo: "logo_FC6.png", rating: 18 },
    { name: "–¢–æ–º—å", logo: "logo_–¢–æ–º—å.png", rating: 19 },
    { name: "Yokohama City", logo: "logo_Yokohama City.png", rating: 40 },
    { name: "Metallurg", logo: "logo_Metallurg.png", rating: 44 },
    { name: "Smurfiki", logo: "logo_Smurfiki.png", rating: 64 },
    { name: "Grusteam", logo: "logo_Grusteam.png", rating: 63 },
    { name: "So EZ", logo: "logo_So EZ.png", rating: 52 },
    { name: "The Evil Agents", logo: "logo_The Evil Agents.png", rating: 50 },
    { name: "Freak Circus", logo: "logo_Freak Circus.png", rating: 50 },
    { name: "Manchester United", logo: "logo_Manchester United.png", rating: 40 },
    { name: "Wings Bird", logo: "logo_Wings Bird.png", rating: 40 },
    { name: "Interment", logo: "logo_Interment.png", rating: 20 },
    { name: "Internet Heroes", logo: "logo_Internet Heroes.png", rating: 30 },
    { name: "TMNT", logo: "logo_TMNT.png", rating: 40 },

    { name: "FEAR", logo: "logo_FEAR.png", rating: 65 },
    { name: "Flyin' ≈†krtels", logo: "logo_Fly.png", rating: 65 },
    { name: "Ghouls", logo: "logo_Ghouls.png", rating: 45 },
    { name: "Legendary Stars", logo: "logo_Legendary Stars.png", rating: 50 },
    { name: "Pornhub", logo: "logo_Pornhub.png", rating: 50 },
    { name: "HaxMill City", logo: "logo_HaxMill City.png", rating: 20 },
    { name: "Need Music", logo: "logo_Need Music.png", rating: 20 },
    { name: "HC Glass", logo: "logo_HC Glass.png", rating: 40 },
    { name: "Karabah", logo: "logo_Karabah.png", rating: 20 },
    { name: "–®–∞–π–∫–∞-04", logo: "logo_–®–∞–π–∫–∞-04.png", rating: 37 },

];

let currentRound = 32;
let currentYear = 1;
let userTeamRating = 0;
let currentOpponent = null;
let matchInterval = null;
let currentTime = 0;
let userGoals = 0;
let opponentGoals = 0;
let goalEvents = [];
let userTeamName = "–í–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞";
let usedOpponents = [];
let scorers = {}; // Object to track player goals
let allTimeScorers = {}; // –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
let seasonScorers = {};  // –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–µ–∑–æ–Ω–∞
let tournamentWon = false;
let gameStyle = 'balanced'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–∞–ª–∞–Ω—Å
let isInLowerBracket = false; // –ù–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –∏–≥—Ä–æ–∫ –≤ –Ω–∏–∂–Ω–µ–π —Å–µ—Ç–∫–µ
let lowerBracketRound = 0; // –¢–µ–∫—É—â–∏–π —Ä–∞—É–Ω–¥ –≤ –Ω–∏–∂–Ω–µ–π —Å–µ—Ç–∫–µ

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å—Ç–∏–ª—è –∏–≥—Ä—ã
function setGameStyle(style) {
    gameStyle = style;
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
    document.querySelectorAll('.style-button').forEach(btn => {
        btn.classList.remove('selected');
    });
    document.querySelector(`.style-button.${style}`).classList.add('selected');
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –≤–≤–æ–¥–æ–º –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã
function showTeamNameModal() {
    if (!checkAllSelected()) {
        alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–æ–≤ –Ω–∞ –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏—è—Ö!");
        return;
    }
    document.getElementById('teamNameModal').style.display = 'flex';
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã
function confirmTeamName() {
    const nameInput = document.getElementById('teamNameInput');
    if (nameInput.value.trim() === '') {
        alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã!");
        return;
    }
    userTeamName = nameInput.value.trim();
    document.getElementById('teamNameModal').style.display = 'none';
    startTournament();
}

function backToMenu() {
    window.location.href = "https://jorayoung.github.io/DraftMenu/";
}

function getRandomScorer(position) {
    if (position === "GK") {
        // –®–∞–Ω—Å 1%, —á—Ç–æ –≤—Ä–∞—Ç–∞—Ä—å –∑–∞–±—å–µ—Ç –≥–æ–ª
        if (Math.random() < 0.01) {
            return positions[position].selected.nickname;
        }
        return null;
    }
    
    const players = positions[position].players;
    const activePlayers = players.filter(p => positions[position].selected && 
        positions[position].selected.nickname === p.nickname);
    
    if (activePlayers.length > 0) {
        return activePlayers[0].nickname;
    }
    
    const availablePlayers = positions[position].players;
    if (availablePlayers.length > 0) {
        return availablePlayers[Math.floor(Math.random() * availablePlayers.length)].nickname;
    }
    return "–ò–≥—Ä–æ–∫";
}

function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

function getNextOpponent() {
    const availableTeams = opponentTeams.filter(team => !usedOpponents.includes(team.name));
    
    if (availableTeams.length === 0) {
        usedOpponents = [];
        return opponentTeams[Math.floor(Math.random() * opponentTeams.length)];
    }
    
    availableTeams.sort((a, b) => b.rating - a.rating);
    
    const weights = availableTeams.map((team, index) => {
        const baseWeight = availableTeams.length - index;
        const randomFactor = Math.random() * 3;
        return baseWeight + randomFactor;
    });
    
    const sumWeights = weights.reduce((a, b) => a + b, 0);
    const normalizedWeights = weights.map(w => w / sumWeights);
    
    let random = Math.random();
    let weightSum = 0;
    for (let i = 0; i < availableTeams.length; i++) {
        weightSum += normalizedWeights[i];
        if (random <= weightSum) {
            return availableTeams[i];
        }
    }
    
    return availableTeams[0];
}

function showPlayers(position) {
    shuffleArray(positions[position].players);
    positions[position].container.innerHTML = '';

    for (let i = 0; i < numPlayersToShow; i++) {
        if (!positions[position].players[i]) continue;
        const playerData = positions[position].players[i];
        
        const playerWrapper = document.createElement('div');
        playerWrapper.className = 'player-wrapper';
        
        const playerCircle = document.createElement('div');
        playerCircle.className = 'player-circle';
        playerCircle.dataset.rating = playerData.rating;
        playerCircle.dataset.nickname = playerData.nickname;
        
        if (playerData.rating >= 40 && playerData.rating <= 60) {
            playerCircle.classList.add('bronze');
        } else if (playerData.rating >= 61 && playerData.rating <= 80) {
            playerCircle.classList.add('silver');
        } else if (playerData.rating >= 81 && playerData.rating <= 99) {
            playerCircle.classList.add('gold');
        } else if (playerData.rating >= 100 && playerData.rating <= 110) {
            playerCircle.classList.add('red');
        }
        
        const ratingDiv = document.createElement('div');
        ratingDiv.className = 'player-rating';
        ratingDiv.textContent = playerData.rating;
        
        const nicknameDiv = document.createElement('div');
        nicknameDiv.className = 'player-nickname';
        nicknameDiv.textContent = playerData.nickname;
        
        playerCircle.appendChild(ratingDiv);
        playerCircle.appendChild(nicknameDiv);
        playerWrapper.appendChild(playerCircle);
        
        playerCircle.addEventListener('click', () => {
            const allPlayers = positions[position].container.querySelectorAll('.player-circle');
            allPlayers.forEach(p => p.classList.remove('selected'));
            
            playerCircle.classList.add('selected');
            positions[position].selected = playerData;
            
            if (checkAllSelected()) {
                startButton.style.display = 'block';
            } else {
                startButton.style.display = 'none';
            }
        });
        
        positions[position].container.appendChild(playerWrapper);
    }
}

function checkAllSelected() {
    for (const position in positions) {
        if (!positions[position].selected) {
            return false;
        }
    }
    return true;
}

function calculateUserTeamRating() {
    let totalRating = 0;
    let count = 0;
    for (const position in positions) {
        if (positions[position].selected) {
            totalRating += positions[position].selected.rating;
            count++;
        }
    }
    return Math.round(totalRating / count);
}

function generateGoalEvents(userRating, opponentRating) {
    const events = [];
    const matchDuration = 16;
    const ratingDifference = userRating - opponentRating;
    
    // –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∏–ª—è –∏–≥—Ä—ã
    let userGoalModifier = 1;
    let opponentGoalModifier = 1;
    
    if (gameStyle === 'defensive') {
        userGoalModifier = 0.5;
        opponentGoalModifier = 0.5;
    } else if (gameStyle === 'offensive') {
        userGoalModifier = 2;
        opponentGoalModifier = 2;
    }
    
    const userGoalProbability = (0.4 + (0.5 * ratingDifference / 100) + (Math.random() * 0.17 - 0.085)) * userGoalModifier;
    const opponentGoalProbability = (0.4 - (0.3 * ratingDifference / 100) + (Math.random() * 0.17 - 0.085)) * opponentGoalModifier;
    
    const totalGoals = Math.max(1, Math.min(10, Math.round((3 + (userRating + opponentRating)/40 + (Math.random() * 3.4 - 1.7)) * (gameStyle === 'defensive' ? 0.5 : gameStyle === 'offensive' ? 2 : 1))));
    
    const goalTimes = [];
    for (let i = 0; i < totalGoals; i++) {
        goalTimes.push(Math.floor(Math.random() * matchDuration));
    }
    goalTimes.sort((a, b) => a - b);
    
    for (const time of goalTimes) {
        const isUserGoal = Math.random() < userGoalProbability / (userGoalProbability + opponentGoalProbability);
        let scorer = "";
        
        if (isUserGoal) {
            // –®–∞–Ω—Å 1%, —á—Ç–æ –≥–æ–ª –∑–∞–±—å–µ—Ç –≤—Ä–∞—Ç–∞—Ä—å
            if (Math.random() < 0.01 && positions.GK.selected) {
                scorer = positions.GK.selected.nickname;
            } else {
                const scoringPositions = ["CDM", "ST", "CF"];
                const randomPosition = scoringPositions[Math.floor(Math.random() * scoringPositions.length)];
                scorer = getRandomScorer(randomPosition);
            }
        } else {
            scorer = "–ò–≥—Ä–æ–∫";
        }
        
        events.push({
            time: time,
            isUserGoal: isUserGoal,
            scorer: scorer
        });
    }
    
    return events;
}
function showTournamentStats() {
    const statsTable = document.querySelector('#statsTable tbody');
    statsTable.innerHTML = '';
    
    // Convert scorers object to array and sort by goals
const scorersArray = Object.keys(seasonScorers).map(name => ({
    name: name,
    goals: seasonScorers[name]
})).sort((a, b) => b.goals - a.goals);
    
    // Display top scorers
    scorersArray.forEach((scorer, index) => {
        const row = document.createElement('tr');
        
        const nameCell = document.createElement('td');
        nameCell.textContent = scorer.name;
        row.appendChild(nameCell);
        
        const goalsCell = document.createElement('td');
        goalsCell.textContent = scorer.goals;
        row.appendChild(goalsCell);
        
        statsTable.appendChild(row);
    });
    
    // Show golden ball if tournament was won
    const goldenBallContainer = document.getElementById('goldenBallContainer');
    goldenBallContainer.innerHTML = '';
    
    if (tournamentWon && scorersArray.length > 0) {
        const topScorer = scorersArray[0];
        const goldenBallDiv = document.createElement('div');
        goldenBallDiv.className = 'golden-ball';
        goldenBallDiv.innerHTML = `
            <div class="golden-ball-icon">üèÜ</div>
            <div>–ó–æ–ª–æ—Ç–æ–π –º—è—á —Ç—É—Ä–Ω–∏—Ä–∞ –≤—Ä—É—á–∞–µ—Ç—Å—è ${topScorer.name} (${topScorer.goals} –≥–æ–ª–æ–≤)</div>
        `;
        goldenBallContainer.appendChild(goldenBallDiv);
    }
    
    document.getElementById('statsOverlay').style.display = 'flex';
}

function closeStats() {
    document.getElementById('statsOverlay').style.display = 'none';
}

function simulateMatch() {
    // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –º–∞—Ç—á–∞
    document.getElementById('playButton').style.display = 'none';
    document.getElementById('backToMenuButton').style.display = 'none';
    
    clearInterval(matchInterval);
    document.getElementById('playButton').style.display = 'none';
    document.getElementById('scoreDisplay').textContent = '0 : 0';
    document.getElementById('eventsContainer').innerHTML = '';
    
    currentTime = 0;
    userGoals = 0;
    opponentGoals = 0;
    goalEvents = generateGoalEvents(userTeamRating, currentOpponent.rating);
    
    matchInterval = setInterval(() => {
        currentTime += 0.5;
        const minutes = Math.floor(currentTime);
        const seconds = currentTime % 1 === 0 ? '00' : '30';
        
        document.getElementById('matchTime').textContent = `${minutes}:${seconds}`;
        
        const currentEvents = goalEvents.filter(e => Math.floor(e.time) === minutes);
        for (const event of currentEvents) {
            if (event.isUserGoal) {
                userGoals++;
                const goalEvent = document.createElement('div');
                goalEvent.className = 'goal-event user-goal';
                goalEvent.textContent = `${minutes}:${seconds} ‚öΩ –ì–û–õ! ${event.scorer} –∑–∞–±–∏–≤–∞–µ—Ç –∑–∞ –≤–∞—à—É –∫–æ–º–∞–Ω–¥—É!`;
                document.getElementById('eventsContainer').prepend(goalEvent);
                
                // Update scorers statistics only when goal is actually scored
                if (event.scorer) {
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–µ–∑–æ–Ω–∞
    if (!seasonScorers[event.scorer]) {
        seasonScorers[event.scorer] = 0;
    }
    seasonScorers[event.scorer]++;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    if (!allTimeScorers[event.scorer]) {
        allTimeScorers[event.scorer] = 0;
    }
    allTimeScorers[event.scorer]++;
    
    updateTopScorersDisplay();
}
            } else {
                opponentGoals++;
                const goalEvent = document.createElement('div');
                goalEvent.className = 'goal-event opponent-goal';
                goalEvent.textContent = `${minutes}:${seconds} ‚öΩ –ì–û–õ! ${event.scorer} –∑–∞–±–∏–≤–∞–µ—Ç –∑–∞ ${currentOpponent.name}!`;
                document.getElementById('eventsContainer').prepend(goalEvent);
            }
            document.getElementById('scoreDisplay').textContent = `${userGoals} : ${opponentGoals}`;
        }
        
        if (currentTime >= 16) {
            clearInterval(matchInterval);
            finishMatch();
        }
    }, 531.25);
}

function finishMatch() {
    // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–¥ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º
    document.getElementById('playButton').style.display = 'none';
    document.getElementById('backToMenuButton').style.display = 'none';

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–∫–æ–Ω—á–∏–ª—Å—è –ª–∏ –º–∞—Ç—á –≤–Ω–∏—á—å—é
    if (userGoals === opponentGoals) {
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        const extraTimeMsg = document.createElement('div');
        extraTimeMsg.className = 'goal-event';
        extraTimeMsg.textContent = `–ú–∞—Ç—á –∑–∞–∫–æ–Ω—á–∏–ª—Å—è –≤–Ω–∏—á—å—é! –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è 8 –º–∏–Ω—É—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏...`;
        document.getElementById('eventsContainer').prepend(extraTimeMsg);
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            playExtraTime(8); // 8 –º–∏–Ω—É—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
        }, 2000);
        return;
    }
    
    // –ï—Å–ª–∏ –Ω–µ –Ω–∏—á—å—è, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—ã—á–Ω—É—é –ª–æ–≥–∏–∫—É
    determineMatchOutcome();
}

function playExtraTime(duration) {
    // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –Ω–∞—á–∞–ª–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
    document.getElementById('playButton').style.display = 'none';
    document.getElementById('backToMenuButton').style.display = 'none';

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
    const extraTimeEvents = generateExtraTimeEvents(userTeamRating, currentOpponent.rating, duration);
    let extraTimeGoals = 0;
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
    const startMsg = document.createElement('div');
    startMsg.className = 'goal-event';
    startMsg.textContent = `–ù–∞—á–∞–ª–æ—Å—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è (${duration} –º–∏–Ω—É—Ç)`;
    document.getElementById('eventsContainer').prepend(startMsg);
    
    // –°–∏–º—É–ª–∏—Ä—É–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
    let extraTimePassed = 0;
    const extraTimeInterval = setInterval(() => {
        extraTimePassed += 0.5;
        const minutes = Math.floor(extraTimePassed);
        const seconds = extraTimePassed % 1 === 0 ? '00' : '30';
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–±—ã—Ç–∏—è –≤ —Ç–µ–∫—É—â—É—é –º–∏–Ω—É—Ç—É
        const currentEvents = extraTimeEvents.filter(e => Math.floor(e.time) === minutes);
        for (const event of currentEvents) {
            if (event.isUserGoal) {
                userGoals++;
                extraTimeGoals++;
                const goalEvent = document.createElement('div');
                goalEvent.className = 'goal-event user-goal';
                goalEvent.textContent = `${event.time}' ‚öΩ –ì–û–õ! ${event.scorer} –∑–∞–±–∏–≤–∞–µ—Ç –∑–∞ –≤–∞—à—É –∫–æ–º–∞–Ω–¥—É –≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è!`;
                document.getElementById('eventsContainer').prepend(goalEvent);
                
                if (event.scorer) {
                    if (!scorers[event.scorer]) {
                        scorers[event.scorer] = 0;
                    }
                    scorers[event.scorer]++;
                    updateTopScorersDisplay();
                }
            } else {
                opponentGoals++;
                extraTimeGoals++;
                const goalEvent = document.createElement('div');
                goalEvent.className = 'goal-event opponent-goal';
                goalEvent.textContent = `${event.time}' ‚öΩ –ì–û–õ! ${event.scorer} –∑–∞–±–∏–≤–∞–µ—Ç –∑–∞ ${currentOpponent.name} –≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è!`;
                document.getElementById('eventsContainer').prepend(goalEvent);
            }
            document.getElementById('scoreDisplay').textContent = `${userGoals} : ${opponentGoals}`;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä
        document.getElementById('matchTime').textContent = `16+${minutes}:${seconds}`;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
        if (extraTimePassed >= duration) {
            clearInterval(extraTimeInterval);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
            const endMsg = document.createElement('div');
            endMsg.className = 'goal-event';
            endMsg.textContent = `–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –ó–∞–±–∏—Ç–æ –≥–æ–ª–æ–≤: ${extraTimeGoals}`;
            document.getElementById('eventsContainer').prepend(endMsg);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Å—Ç–∞–ª–∞—Å—å –ª–∏ –Ω–∏—á—å—è
            if (userGoals === opponentGoals) {
                // –ï—Å–ª–∏ –Ω–∏—á—å—è, –¥–æ–±–∞–≤–ª—è–µ–º –µ—â–µ 8 –º–∏–Ω—É—Ç
                setTimeout(() => {
                    const extraMsg = document.createElement('div');
                    extraMsg.className = 'goal-event';
                    extraMsg.textContent = `–ú–∞—Ç—á –≤—Å–µ –µ—â–µ –≤–Ω–∏—á—å—é! –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –µ—â–µ 8 –º–∏–Ω—É—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏...`;
                    document.getElementById('eventsContainer').prepend(extraMsg);
                    
                    setTimeout(() => {
                        playExtraTime(8); // –ï—â–µ 8 –º–∏–Ω—É—Ç
                    }, 2000);
                }, 2000);
            } else {
                // –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª—å, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –∏—Å—Ö–æ–¥
                setTimeout(determineMatchOutcome, 2000);
            }
        }
    }, 1000); // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –ª—É—á—à–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏
}

function determineMatchOutcome() {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–∞—Ç—á–∞
    document.getElementById('playButton').style.display = 'block';
    document.getElementById('backToMenuButton').style.display = 'block';

    if (userGoals > opponentGoals) {
        // –õ–æ–≥–∏–∫–∞ –ø–æ–±–µ–¥—ã
        document.getElementById('matchResult').textContent = "–í—ã –ø–æ–±–µ–¥–∏–ª–∏!";
        
        if (isInLowerBracket) {
            // –ü–æ–±–µ–¥–∞ –≤ –Ω–∏–∂–Ω–µ–π —Å–µ—Ç–∫–µ
            lowerBracketRound /= 2;
            
            if (lowerBracketRound === 1) {
                // –§–∏–Ω–∞–ª –Ω–∏–∂–Ω–µ–π —Å–µ—Ç–∫–∏ - –ø–µ—Ä–µ—Ö–æ–¥ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∏–Ω–∞–ª
                isInLowerBracket = false;
                currentRound = 1;
                document.getElementById('matchResult').textContent = "–í—ã –ø–æ–±–µ–¥–∏–ª–∏ –≤ –Ω–∏–∂–Ω–µ–π —Å–µ—Ç–∫–µ –∏ –≤—ã—à–ª–∏ –≤ —Ñ–∏–Ω–∞–ª!";
                setTimeout(nextMatch, 2000);
            } else if (lowerBracketRound >= 1) {
                // –û–±—ã—á–Ω—ã–π —Ä–∞—É–Ω–¥ –Ω–∏–∂–Ω–µ–π —Å–µ—Ç–∫–∏
                if (lowerBracketRound === 32) {
                    showTransferOffer();
                } else if (lowerBracketRound === 128 || lowerBracketRound === 8 || lowerBracketRound === 2) {
                    setTimeout(showTrainingMenu, 1);
                } else {
                    setTimeout(nextMatch, 2000);
                }
                return;
            }
        } else {
            // –ü–æ–±–µ–¥–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ç–∫–µ
            currentRound /= 2;
        }
        
        // –û–±—â–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ—Å–ª–µ –ø–æ–±–µ–¥—ã
        if (currentRound >= 1) {
            if (currentRound === 32 && !isInLowerBracket) {
                showTransferOffer();
            } else if (currentRound === 128 || currentRound === 8 || currentRound === 2) {
                setTimeout(showTrainingMenu, 1);
            } else {
                setTimeout(nextMatch, 2000);
            }
        } else {
            tournamentWon = true;
            document.getElementById('matchResult').textContent = "üèÜ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ —Ç—É—Ä–Ω–∏—Ä! üèÜ";
            document.getElementById("playButton").style.display = "none";
            document.getElementById("newSeasonButton").style.display = "block";
            setTimeout(showTournamentStats, 1000);
        }
    } else {
        // –õ–æ–≥–∏–∫–∞ –ø–æ—Ä–∞–∂–µ–Ω–∏—è
        if (currentRound === 1 || (isInLowerBracket && lowerBracketRound === 1)) {
            document.getElementById('matchResult').textContent = "–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏! –¢—É—Ä–Ω–∏—Ä –æ–∫–æ–Ω—á–µ–Ω.";
            document.getElementById("playButton").style.display = "none";
            setTimeout(showTournamentStats, 1000);
        } else if (!isInLowerBracket) {
            isInLowerBracket = true;
            lowerBracketRound = currentRound * 2;
            document.getElementById('matchResult').textContent = "–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –≤ –Ω–∏–∂–Ω—é—é —Å–µ—Ç–∫—É!";
            
            if (lowerBracketRound === 32) {
                showTransferOffer();
            } else {
                setTimeout(nextMatch, 2000);
            }
        } else {
            document.getElementById('matchResult').textContent = "–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏ –≤ –Ω–∏–∂–Ω–µ–π —Å–µ—Ç–∫–µ! –¢—É—Ä–Ω–∏—Ä –æ–∫–æ–Ω—á–µ–Ω.";
            document.getElementById("playButton").style.display = "none";
            setTimeout(showTournamentStats, 1000);
        }
    }
}

// –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π –≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
function generateExtraTimeEvents(userRating, opponentRating, duration) {
    const events = [];
    const ratingDifference = userRating - opponentRating;
    
    // –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∏–ª—è –∏–≥—Ä—ã
    let userGoalModifier = 1;
    let opponentGoalModifier = 1;
    
    if (gameStyle === 'defensive') {
        userGoalModifier = 0.5;
        opponentGoalModifier = 0.5;
    } else if (gameStyle === 'offensive') {
        userGoalModifier = 2;
        opponentGoalModifier = 2;
    }
    
    const userGoalProbability = (0.4 + (0.5 * ratingDifference / 100) + (Math.random() * 0.17 - 0.085)) * userGoalModifier;
    const opponentGoalProbability = (0.4 - (0.3 * ratingDifference / 100) + (Math.random() * 0.17 - 0.085)) * opponentGoalModifier;
    
    // –í –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–±—ã—á–Ω–æ –∑–∞–±–∏–≤–∞—é—Ç –º–µ–Ω—å—à–µ –≥–æ–ª–æ–≤
    const totalGoals = Math.max(0, Math.min(3, Math.round((1 + (userRating + opponentRating)/80 + (Math.random() * 1.7 - 0.85)) * (gameStyle === 'defensive' ? 0.5 : gameStyle === 'offensive' ? 2 : 1))));
    
    const goalTimes = [];
    for (let i = 0; i < totalGoals; i++) {
        goalTimes.push(Math.floor(Math.random() * duration));
    }
    goalTimes.sort((a, b) => a - b);
    
    for (const time of goalTimes) {
        const isUserGoal = Math.random() < userGoalProbability / (userGoalProbability + opponentGoalProbability);
        let scorer = "";
        
        if (isUserGoal) {
            // –®–∞–Ω—Å 1%, —á—Ç–æ –≥–æ–ª –∑–∞–±—å–µ—Ç –≤—Ä–∞—Ç–∞—Ä—å
            if (Math.random() < 0.01 && positions.GK.selected) {
                scorer = positions.GK.selected.nickname;
            } else {
                const scoringPositions = ["CDM", "ST", "CF"];
                const randomPosition = scoringPositions[Math.floor(Math.random() * scoringPositions.length)];
                scorer = getRandomScorer(randomPosition);
            }
        } else {
            scorer = "–ò–≥—Ä–æ–∫";
        }
        
        events.push({
            time: time,
            isUserGoal: isUserGoal,
            scorer: scorer
        });
    }
    
    return events;
}

function playMatch() {
    document.getElementById('backToMenuButton').style.display = 'none';
    simulateMatch();
}

function nextMatch() {
    currentOpponent = getNextOpponent();
    usedOpponents.push(currentOpponent.name);
    
    document.getElementById('opponentLogo').src = currentOpponent.logo;
    document.getElementById('opponentName').textContent = currentOpponent.name;
    
    const roundTitle = document.getElementById('roundTitle');
    if (isInLowerBracket) {
        if (lowerBracketRound === 1) {
            roundTitle.innerHTML = '<div class="final-banner">–§–ò–ù–ê–õ –ù–ò–ñ–ù–ï–ô –°–ï–¢–ö–ò</div>';
        } else {
            roundTitle.innerHTML = `<h3>1/${lowerBracketRound} —Ñ–∏–Ω–∞–ª–∞ (–Ω–∏–∂–Ω—è—è —Å–µ—Ç–∫–∞)</h3>`;
        }
    } else {
        if (currentRound === 1) {
            roundTitle.innerHTML = '<div class="final-banner">–§–ò–ù–ê–õ</div>';
        } else {
            roundTitle.innerHTML = `<h3>1/${currentRound} —Ñ–∏–Ω–∞–ª–∞</h3>`;
        }
    }
    
    document.getElementById('scoreDisplay').textContent = '0 : 0';
    document.getElementById('matchResult').textContent = '';
    document.getElementById('matchTime').textContent = '0:00';
    document.getElementById('eventsContainer').innerHTML = '';
    document.getElementById('backToMenuButton').style.display = 'none';
}

function startTournament() {
    // Reset statistics for new tournament
    seasonScorers = {}; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–µ–∑–æ–Ω–∞
    tournamentWon = false;
    isInLowerBracket = false;
    lowerBracketRound = 0;
    
    userTeamRating = calculateUserTeamRating();
    document.getElementById('userRatingDisplay').textContent = userTeamRating;
    updateTeamSquadDisplay();
    updateTeamRatingCircle();
    currentRound = 256;
    usedOpponents = [];
    document.getElementById("newSeasonButton").style.display = "none";
    document.getElementById('matchOverlay').style.display = 'flex';
    document.getElementById('matchResult').textContent = '';
    document.getElementById('playButton').style.display = 'block';
    document.getElementById('userRatingDisplay').textContent = userTeamRating;
    document.getElementById('userTeamName').textContent = userTeamName;
    document.getElementById('backToMenuButton').style.display = 'none';
    document.getElementById('yearDisplay').textContent = `–°–µ–∑–æ–Ω ${currentYear}`;
    nextMatch();
}

window.onload = function() {
    for (const position in positions) {
        showPlayers(position);
    }
};

// Transfer Offer Functions
function showTransferOffer() {
    // Find the weakest player in the team
    let weakestPlayer = null;
    let weakestRating = 100;
    let weakestPosition = null;
    
    for (const position in positions) {
        if (positions[position].selected && positions[position].selected.rating < weakestRating) {
            weakestRating = positions[position].selected.rating;
            weakestPlayer = positions[position].selected;
            weakestPosition = position;
        }
    }
    
    if (!weakestPlayer || !weakestPosition) {
        nextMatch(); // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Å–ª–∞–±–æ–≥–æ –∏–≥—Ä–æ–∫–∞, —Å—Ä–∞–∑—É –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ç—É—Ä–Ω–∏—Ä
        return;
    }
    
    // Find a random player from the same position with higher rating
    const availablePlayers = positions[weakestPosition].players.filter(
        p => p.rating > weakestRating && p.nickname !== weakestPlayer.nickname
    );
    
    if (availablePlayers.length === 0) {
        nextMatch(); // –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∏–≥—Ä–æ–∫–æ–≤, —Å—Ä–∞–∑—É –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ç—É—Ä–Ω–∏—Ä
        return;
    }
    
    const offeredPlayer = availablePlayers[Math.floor(Math.random() * availablePlayers.length)];
    
    // Update transfer modal UI
    const currentPlayerCircle = document.getElementById('currentPlayer');
    currentPlayerCircle.querySelector('.player-rating').textContent = weakestPlayer.rating;
    currentPlayerCircle.querySelector('.player-nickname').textContent = weakestPlayer.nickname;
    
    const offeredPlayerCircle = document.getElementById('offeredPlayer');
    offeredPlayerCircle.querySelector('.player-rating').textContent = offeredPlayer.rating;
    offeredPlayerCircle.querySelector('.player-nickname').textContent = offeredPlayer.nickname;
    
    // Set rating class
    [currentPlayerCircle, offeredPlayerCircle].forEach(circle => {
        circle.className = 'player-circle';
        const rating = parseInt(circle.querySelector('.player-rating').textContent);
        if (rating >= 40 && rating <= 60) {
            circle.classList.add('bronze');
        } else if (rating >= 61 && rating <= 80) {
            circle.classList.add('silver');
        } else if (rating >= 81 && rating <= 99) {
            circle.classList.add('gold');
        }
    });
    
    // Store transfer data
    currentPlayerCircle.dataset.position = weakestPosition;
    currentPlayerCircle.dataset.nickname = weakestPlayer.nickname;
    offeredPlayerCircle.dataset.position = weakestPosition;
    offeredPlayerCircle.dataset.nickname = offeredPlayer.nickname;
    offeredPlayerCircle.dataset.rating = offeredPlayer.rating;
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞
    document.querySelector('.transfer-title').textContent = '–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä';
    
    // Show transfer modal immediately
    document.getElementById('transferOverlay').style.display = 'flex';
}

function acceptTransfer() {
    const currentPlayerCircle = document.getElementById('currentPlayer');
    const offeredPlayerCircle = document.getElementById('offeredPlayer');
    
    const position = currentPlayerCircle.dataset.position;
    const oldNickname = currentPlayerCircle.dataset.nickname;
    const newNickname = offeredPlayerCircle.dataset.nickname;
    const newRating = parseInt(offeredPlayerCircle.dataset.rating);
    
    // –ù–∞—Ö–æ–¥–∏–º –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–≥–æ –∏–≥—Ä–æ–∫–∞
    const offeredPlayer = positions[position].players.find(p => p.nickname === newNickname);
    
    if (offeredPlayer) {
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å—Ç–∞—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞
        // –ü–µ—Ä–µ–Ω–æ—Å–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–µ
if (allTimeScorers[oldNickname]) {
    allTimeScorers[newNickname] = (allTimeScorers[newNickname] || 0) + allTimeScorers[oldNickname];
    delete allTimeScorers[oldNickname];
}

if (seasonScorers[oldNickname]) {
    seasonScorers[newNickname] = (seasonScorers[newNickname] || 0) + seasonScorers[oldNickname];
    delete seasonScorers[oldNickname];
}
        
        // –ù–∞—á–∏–Ω–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞ —Å –Ω—É–ª—è
        scorers[newNickname] = 0;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞
        positions[position].selected = offeredPlayer;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–π—Ç–∏–Ω–≥ –∫–æ–º–∞–Ω–¥—ã
        userTeamRating = calculateUserTeamRating();
        updateTeamSquadDisplay(); // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ç—É —Å—Ç—Ä–æ–∫—É
        updateTopScorersDisplay();
        document.getElementById('userRatingDisplay').textContent = userTeamRating;
    }
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞
    document.getElementById('transferOverlay').style.display = 'none';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â–µ–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ –Ω–∞—á–∏–Ω–∞–µ–º —Å–µ–∑–æ–Ω
    if (showOffseasonTransfer.transferCount < 2) {
        showOffseasonTransfer();
    }
}

function rejectTransfer() {
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞
    document.getElementById('transferOverlay').style.display = 'none';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â–µ–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ –Ω–∞—á–∏–Ω–∞–µ–º —Å–µ–∑–æ–Ω
    if (showOffseasonTransfer.transferCount < 2) {
        showOffseasonTransfer();
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –º–µ–Ω—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
function showTrainingMenu() {
    const trainingPlayersContainer = document.getElementById('trainingPlayers');
    trainingPlayersContainer.innerHTML = '';
    
    // –°–æ–∑–¥–∞–µ–º –∫—Ä—É–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞
    for (const position in positions) {
        if (positions[position].selected) {
            const player = positions[position].selected;
            
            const playerCircle = document.createElement('div');
            playerCircle.className = 'player-circle';
            playerCircle.style.cursor = 'pointer';
            playerCircle.style.margin = '0';
            playerCircle.dataset.position = position;
            playerCircle.dataset.nickname = player.nickname;
            playerCircle.dataset.rating = player.rating;
            
            if (player.rating >= 40 && player.rating <= 60) {
                playerCircle.classList.add('bronze');
            } else if (player.rating >= 61 && player.rating <= 80) {
                playerCircle.classList.add('silver');
            } else if (player.rating >= 81 && player.rating <= 99) {
                playerCircle.classList.add('gold');
            } else if (player.rating >= 100 && player.rating <= 110) {
                playerCircle.classList.add('red');
            }
            
            const ratingDiv = document.createElement('div');
            ratingDiv.className = 'player-rating';
            ratingDiv.textContent = player.rating;
            
            const nicknameDiv = document.createElement('div');
            nicknameDiv.className = 'player-nickname';
            nicknameDiv.textContent = player.nickname;
            
            playerCircle.appendChild(ratingDiv);
            playerCircle.appendChild(nicknameDiv);
            
            playerCircle.addEventListener('click', function() {
                // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —É –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
                document.querySelectorAll('#trainingPlayers .player-circle').forEach(circle => {
                    circle.classList.remove('selected');
                });
                
                // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞
                this.classList.add('selected');
            });
            
            trainingPlayersContainer.appendChild(playerCircle);
        }
    }
    
    document.getElementById('trainingOverlay').style.display = 'flex';
}
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
function confirmTraining() {
    const selectedPlayerCircle = document.querySelector('#trainingPlayers .player-circle.selected');
    
    if (!selectedPlayerCircle) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏!');
        return;
    }
    
    const position = selectedPlayerCircle.dataset.position;
    const nickname = selectedPlayerCircle.dataset.nickname;
    const currentRating = parseInt(selectedPlayerCircle.dataset.rating);
    
    // –ù–∞—Ö–æ–¥–∏–º –∏–≥—Ä–æ–∫–∞ –≤ –º–∞—Å—Å–∏–≤–µ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥
    const playerIndex = positions[position].players.findIndex(p => p.nickname === nickname);
    if (playerIndex !== -1) {
        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–µ–π—Ç–∏–Ω–≥, –Ω–æ –Ω–µ –±–æ–ª–µ–µ 110
        const newRating = Math.min(currentRating + 5, 110);
        positions[position].players[playerIndex].rating = newRating;
        
        // –ï—Å–ª–∏ —ç—Ç–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∏–≥—Ä–æ–∫, –æ–±–Ω–æ–≤–ª—è–µ–º –∏ –µ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥
        if (positions[position].selected && positions[position].selected.nickname === nickname) {
            positions[position].selected.rating = newRating;
            userTeamRating = calculateUserTeamRating();
document.getElementById('userRatingDisplay').textContent = userTeamRating;
    updateTeamSquadDisplay(); // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ç—É —Å—Ç—Ä–æ–∫—É
updateTeamRatingCircle(); // –î–æ–±–∞–≤–∏—Ç—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É
        }
    }
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
    document.getElementById('trainingOverlay').style.display = 'none';
    
    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ç—É—Ä–Ω–∏—Ä
    nextMatch();
}

function startNewSeason() {
    currentYear++;
    document.getElementById('yearDisplay').textContent = `–°–µ–∑–æ–Ω ${currentYear}`;

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–µ–∑–æ–Ω–Ω—É—é
    seasonScorers = {};
    // –°–±—Ä–æ—Å–∏—Ç—å —Ç—É—Ä–Ω–∏—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    currentRound = 256;
    usedOpponents = [];
    tournamentWon = false;
    isInLowerBracket = false;
    lowerBracketRound = 0;
    
    
    // –ó–∞–∫—Ä—ã—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    document.getElementById('statsOverlay').style.display = 'none';
    
    // –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥ –∫–æ–º–∞–Ω–¥—ã
    userTeamRating = calculateUserTeamRating();
    document.getElementById('userRatingDisplay').textContent = userTeamRating;
    updateTeamRatingCircle(); // –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–æ—Ç –≤—ã–∑–æ–≤
    
    // –°–±—Ä–æ—Å–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∞—Ç—á–∞
    document.getElementById('matchOverlay').style.display = 'flex';
    document.getElementById('matchResult').textContent = '';
    document.getElementById('playButton').style.display = 'block';
    document.getElementById('backToMenuButton').style.display = 'none';
    document.getElementById('newSeasonButton').style.display = 'none';
    document.getElementById('scoreDisplay').textContent = '0 : 0';
    document.getElementById('eventsContainer').innerHTML = '';
    
    // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—É–Ω–¥ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
    const roundTitle = document.getElementById('roundTitle');
    roundTitle.innerHTML = `<h3>1/${currentRound} —Ñ–∏–Ω–∞–ª–∞</h3>`;
    
    // –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤–æ–≥–æ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞
    currentOpponent = getNextOpponent();
    usedOpponents.push(currentOpponent.name);
    
    // –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ–ø–µ—Ä–Ω–∏–∫–∞
    document.getElementById('opponentLogo').src = currentOpponent.logo;
    document.getElementById('opponentName').textContent = currentOpponent.name;
    showPlayersImprovement();
}

function showPlayersImprovement() {
    const improvedPlayersContainer = document.getElementById('improvedPlayers');
    improvedPlayersContainer.innerHTML = '';
    
    // –£–ª—É—á—à–∏—Ç—å –≤—Å–µ—Ö –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –∏ –æ–±–Ω–æ–≤–∏—Ç—å –∏—Ö —Ä–µ–π—Ç–∏–Ω–≥
    for (const position in positions) {
        if (positions[position].selected) {
            const player = positions[position].selected;
            
            // –ù–∞–π—Ç–∏ –∏–≥—Ä–æ–∫–∞ –≤ –º–∞—Å—Å–∏–≤–µ –∏ –æ–±–Ω–æ–≤–∏—Ç—å –µ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥
            const playerIndex = positions[position].players.findIndex(p => p.nickname === player.nickname);
            if (playerIndex !== -1) {
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–µ–π—Ç–∏–Ω–≥, –Ω–æ –Ω–µ –±–æ–ª–µ–µ 110
                const newRating = Math.min(player.rating + 2, 110);
                positions[position].players[playerIndex].rating = newRating;
                positions[position].selected.rating = newRating;
                
                // –°–æ–∑–¥–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞
                const playerCircle = document.createElement('div');
                playerCircle.className = 'player-circle';
                playerCircle.style.margin = '0';
                
                if (newRating >= 40 && newRating <= 60) {
                    playerCircle.classList.add('bronze');
                } else if (newRating >= 61 && newRating <= 80) {
                    playerCircle.classList.add('silver');
                } else if (newRating >= 81 && newRating <= 99) {
                    playerCircle.classList.add('gold');
                } else if (newRating >= 100 && newRating <= 110) {
                    playerCircle.classList.add('red');
                }
                
                const ratingDiv = document.createElement('div');
                ratingDiv.className = 'player-rating';
                ratingDiv.textContent = newRating;
                
                const nicknameDiv = document.createElement('div');
                nicknameDiv.className = 'player-nickname';
                nicknameDiv.textContent = player.nickname;
                
                playerCircle.appendChild(ratingDiv);
                playerCircle.appendChild(nicknameDiv);
                improvedPlayersContainer.appendChild(playerCircle);
            }
        }
    }
    
    // –ü–æ–∫–∞–∑–∞—Ç—å –æ–≤–µ—Ä–ª–µ–π
    document.getElementById('newSeasonOverlay').style.display = 'flex';
    document.getElementById('statsOverlay').style.display = 'none';
}

// –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è
function continueAfterSeason() {
    // –°–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ —É–ª—É—á—à–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤
    document.getElementById('newSeasonOverlay').style.display = 'none';
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–π—Ç–∏–Ω–≥ –∫–æ–º–∞–Ω–¥—ã –ø–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏–π
    userTeamRating = calculateUserTeamRating();
document.getElementById('userRatingDisplay').textContent = userTeamRating;
    updateTeamSquadDisplay(); // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ç—É —Å—Ç—Ä–æ–∫—É
updateTeamRatingCircle();
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç—É—Ä–Ω–∏—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å–µ–∑–æ–Ω–∞
    currentRound = 256;
    usedOpponents = [];
    tournamentWon = false;
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∞—Ç—á–∞
    document.getElementById('matchOverlay').style.display = 'flex';
    document.getElementById('matchResult').textContent = '';
    document.getElementById('playButton').style.display = 'block';
    document.getElementById('backToMenuButton').style.display = 'none';
    document.getElementById('newSeasonButton').style.display = 'none';
    document.getElementById('scoreDisplay').textContent = '0 : 0';
    document.getElementById('eventsContainer').innerHTML = '';
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—É–Ω–¥ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
    const roundTitle = document.getElementById('roundTitle');
    roundTitle.innerHTML = `<h3>1/${currentRound} —Ñ–∏–Ω–∞–ª–∞</h3>`;
    
    // –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤–æ–≥–æ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞
    currentOpponent = getNextOpponent();
    usedOpponents.push(currentOpponent.name);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ–ø–µ—Ä–Ω–∏–∫–∞
    document.getElementById('opponentLogo').src = currentOpponent.logo;
    document.getElementById('opponentName').textContent = currentOpponent.name;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á–µ—Ç—ã—Ä–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
    showOffseasonTransfer.transferCount = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫
    showOffseasonTransfer(); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä
}

function showOffseasonTransfer() {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—á–µ—Ç—á–∏–∫ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤, –µ—Å–ª–∏ –æ–Ω –µ—â–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    if (typeof showOffseasonTransfer.transferCount === 'undefined') {
        showOffseasonTransfer.transferCount = 0;
    }
    
    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫
    showOffseasonTransfer.transferCount++;
    
    // –ï—Å–ª–∏ —É–∂–µ –ø–æ–∫–∞–∑–∞–ª–∏ 4 —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –∏ –Ω–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π —Å–µ–∑–æ–Ω
    if (showOffseasonTransfer.transferCount > 4) {
        showOffseasonTransfer.transferCount = 0;
        nextMatch(); // –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π —Å–µ–∑–æ–Ω
        return;
    }
    
    // –ü–æ–ª—É—á–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö
    const positionsList = Object.keys(positions);
    const randomPosition = positionsList[Math.floor(Math.random() * positionsList.length)];
    
    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞ –Ω–∞ —ç—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏
    const currentPlayer = positions[randomPosition].selected;
    
    if (!currentPlayer) {
        // –ï—Å–ª–∏ –ø–æ—á–µ–º—É-—Ç–æ –Ω–µ—Ç –∏–≥—Ä–æ–∫–∞ –Ω–∞ —ç—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏, –ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞
        setTimeout(showOffseasonTransfer, 0);
        return;
    }
    
    // –ü–æ–ª—É—á–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –Ω–∞ —Ç–æ–π –∂–µ –ø–æ–∑–∏—Ü–∏–∏ (–º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞)
    const availablePlayers = positions[randomPosition].players.filter(
        p => p.nickname !== currentPlayer.nickname
    );
    
    if (availablePlayers.length === 0) {
        // –ï—Å–ª–∏ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –Ω–∞ —ç—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏, –ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞
        setTimeout(showOffseasonTransfer, 0);
        return;
    }
    
    const offeredPlayer = availablePlayers[Math.floor(Math.random() * availablePlayers.length)];
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞
    updateTransferUI(currentPlayer, offeredPlayer, randomPosition);
    
    // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ –¥–ª—è –º–µ–∂—Å–µ–∑–æ–Ω—å—è
    document.querySelector('.transfer-title').textContent = `–ú–µ–∂—Å–µ–∑–æ–Ω–Ω—ã–π —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä (${showOffseasonTransfer.transferCount}/4)`;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞
    document.getElementById('transferOverlay').style.display = 'flex';
}


// –í—ã–Ω–µ—Å–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
function updateTransferUI(currentPlayer, offeredPlayer, position) {
    const currentPlayerCircle = document.getElementById('currentPlayer');
    currentPlayerCircle.querySelector('.player-rating').textContent = currentPlayer.rating;
    currentPlayerCircle.querySelector('.player-nickname').textContent = currentPlayer.nickname;
    
    const offeredPlayerCircle = document.getElementById('offeredPlayer');
    offeredPlayerCircle.querySelector('.player-rating').textContent = offeredPlayer.rating;
    offeredPlayerCircle.querySelector('.player-nickname').textContent = offeredPlayer.nickname;
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–ª–∞—Å—Å—ã —Ä–µ–π—Ç–∏–Ω–≥–∞
    [currentPlayerCircle, offeredPlayerCircle].forEach(circle => {
        circle.className = 'player-circle';
        const rating = parseInt(circle.querySelector('.player-rating').textContent);
        if (rating >= 40 && rating <= 60) {
            circle.classList.add('bronze');
        } else if (rating >= 61 && rating <= 80) {
            circle.classList.add('silver');
        } else if (rating >= 81 && rating <= 99) {
            circle.classList.add('gold');
        } else if (rating >= 100 && rating <= 110) {
            circle.classList.add('red');
        }
    });
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞
    currentPlayerCircle.dataset.position = position;
    currentPlayerCircle.dataset.nickname = currentPlayer.nickname;
    offeredPlayerCircle.dataset.position = position;
    offeredPlayerCircle.dataset.nickname = offeredPlayer.nickname;
    offeredPlayerCircle.dataset.rating = offeredPlayer.rating;
}

function acceptTransfer() {
    const currentPlayerCircle = document.getElementById('currentPlayer');
    const offeredPlayerCircle = document.getElementById('offeredPlayer');
    
    const position = currentPlayerCircle.dataset.position;
    const oldNickname = currentPlayerCircle.dataset.nickname;
    const newNickname = offeredPlayerCircle.dataset.nickname;
    const newRating = parseInt(offeredPlayerCircle.dataset.rating);
    
    const offeredPlayer = positions[position].players.find(p => p.nickname === newNickname);
    
    if (offeredPlayer) {
        // –ü–µ—Ä–µ–Ω–æ—Å–∏–º —á–∞—Å—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –∫ –Ω–æ–≤–æ–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, 50%)
        if (scorers[oldNickname]) {
            const oldGoals = scorers[oldNickname];
            scorers[newNickname] = Math.floor(oldGoals * 0.5); // –ù–æ–≤—ã–π –∏–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç 50% –≥–æ–ª–æ–≤ —Å—Ç–∞—Ä–æ–≥–æ
            scorers[oldNickname] = Math.ceil(oldGoals * 0.5); // –°—Ç–∞—Ä—ã–π –∏–≥—Ä–æ–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç 50%
        } else {
            scorers[newNickname] = 0;
        }
        
        positions[position].selected = offeredPlayer;
        userTeamRating = calculateUserTeamRating();
        document.getElementById('userRatingDisplay').textContent = userTeamRating;
        updateTeamSquadDisplay();
        updateTeamRatingCircle();
        updateTopScorersDisplay();
    }
    
    document.getElementById('transferOverlay').style.display = 'none';
    
    const isOffseasonTransfer = document.querySelector('.transfer-title').textContent.includes('–ú–µ–∂—Å–µ–∑–æ–Ω–Ω—ã–π');
    
    if (isOffseasonTransfer) {
        if (showOffseasonTransfer.transferCount < 4) {
            setTimeout(showOffseasonTransfer, 0);
        } else {
            nextMatch();
        }
    } else {
        setTimeout(nextMatch, 0);
    }
}

function rejectTransfer() {
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞
    document.getElementById('transferOverlay').style.display = 'none';
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —ç—Ç–æ –æ–±—ã—á–Ω—ã–π —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä –∏–ª–∏ –º–µ–∂—Å–µ–∑–æ–Ω–Ω—ã–π
    const isOffseasonTransfer = document.querySelector('.transfer-title').textContent.includes('–ú–µ–∂—Å–µ–∑–æ–Ω–Ω—ã–π');
    
    if (isOffseasonTransfer) {
        // –î–ª—è –º–µ–∂—Å–µ–∑–æ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤
        if (showOffseasonTransfer.transferCount < 4) {  // –ò–∑–º–µ–Ω–∏–ª–∏ —Å 2 –Ω–∞ 4
            setTimeout(showOffseasonTransfer, 0);
        } else {
            // –ü–æ—Å–ª–µ —á–µ—Ç—ã—Ä–µ—Ö –º–µ–∂—Å–µ–∑–æ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤ –Ω–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π —Å–µ–∑–æ–Ω
            nextMatch();
        }
    } else {
        // –î–ª—è –æ–±—ã—á–Ω—ã—Ö —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ç—É—Ä–Ω–∏—Ä
        setTimeout(nextMatch, 0);
    }
}

function updateTeamRatingCircle() {
    const teamCircle = document.getElementById('teamRatingCircle');
    if (!teamCircle) return;
    
    // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫–ª–∞—Å—Å—ã —Ü–≤–µ—Ç–æ–≤
    teamCircle.classList.remove('bronze', 'silver', 'gold', 'red');
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–ª–∞—Å—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞
    if (userTeamRating >= 40 && userTeamRating <= 60) {
        teamCircle.classList.add('bronze');
    } else if (userTeamRating >= 61 && userTeamRating <= 80) {
        teamCircle.classList.add('silver');
    } else if (userTeamRating >= 81 && userTeamRating <= 99) {
        teamCircle.classList.add('gold');
    } else if (userTeamRating >= 100 && userTeamRating <= 110) {
        teamCircle.classList.add('red');
    }
}

function updateTeamSquadDisplay() {
    const squadContainer = document.getElementById('teamSquadPlayers');
    squadContainer.innerHTML = '';
    
    for (const position in positions) {
        if (positions[position].selected) {
            const player = positions[position].selected;
            
            const playerWrapper = document.createElement('div');
            playerWrapper.className = 'squad-player';
            
            const playerCircle = document.createElement('div');
            playerCircle.className = 'squad-player-circle';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å —Ü–≤–µ—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞
            if (player.rating >= 40 && player.rating <= 60) {
                playerCircle.classList.add('bronze');
            } else if (player.rating >= 61 && player.rating <= 80) {
                playerCircle.classList.add('silver');
            } else if (player.rating >= 81 && player.rating <= 99) {
                playerCircle.classList.add('gold');
            } else if (player.rating >= 100 && player.rating <= 110) {
                playerCircle.classList.add('red');
            }
            
            const ratingDiv = document.createElement('div');
            ratingDiv.className = 'squad-player-rating';
            ratingDiv.textContent = player.rating;
            
            const nicknameDiv = document.createElement('div');
            nicknameDiv.className = 'squad-player-nickname';
            nicknameDiv.textContent = player.nickname;
            
            playerCircle.appendChild(ratingDiv);
            playerWrapper.appendChild(playerCircle);
            playerWrapper.appendChild(nicknameDiv);
            
            squadContainer.appendChild(playerWrapper);
        }
    }
}

function updateTopScorersDisplay() {
    const scorersDisplay = document.getElementById('topScorersDisplay');
    
    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –æ–±—ä–µ–∫—Ç scorers –≤ –º–∞—Å—Å–∏–≤ –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≥–æ–ª–æ–≤
    const sortedScorers = Object.entries(allTimeScorers)
        .map(([name, goals]) => ({ name, goals }))
        .sort((a, b) => b.goals - a.goals);
    
    // –§–æ—Ä–º–∏—Ä—É–µ–º HTML –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    let html = '<div style="text-align: center; margin-bottom: 5px; color: #00bfff;">–ë–æ–º–±–∞—Ä–¥–∏—Ä—ã (–≤—Å—ë –≤—Ä–µ–º—è)</div>';
    
    if (sortedScorers.length === 0) {
        html += '<div style="font-style: italic;">–ì–æ–ª—ã –µ—â–µ –Ω–µ –∑–∞–±–∏—Ç—ã</div>';
    } else {
        sortedScorers.forEach((scorer, index) => {
            // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –∫–æ–º–∞–Ω–¥—ã
            const isCurrentPlayer = Object.values(positions).some(
                pos => pos.selected && pos.selected.nickname === scorer.name
            );
            
            const playerClass = isCurrentPlayer ? 'style="color: #7cfc00;"' : '';
            html += `<div ${playerClass}>${scorer.name}: ${scorer.goals}</div>`;
        });
    }
    
    scorersDisplay.innerHTML = html;
}
</script>

</body>
</html>
